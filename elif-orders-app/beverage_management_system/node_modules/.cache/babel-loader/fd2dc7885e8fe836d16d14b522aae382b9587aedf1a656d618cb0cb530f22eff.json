{"ast":null,"code":"import _objectSpread from\"/home/el-ifran/WareHouse_Manager/beverage_management_system/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{useAuth}from'../contexts/AuthContext';import api from'../services/api';import Table from'../components/Table';import Button from'../components/Button';import PrintButton from'../components/PrintButton';import'./Inventory.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Inventory=()=>{const{user}=useAuth();const[products,setProducts]=useState([]);const[categories,setCategories]=useState([]);const[taxClasses,setTaxClasses]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[showAddModal,setShowAddModal]=useState(false);const[editingProduct,setEditingProduct]=useState(null);const[filters,setFilters]=useState({category:'',stockStatus:'',search:''});useEffect(()=>{fetchProducts();fetchCategories();fetchTaxClasses();},[]);const fetchProducts=async function(){let filterParams=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};try{setLoading(true);const params=new URLSearchParams();// Add filters to params\nif(filterParams.category)params.append('category',filterParams.category);if(filterParams.search)params.append('search',filterParams.search);if(filterParams.is_active!==undefined)params.append('is_active',filterParams.is_active);if(filterParams.stock_quantity!==undefined)params.append('stock_quantity',filterParams.stock_quantity);const url=\"/products/\".concat(params.toString()?'?'+params.toString():'');const response=await api.get(url);let products=response.data.results||response.data;// Handle low stock filter on frontend since it's a calculated field\nif(filterParams.stockStatus==='low'){products=products.filter(product=>product.is_low_stock);}setProducts(products);}catch(err){setError('Failed to load products');console.error('Products error:',err);}finally{setLoading(false);}};const fetchCategories=async()=>{try{const response=await api.get('/products/categories/');setCategories(response.data.results||response.data);}catch(err){console.error('Categories error:',err);}};const fetchTaxClasses=async()=>{try{const response=await api.get('/products/tax-classes/');setTaxClasses(response.data.results||response.data);}catch(err){console.error('Tax classes error:',err);}};const handleAddProduct=()=>{setEditingProduct(null);setShowAddModal(true);};const handleEditProduct=async product=>{try{// Fetch full product details including cost_price and category ID\nconst response=await api.get(\"/products/\".concat(product.id,\"/\"));setEditingProduct(response.data);setShowAddModal(true);}catch(err){setError('Failed to load product details');console.error('Product details error:',err);}};const handleDeleteProduct=async product=>{if(window.confirm(\"Are you sure you want to delete \".concat(product.name,\"?\"))){try{await api.delete(\"/products/\".concat(product.id,\"/\"));fetchProducts(filters);}catch(err){setError('Failed to delete product');console.error('Delete error:',err);}}};const handleFilterChange=(filterType,value)=>{const newFilters=_objectSpread(_objectSpread({},filters),{},{[filterType]:value});setFilters(newFilters);// Convert stock status filter to API parameters\nconst apiParams=_objectSpread({},newFilters);if(newFilters.stockStatus==='out'){// For out of stock, filter by stock_quantity = 0\napiParams.stock_quantity=0;}fetchProducts(apiParams);};const clearFilters=()=>{const clearedFilters={category:'',stockStatus:'',search:''};setFilters(clearedFilters);fetchProducts(clearedFilters);};const columns=[{key:'name',header:'Product Name',render:(value,row)=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"product-name\",children:value}),/*#__PURE__*/_jsx(\"div\",{className:\"product-sku\",children:row.sku})]})},{key:'category_name',header:'Category'},{key:'stock_quantity',header:'Stock',render:(value,row)=>/*#__PURE__*/_jsxs(\"div\",{className:\"stock-quantity \".concat(row.is_low_stock?'low-stock':'',\" \").concat(row.is_out_of_stock?'out-of-stock':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"base-stock\",children:[value,\" \",row.unit,row.is_low_stock&&/*#__PURE__*/_jsx(\"span\",{className:\"stock-warning\",children:\"Low\"}),row.is_out_of_stock&&/*#__PURE__*/_jsx(\"span\",{className:\"stock-warning\",children:\"Out\"})]}),row.stock_in_units&&row.stock_in_units.length>1&&/*#__PURE__*/_jsx(\"div\",{className:\"stock-in-units\",children:row.stock_in_units.filter(stockUnit=>!stockUnit.is_base_unit).map(stockUnit=>/*#__PURE__*/_jsxs(\"div\",{className:\"unit-stock\",children:[stockUnit.quantity,\" \",stockUnit.unit_symbol]},stockUnit.unit_id))})]})},{key:'price',header:'Price',render:value=>\"\".concat(parseFloat(value).toFixed(2),\" MGA\")},{key:'actions',header:'Actions',render:(value,row)=>/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outline\",onClick:()=>handleEditProduct(row),children:\"Edit\"}),(user===null||user===void 0?void 0:user.role)==='admin'&&/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"danger\",onClick:()=>handleDeleteProduct(row),children:\"Delete\"})]})}];return/*#__PURE__*/_jsxs(\"div\",{className:\"inventory\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inventory-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Inventory Management\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-actions\",children:[/*#__PURE__*/_jsx(PrintButton,{data:_objectSpread(_objectSpread({},products),{},{user_name:(user===null||user===void 0?void 0:user.username)||'Unknown User',user_id:(user===null||user===void 0?void 0:user.id)||'unknown',print_timestamp:new Date().toISOString(),print_id:\"PRINT-\".concat(Date.now(),\"-\").concat(Math.random().toString(36).substr(2,9))}),title:\"Inventory Report\",type:\"inventory\",printText:\"Print Inventory\",className:\"print-inventory-btn\"}),/*#__PURE__*/_jsx(Button,{onClick:handleAddProduct,children:\"Add Product\"})]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"inventory-filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Category:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.category,onChange:e=>handleFilterChange('category',e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Categories\"}),categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category.id,children:category.name},category.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Stock Status:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.stockStatus,onChange:e=>handleFilterChange('stockStatus',e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All\"}),/*#__PURE__*/_jsx(\"option\",{value:\"low\",children:\"Low Stock\"}),/*#__PURE__*/_jsx(\"option\",{value:\"out\",children:\"Out of Stock\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Search:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search products...\",value:filters.search,onChange:e=>handleFilterChange('search',e.target.value)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"filter-group\",children:/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"small\",onClick:clearFilters,children:\"Clear Filters\"})})]}),/*#__PURE__*/_jsx(Table,{data:products,columns:columns,loading:loading,emptyMessage:\"No products found\"}),showAddModal&&/*#__PURE__*/_jsx(ProductModal,{product:editingProduct,categories:categories,taxClasses:taxClasses,onClose:()=>setShowAddModal(false),onSave:()=>{setShowAddModal(false);fetchProducts(filters);}})]});};const ProductModal=_ref=>{var _product$base_unit,_product$is_active;let{product,categories,taxClasses,onClose,onSave}=_ref;const[formData,setFormData]=useState({name:(product===null||product===void 0?void 0:product.name)||'',description:(product===null||product===void 0?void 0:product.description)||'',category:(product===null||product===void 0?void 0:product.category)||'',tax_class:(product===null||product===void 0?void 0:product.tax_class)||'',sku:(product===null||product===void 0?void 0:product.sku)||'',price:(product===null||product===void 0?void 0:product.price)||'',cost_price:(product===null||product===void 0?void 0:product.cost_price)||'',stock_quantity:(product===null||product===void 0?void 0:product.stock_quantity)||0,min_stock_level:(product===null||product===void 0?void 0:product.min_stock_level)||10,max_stock_level:(product===null||product===void 0?void 0:product.max_stock_level)||1000,base_unit:(product===null||product===void 0?void 0:(_product$base_unit=product.base_unit)===null||_product$base_unit===void 0?void 0:_product$base_unit.id)||(product===null||product===void 0?void 0:product.base_unit)||'',is_active:(_product$is_active=product===null||product===void 0?void 0:product.is_active)!==null&&_product$is_active!==void 0?_product$is_active:true});const[units,setUnits]=useState([]);const[allUnits,setAllUnits]=useState([]);const[compatibleUnits,setCompatibleUnits]=useState([]);const[showUnitSelector,setShowUnitSelector]=useState(false);const[convertibleUnits,setConvertibleUnits]=useState([]);// Load base units when component mounts (for product creation/editing)\nuseEffect(()=>{const fetchUnits=async()=>{try{console.log('=== FETCHING UNITS ===');// Fetch base units\nconst baseUnitsResponse=await api.get('/products/base-units/');console.log('Base units response:',baseUnitsResponse.data);const baseUnits=baseUnitsResponse.data.results||baseUnitsResponse.data;setUnits(baseUnits);console.log('Setting base units:',baseUnits);// Fetch ALL units with pagination\nlet allUnitsData=[];let nextUrl='/products/units/';while(nextUrl){const response=await api.get(nextUrl);const data=response.data;allUnitsData=allUnitsData.concat(data.results||data);nextUrl=data.next;console.log('Fetched page, total units so far:',allUnitsData.length);}console.log('All units fetched:',allUnitsData);setAllUnits(allUnitsData);// Handle pagination for conversions\nlet allConversions=[];nextUrl='/products/unit-conversions/';while(nextUrl){const response=await api.get(nextUrl);const data=response.data;allConversions=allConversions.concat(data.results||data);nextUrl=data.next;}console.log('Unit conversions loaded:',allConversions.length);console.log('=== UNITS LOADED ===');}catch(err){console.error('Failed to load units:',err);}};fetchUnits();},[]);// Function to automatically add base unit as compatible unit\nconst addBaseUnitToCompatibleUnits=useCallback(async()=>{var _product$base_unit2;if(!product)return;const baseUnitId=((_product$base_unit2=product.base_unit)===null||_product$base_unit2===void 0?void 0:_product$base_unit2.id)||product.base_unit;if(!baseUnitId)return;try{console.log('Auto-adding base unit to compatible units in database...');const response=await api.post(\"/products/\".concat(product.id,\"/units/\"),{unit:baseUnitId,is_default:true,// Set base unit as default\nis_active:true});console.log('Base unit added to database:',response.data);// Update local state\nsetCompatibleUnits(prev=>[response.data,...prev]);}catch(err){console.error('Failed to auto-add base unit:',err);// Fallback: add to frontend only\nconst baseUnitData={id:\"temp_base_\".concat(baseUnitId),unit:allUnits.find(u=>u.id===baseUnitId)||{id:baseUnitId},is_default:true,is_active:true,is_base_unit:true};setCompatibleUnits(prev=>[baseUnitData,...prev]);}},[product,allUnits]);// Load compatible units when editing a product\nuseEffect(()=>{if(product&&product.compatible_units){var _product$base_unit3;let updatedCompatibleUnits=[...product.compatible_units];// Ensure base unit is always in compatible units\nconst baseUnitId=((_product$base_unit3=product.base_unit)===null||_product$base_unit3===void 0?void 0:_product$base_unit3.id)||product.base_unit;const hasBaseUnit=updatedCompatibleUnits.some(cu=>{var _cu$unit;return((_cu$unit=cu.unit)===null||_cu$unit===void 0?void 0:_cu$unit.id)===baseUnitId||cu.unit===baseUnitId;});if(!hasBaseUnit&&baseUnitId){console.log('Base unit missing from compatible units, auto-adding...');// Automatically add base unit to database\naddBaseUnitToCompatibleUnits();}else{setCompatibleUnits(updatedCompatibleUnits);}}else{setCompatibleUnits([]);}},[product,allUnits,addBaseUnitToCompatibleUnits]);// Debug: Monitor formData changes\nuseEffect(()=>{console.log('FormData changed:',formData);},[formData]);// Debug: Monitor allUnits changes\nuseEffect(()=>{console.log('AllUnits changed:',allUnits);},[allUnits]);// Debug: Monitor units changes\nuseEffect(()=>{console.log('Units changed:',units);},[units]);// Fetch convertible units when base unit changes\nuseEffect(()=>{const fetchConvertibleUnits=async()=>{if(formData.base_unit){try{// Use a unified approach for both new and existing products\n// Get all unit conversions and find units that can be converted to/from the base unit\n// Handle pagination to get all conversions\nlet allConversions=[];let nextUrl='/products/unit-conversions/';while(nextUrl){const response=await api.get(nextUrl);const data=response.data;allConversions=allConversions.concat(data.results||data);nextUrl=data.next;// Next page URL\n}const conversions=allConversions;const baseUnitId=parseInt(formData.base_unit);const convertible=[];// Find units that have conversions with the base unit\nconversions.forEach(conversion=>{if(conversion.from_unit===baseUnitId&&!convertible.find(u=>u.id===conversion.to_unit)){// Find the unit details\nconst unit=allUnits.find(u=>u.id===conversion.to_unit);if(unit){convertible.push({id:unit.id,name:unit.name,symbol:unit.symbol,is_base_unit:unit.is_base_unit});}}else if(conversion.to_unit===baseUnitId&&!convertible.find(u=>u.id===conversion.from_unit)){// Find the unit details\nconst unit=allUnits.find(u=>u.id===conversion.from_unit);if(unit){convertible.push({id:unit.id,name:unit.name,symbol:unit.symbol,is_base_unit:unit.is_base_unit});}}});setConvertibleUnits(convertible);}catch(err){console.error('Failed to fetch convertible units:',err);setConvertibleUnits([]);}}else{setConvertibleUnits([]);}};fetchConvertibleUnits();},[formData.base_unit,allUnits]);// Update form data when product changes (for editing)\nuseEffect(()=>{if(product){var _product$base_unit4,_product$is_active2;setFormData({name:product.name||'',description:product.description||'',category:product.category||'',tax_class:product.tax_class||'',sku:product.sku||'',price:product.price||'',cost_price:product.cost_price||'',stock_quantity:product.stock_quantity||0,min_stock_level:product.min_stock_level||10,max_stock_level:product.max_stock_level||1000,base_unit:((_product$base_unit4=product.base_unit)===null||_product$base_unit4===void 0?void 0:_product$base_unit4.id)||product.base_unit||'',is_active:(_product$is_active2=product.is_active)!==null&&_product$is_active2!==void 0?_product$is_active2:true});}},[product]);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const handleChange=e=>{const{name,value,type,checked}=e.target;setFormData(_objectSpread(_objectSpread({},formData),{},{[name]:type==='checkbox'?checked:value}));};const addCompatibleUnit=async unitId=>{if(!product)return;// Check if the unit is already added\nconst alreadyAdded=compatibleUnits.some(cu=>cu.unit===parseInt(unitId));if(alreadyAdded){alert('This unit is already added as a compatible unit.');return;}try{// Check if this is the base unit\nconst isBaseUnit=parseInt(unitId)===parseInt(formData.base_unit);const response=await api.post(\"/products/\".concat(product.id,\"/units/\"),{unit:parseInt(unitId),is_default:isBaseUnit,// Set base unit as default if it's the base unit\nis_active:true});setCompatibleUnits([...compatibleUnits,response.data]);setShowUnitSelector(false);if(isBaseUnit){console.log('Base unit added as compatible unit and set as default');}}catch(err){var _err$response,_err$response$data;console.error('Failed to add compatible unit:',err);alert(\"Failed to add compatible unit: \".concat(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||err.message));}};const removeCompatibleUnit=async productUnitId=>{var _product$base_unit5,_unitToRemove$unit;if(!product)return;// Find the unit to be removed\nconst unitToRemove=compatibleUnits.find(cu=>cu.id===productUnitId);// Prevent removing the base unit\nconst baseUnitId=((_product$base_unit5=product.base_unit)===null||_product$base_unit5===void 0?void 0:_product$base_unit5.id)||product.base_unit;if(unitToRemove&&(((_unitToRemove$unit=unitToRemove.unit)===null||_unitToRemove$unit===void 0?void 0:_unitToRemove$unit.id)===baseUnitId||unitToRemove.unit===baseUnitId)){alert('Cannot remove the base unit from compatible units. The base unit must always be available.');return;}try{await api.delete(\"/products/\".concat(product.id,\"/units/\").concat(productUnitId,\"/\"));setCompatibleUnits(compatibleUnits.filter(cu=>cu.id!==productUnitId));}catch(err){console.error('Failed to remove compatible unit:',err);}};const setDefaultUnit=async productUnitId=>{if(!product)return;try{// First, set all units to non-default\nfor(const cu of compatibleUnits){if(cu.is_default){await api.put(\"/products/\".concat(product.id,\"/units/\").concat(cu.id,\"/\"),_objectSpread(_objectSpread({},cu),{},{is_default:false}));}}// Then set the selected unit as default\nconst unitToUpdate=compatibleUnits.find(cu=>cu.id===productUnitId);if(unitToUpdate){await api.put(\"/products/\".concat(product.id,\"/units/\").concat(productUnitId,\"/\"),_objectSpread(_objectSpread({},unitToUpdate),{},{is_default:true}));// Update local state\nsetCompatibleUnits(compatibleUnits.map(cu=>_objectSpread(_objectSpread({},cu),{},{is_default:cu.id===productUnitId})));// Note: Display unit functionality removed - default unit selection handles this\n}}catch(err){console.error('Failed to set default unit:',err);}};const handleSubmit=async e=>{e.preventDefault();setLoading(true);setError('');try{// Use form data directly\nlet finalFormData=_objectSpread({},formData);// Prepare data for submission\nconst submitData=_objectSpread(_objectSpread({},finalFormData),{},{base_unit:finalFormData.base_unit?parseInt(finalFormData.base_unit):null});console.log('Submitting data:',submitData);console.log('Original form data:',formData);if(product){await api.put(\"/products/\".concat(product.id,\"/\"),submitData);}else{await api.post('/products/',submitData);}onSave();}catch(err){var _err$response2,_err$response2$data;setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.detail)||'Failed to save product');console.error('Save error:',err);}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"modal-overlay\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:product?'Edit Product':'Add Product'}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:onClose,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"modal-form\",children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Product Name *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",value:formData.name,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"SKU *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"sku\",value:formData.sku,onChange:handleChange,required:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Description\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"description\",value:formData.description,onChange:handleChange,rows:\"3\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Category *\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"category\",value:formData.category,onChange:handleChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select Category\"}),categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category.id,children:category.name},category.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Tax Class\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"tax_class\",value:formData.tax_class,onChange:handleChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"No Tax Class\"}),taxClasses.map(taxClass=>/*#__PURE__*/_jsxs(\"option\",{value:taxClass.id,children:[taxClass.name,\" (\",taxClass.tax_rate,\"%)\"]},taxClass.id))]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Base Unit\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"base_unit\",value:formData.base_unit,onChange:handleChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select Base Unit\"}),units.map(unit=>/*#__PURE__*/_jsxs(\"option\",{value:unit.id,children:[unit.name,\" (\",unit.symbol,\")\"]},unit.id))]})]})}),product&&/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Compatible Units\"}),/*#__PURE__*/_jsx(\"p\",{className:\"compatible-units-note\",children:\"Only units that can be converted to/from the base unit can be added as compatible units. The base unit is always included and cannot be removed.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"compatible-units-section\",children:[compatibleUnits.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"compatible-units-list\",children:compatibleUnits.map(compatibleUnit=>{var _product$base_unit6,_compatibleUnit$unit,_compatibleUnit$unit2,_compatibleUnit$unit3;const baseUnitId=((_product$base_unit6=product.base_unit)===null||_product$base_unit6===void 0?void 0:_product$base_unit6.id)||product.base_unit;const isBaseUnit=((_compatibleUnit$unit=compatibleUnit.unit)===null||_compatibleUnit$unit===void 0?void 0:_compatibleUnit$unit.id)===baseUnitId||compatibleUnit.unit===baseUnitId;return/*#__PURE__*/_jsxs(\"div\",{className:\"compatible-unit-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"unit-info\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"unit-name\",children:[((_compatibleUnit$unit2=compatibleUnit.unit)===null||_compatibleUnit$unit2===void 0?void 0:_compatibleUnit$unit2.name)||compatibleUnit.unit_name,\" (\",((_compatibleUnit$unit3=compatibleUnit.unit)===null||_compatibleUnit$unit3===void 0?void 0:_compatibleUnit$unit3.symbol)||compatibleUnit.unit_symbol,\")\"]}),compatibleUnit.is_default&&/*#__PURE__*/_jsx(\"span\",{className:\"default-badge\",children:\"Default\"}),isBaseUnit&&/*#__PURE__*/_jsx(\"span\",{className:\"base-badge\",children:\"Base Unit\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"unit-actions\",children:[!compatibleUnit.is_default&&/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outline\",onClick:()=>setDefaultUnit(compatibleUnit.id),children:\"Set Default\"}),!isBaseUnit&&/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"danger\",onClick:()=>removeCompatibleUnit(compatibleUnit.id),children:\"Remove\"}),isBaseUnit&&/*#__PURE__*/_jsx(\"span\",{className:\"base-unit-note\",children:\"Cannot remove base unit\"})]})]},compatibleUnit.id);})}):/*#__PURE__*/_jsx(\"p\",{className:\"no-units-message\",children:\"No compatible units added yet.\"}),/*#__PURE__*/_jsxs(Button,{type:\"button\",variant:\"outline\",onClick:()=>setShowUnitSelector(true),className:\"add-unit-button\",disabled:!formData.base_unit||convertibleUnits.filter(unit=>{const isAlreadyAdded=compatibleUnits.some(cu=>cu.unit===unit.id);const isBaseUnit=unit.id===parseInt(formData.base_unit);return!isAlreadyAdded&&!isBaseUnit;}).length===0,children:[\"+ Add Compatible Unit\",!formData.base_unit&&\" (Select base unit first)\",formData.base_unit&&convertibleUnits.filter(unit=>{const isAlreadyAdded=compatibleUnits.some(cu=>cu.unit===unit.id);const isBaseUnit=unit.id===parseInt(formData.base_unit);return!isAlreadyAdded&&!isBaseUnit;}).length===0&&\" (No convertible units)\"]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Price *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",name:\"price\",value:formData.price,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Cost Price\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",name:\"cost_price\",value:formData.cost_price,onChange:handleChange})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Stock Quantity\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"stock_quantity\",value:formData.stock_quantity,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Min Stock Level\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"min_stock_level\",value:formData.min_stock_level,onChange:handleChange})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Max Stock Level\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"max_stock_level\",value:formData.max_stock_level,onChange:handleChange})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",name:\"is_active\",checked:formData.is_active,onChange:handleChange}),\"Active\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:onClose,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",loading:loading,children:product?'Update':'Create'})]})]})]}),showUnitSelector&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content unit-selector-modal\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Add Compatible Unit\"}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:()=>setShowUnitSelector(false),children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Select a unit to add as compatible for this product:\"}),/*#__PURE__*/_jsx(\"p\",{className:\"unit-selector-note\",children:\"Only units that can be converted to/from the base unit are shown.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"unit-selector-list\",children:[convertibleUnits.filter(unit=>{const isAlreadyAdded=compatibleUnits.some(cu=>cu.unit===unit.id);const isBaseUnit=unit.id===parseInt(formData.base_unit);return!isAlreadyAdded&&!isBaseUnit;}).map(unit=>/*#__PURE__*/_jsx(\"div\",{className:\"unit-selector-item\",onClick:()=>addCompatibleUnit(unit.id),children:/*#__PURE__*/_jsxs(\"div\",{className:\"unit-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"unit-name\",children:unit.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"unit-symbol\",children:[\"(\",unit.symbol,\")\"]}),unit.is_base_unit&&/*#__PURE__*/_jsx(\"span\",{className:\"base-unit-badge\",children:\"Base Unit\"})]})},unit.id)),convertibleUnits.filter(unit=>!compatibleUnits.some(cu=>cu.unit===unit.id)&&unit.id!==parseInt(formData.base_unit)).length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"no-units-available\",children:formData.base_unit?\"No convertible units available for the selected base unit.\":\"Please select a base unit first.\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-actions\",children:/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:()=>setShowUnitSelector(false),children:\"Cancel\"})})]})})]});};export default Inventory;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useAuth","api","Table","Button","PrintButton","jsx","_jsx","jsxs","_jsxs","Inventory","user","products","setProducts","categories","setCategories","taxClasses","setTaxClasses","loading","setLoading","error","setError","showAddModal","setShowAddModal","editingProduct","setEditingProduct","filters","setFilters","category","stockStatus","search","fetchProducts","fetchCategories","fetchTaxClasses","filterParams","arguments","length","undefined","params","URLSearchParams","append","is_active","stock_quantity","url","concat","toString","response","get","data","results","filter","product","is_low_stock","err","console","handleAddProduct","handleEditProduct","id","handleDeleteProduct","window","confirm","name","delete","handleFilterChange","filterType","value","newFilters","_objectSpread","apiParams","clearFilters","clearedFilters","columns","key","header","render","row","children","className","sku","is_out_of_stock","unit","stock_in_units","stockUnit","is_base_unit","map","quantity","unit_symbol","unit_id","parseFloat","toFixed","size","variant","onClick","role","user_name","username","user_id","print_timestamp","Date","toISOString","print_id","now","Math","random","substr","title","type","printText","onChange","e","target","placeholder","emptyMessage","ProductModal","onClose","onSave","_ref","_product$base_unit","_product$is_active","formData","setFormData","description","tax_class","price","cost_price","min_stock_level","max_stock_level","base_unit","units","setUnits","allUnits","setAllUnits","compatibleUnits","setCompatibleUnits","showUnitSelector","setShowUnitSelector","convertibleUnits","setConvertibleUnits","fetchUnits","log","baseUnitsResponse","baseUnits","allUnitsData","nextUrl","next","allConversions","addBaseUnitToCompatibleUnits","_product$base_unit2","baseUnitId","post","is_default","prev","baseUnitData","find","u","compatible_units","_product$base_unit3","updatedCompatibleUnits","hasBaseUnit","some","cu","_cu$unit","fetchConvertibleUnits","conversions","parseInt","convertible","forEach","conversion","from_unit","to_unit","push","symbol","_product$base_unit4","_product$is_active2","handleChange","checked","addCompatibleUnit","unitId","alreadyAdded","alert","isBaseUnit","_err$response","_err$response$data","detail","message","removeCompatibleUnit","productUnitId","_product$base_unit5","_unitToRemove$unit","unitToRemove","setDefaultUnit","put","unitToUpdate","handleSubmit","preventDefault","finalFormData","submitData","_err$response2","_err$response2$data","onSubmit","required","rows","taxClass","tax_rate","compatibleUnit","_product$base_unit6","_compatibleUnit$unit","_compatibleUnit$unit2","_compatibleUnit$unit3","unit_name","disabled","isAlreadyAdded","step"],"sources":["/home/el-ifran/WareHouse_Manager/beverage_management_system/src/pages/Inventory.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport api from '../services/api';\nimport Table from '../components/Table';\nimport Button from '../components/Button';\nimport PrintButton from '../components/PrintButton';\nimport './Inventory.css';\n\nconst Inventory = () => {\n  const { user } = useAuth();\n  const [products, setProducts] = useState([]);\n  const [categories, setCategories] = useState([]);\n  const [taxClasses, setTaxClasses] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [showAddModal, setShowAddModal] = useState(false);\n  const [editingProduct, setEditingProduct] = useState(null);\n  const [filters, setFilters] = useState({\n    category: '',\n    stockStatus: '',\n    search: ''\n  });\n\n  useEffect(() => {\n    fetchProducts();\n    fetchCategories();\n    fetchTaxClasses();\n  }, []);\n\n  const fetchProducts = async (filterParams = {}) => {\n    try {\n      setLoading(true);\n      const params = new URLSearchParams();\n      \n      // Add filters to params\n      if (filterParams.category) params.append('category', filterParams.category);\n      if (filterParams.search) params.append('search', filterParams.search);\n      if (filterParams.is_active !== undefined) params.append('is_active', filterParams.is_active);\n      if (filterParams.stock_quantity !== undefined) params.append('stock_quantity', filterParams.stock_quantity);\n      \n      const url = `/products/${params.toString() ? '?' + params.toString() : ''}`;\n      const response = await api.get(url);\n      let products = response.data.results || response.data;\n      \n      // Handle low stock filter on frontend since it's a calculated field\n      if (filterParams.stockStatus === 'low') {\n        products = products.filter(product => product.is_low_stock);\n      }\n      \n      setProducts(products);\n    } catch (err) {\n      setError('Failed to load products');\n      console.error('Products error:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchCategories = async () => {\n    try {\n      const response = await api.get('/products/categories/');\n      setCategories(response.data.results || response.data);\n    } catch (err) {\n      console.error('Categories error:', err);\n    }\n  };\n\n  const fetchTaxClasses = async () => {\n    try {\n      const response = await api.get('/products/tax-classes/');\n      setTaxClasses(response.data.results || response.data);\n    } catch (err) {\n      console.error('Tax classes error:', err);\n    }\n  };\n\n  const handleAddProduct = () => {\n    setEditingProduct(null);\n    setShowAddModal(true);\n  };\n\n  const handleEditProduct = async (product) => {\n    try {\n      // Fetch full product details including cost_price and category ID\n      const response = await api.get(`/products/${product.id}/`);\n      setEditingProduct(response.data);\n      setShowAddModal(true);\n    } catch (err) {\n      setError('Failed to load product details');\n      console.error('Product details error:', err);\n    }\n  };\n\n  const handleDeleteProduct = async (product) => {\n    if (window.confirm(`Are you sure you want to delete ${product.name}?`)) {\n      try {\n        await api.delete(`/products/${product.id}/`);\n        fetchProducts(filters);\n      } catch (err) {\n        setError('Failed to delete product');\n        console.error('Delete error:', err);\n      }\n    }\n  };\n\n  const handleFilterChange = (filterType, value) => {\n    const newFilters = { ...filters, [filterType]: value };\n    setFilters(newFilters);\n    \n    // Convert stock status filter to API parameters\n    const apiParams = { ...newFilters };\n    if (newFilters.stockStatus === 'out') {\n      // For out of stock, filter by stock_quantity = 0\n      apiParams.stock_quantity = 0;\n    }\n    \n    fetchProducts(apiParams);\n  };\n\n  const clearFilters = () => {\n    const clearedFilters = { category: '', stockStatus: '', search: '' };\n    setFilters(clearedFilters);\n    fetchProducts(clearedFilters);\n  };\n\n  const columns = [\n    {\n      key: 'name',\n      header: 'Product Name',\n      render: (value, row) => (\n        <div>\n          <div className=\"product-name\">{value}</div>\n          <div className=\"product-sku\">{row.sku}</div>\n        </div>\n      )\n    },\n    {\n      key: 'category_name',\n      header: 'Category'\n    },\n    {\n      key: 'stock_quantity',\n      header: 'Stock',\n      render: (value, row) => (\n        <div className={`stock-quantity ${row.is_low_stock ? 'low-stock' : ''} ${row.is_out_of_stock ? 'out-of-stock' : ''}`}>\n          {/* Base unit stock */}\n          <div className=\"base-stock\">\n          {value} {row.unit}\n          {row.is_low_stock && <span className=\"stock-warning\">Low</span>}\n          {row.is_out_of_stock && <span className=\"stock-warning\">Out</span>}\n          </div>\n          \n          {/* Stock in other units */}\n          {row.stock_in_units && row.stock_in_units.length > 1 && (\n            <div className=\"stock-in-units\">\n              {row.stock_in_units\n                .filter(stockUnit => !stockUnit.is_base_unit)\n                .map(stockUnit => (\n                  <div key={stockUnit.unit_id} className=\"unit-stock\">\n                    {stockUnit.quantity} {stockUnit.unit_symbol}\n                  </div>\n                ))\n              }\n            </div>\n          )}\n        </div>\n      )\n    },\n    {\n      key: 'price',\n      header: 'Price',\n      render: (value) => `${parseFloat(value).toFixed(2)} MGA`\n    },\n    {\n      key: 'actions',\n      header: 'Actions',\n      render: (value, row) => (\n        <div className=\"action-buttons\">\n          <Button\n            size=\"small\"\n            variant=\"outline\"\n            onClick={() => handleEditProduct(row)}\n          >\n            Edit\n          </Button>\n          {user?.role === 'admin' && (\n            <Button\n              size=\"small\"\n              variant=\"danger\"\n              onClick={() => handleDeleteProduct(row)}\n            >\n              Delete\n            </Button>\n          )}\n        </div>\n      )\n    }\n  ];\n\n  return (\n    <div className=\"inventory\">\n      <div className=\"inventory-header\">\n        <h1>Inventory Management</h1>\n        <div className=\"header-actions\">\n          <PrintButton\n            data={{\n              ...products,\n              user_name: user?.username || 'Unknown User',\n              user_id: user?.id || 'unknown',\n              print_timestamp: new Date().toISOString(),\n              print_id: `PRINT-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n            }}\n            title=\"Inventory Report\"\n            type=\"inventory\"\n            printText=\"Print Inventory\"\n            className=\"print-inventory-btn\"\n          />\n        <Button onClick={handleAddProduct}>\n          Add Product\n        </Button>\n        </div>\n      </div>\n\n      {error && (\n        <div className=\"error-message\">\n          {error}\n        </div>\n      )}\n\n      <div className=\"inventory-filters\">\n        <div className=\"filter-group\">\n          <label>Category:</label>\n          <select \n            value={filters.category} \n            onChange={(e) => handleFilterChange('category', e.target.value)}\n          >\n            <option value=\"\">All Categories</option>\n            {categories.map(category => (\n              <option key={category.id} value={category.id}>\n                {category.name}\n              </option>\n            ))}\n          </select>\n        </div>\n        <div className=\"filter-group\">\n          <label>Stock Status:</label>\n          <select \n            value={filters.stockStatus} \n            onChange={(e) => handleFilterChange('stockStatus', e.target.value)}\n          >\n            <option value=\"\">All</option>\n            <option value=\"low\">Low Stock</option>\n            <option value=\"out\">Out of Stock</option>\n          </select>\n        </div>\n        <div className=\"filter-group\">\n          <label>Search:</label>\n          <input\n            type=\"text\"\n            placeholder=\"Search products...\"\n            value={filters.search}\n            onChange={(e) => handleFilterChange('search', e.target.value)}\n          />\n        </div>\n        <div className=\"filter-group\">\n          <Button variant=\"outline\" size=\"small\" onClick={clearFilters}>\n            Clear Filters\n          </Button>\n        </div>\n      </div>\n\n      <Table\n        data={products}\n        columns={columns}\n        loading={loading}\n        emptyMessage=\"No products found\"\n      />\n\n      {showAddModal && (\n        <ProductModal\n          product={editingProduct}\n          categories={categories}\n          taxClasses={taxClasses}\n          onClose={() => setShowAddModal(false)}\n          onSave={() => {\n            setShowAddModal(false);\n            fetchProducts(filters);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nconst ProductModal = ({ product, categories, taxClasses, onClose, onSave }) => {\n  const [formData, setFormData] = useState({\n    name: product?.name || '',\n    description: product?.description || '',\n    category: product?.category || '',\n    tax_class: product?.tax_class || '',\n    sku: product?.sku || '',\n    price: product?.price || '',\n    cost_price: product?.cost_price || '',\n    stock_quantity: product?.stock_quantity || 0,\n    min_stock_level: product?.min_stock_level || 10,\n    max_stock_level: product?.max_stock_level || 1000,\n    base_unit: product?.base_unit?.id || product?.base_unit || '',\n    is_active: product?.is_active ?? true\n  });\n  const [units, setUnits] = useState([]);\n  const [allUnits, setAllUnits] = useState([]);\n  const [compatibleUnits, setCompatibleUnits] = useState([]);\n  const [showUnitSelector, setShowUnitSelector] = useState(false);\n  const [convertibleUnits, setConvertibleUnits] = useState([]);\n\n\n\n  // Load base units when component mounts (for product creation/editing)\n  useEffect(() => {\n    const fetchUnits = async () => {\n      try {\n        console.log('=== FETCHING UNITS ===');\n        \n        // Fetch base units\n        const baseUnitsResponse = await api.get('/products/base-units/');\n        console.log('Base units response:', baseUnitsResponse.data);\n        const baseUnits = baseUnitsResponse.data.results || baseUnitsResponse.data;\n        setUnits(baseUnits);\n        console.log('Setting base units:', baseUnits);\n        \n        // Fetch ALL units with pagination\n        let allUnitsData = [];\n        let nextUrl = '/products/units/';\n        while (nextUrl) {\n          const response = await api.get(nextUrl);\n          const data = response.data;\n          allUnitsData = allUnitsData.concat(data.results || data);\n          nextUrl = data.next;\n          console.log('Fetched page, total units so far:', allUnitsData.length);\n        }\n        \n        console.log('All units fetched:', allUnitsData);\n        setAllUnits(allUnitsData);\n        \n        // Handle pagination for conversions\n        let allConversions = [];\n        nextUrl = '/products/unit-conversions/';\n        while (nextUrl) {\n          const response = await api.get(nextUrl);\n          const data = response.data;\n          allConversions = allConversions.concat(data.results || data);\n          nextUrl = data.next;\n        }\n        console.log('Unit conversions loaded:', allConversions.length);\n        console.log('=== UNITS LOADED ===');\n      } catch (err) {\n        console.error('Failed to load units:', err);\n      }\n    };\n    fetchUnits();\n  }, []);\n\n  // Function to automatically add base unit as compatible unit\n  const addBaseUnitToCompatibleUnits = useCallback(async () => {\n    if (!product) return;\n    \n    const baseUnitId = product.base_unit?.id || product.base_unit;\n    if (!baseUnitId) return;\n    \n    try {\n      console.log('Auto-adding base unit to compatible units in database...');\n      const response = await api.post(`/products/${product.id}/units/`, {\n        unit: baseUnitId,\n        is_default: true, // Set base unit as default\n        is_active: true\n      });\n      \n      console.log('Base unit added to database:', response.data);\n      \n      // Update local state\n      setCompatibleUnits(prev => [response.data, ...prev]);\n      \n    } catch (err) {\n      console.error('Failed to auto-add base unit:', err);\n      // Fallback: add to frontend only\n      const baseUnitData = {\n        id: `temp_base_${baseUnitId}`,\n        unit: allUnits.find(u => u.id === baseUnitId) || { id: baseUnitId },\n        is_default: true,\n        is_active: true,\n        is_base_unit: true\n      };\n      setCompatibleUnits(prev => [baseUnitData, ...prev]);\n    }\n  }, [product, allUnits]);\n\n  // Load compatible units when editing a product\n  useEffect(() => {\n    if (product && product.compatible_units) {\n      let updatedCompatibleUnits = [...product.compatible_units];\n      \n      // Ensure base unit is always in compatible units\n      const baseUnitId = product.base_unit?.id || product.base_unit;\n      const hasBaseUnit = updatedCompatibleUnits.some(cu => \n        cu.unit?.id === baseUnitId || cu.unit === baseUnitId\n      );\n      \n      if (!hasBaseUnit && baseUnitId) {\n        console.log('Base unit missing from compatible units, auto-adding...');\n        // Automatically add base unit to database\n        addBaseUnitToCompatibleUnits();\n      } else {\n        setCompatibleUnits(updatedCompatibleUnits);\n      }\n      \n    } else {\n      setCompatibleUnits([]);\n    }\n  }, [product, allUnits, addBaseUnitToCompatibleUnits]);\n\n\n  // Debug: Monitor formData changes\n  useEffect(() => {\n    console.log('FormData changed:', formData);\n  }, [formData]);\n\n  // Debug: Monitor allUnits changes\n  useEffect(() => {\n    console.log('AllUnits changed:', allUnits);\n  }, [allUnits]);\n\n  // Debug: Monitor units changes\n  useEffect(() => {\n    console.log('Units changed:', units);\n  }, [units]);\n\n  // Fetch convertible units when base unit changes\n  useEffect(() => {\n    const fetchConvertibleUnits = async () => {\n      if (formData.base_unit) {\n        try {\n          // Use a unified approach for both new and existing products\n          // Get all unit conversions and find units that can be converted to/from the base unit\n          // Handle pagination to get all conversions\n          let allConversions = [];\n          let nextUrl = '/products/unit-conversions/';\n          \n          while (nextUrl) {\n            const response = await api.get(nextUrl);\n            const data = response.data;\n            allConversions = allConversions.concat(data.results || data);\n            nextUrl = data.next; // Next page URL\n          }\n          \n          const conversions = allConversions;\n          \n          const baseUnitId = parseInt(formData.base_unit);\n          const convertible = [];\n          \n          // Find units that have conversions with the base unit\n          conversions.forEach(conversion => {\n            if (conversion.from_unit === baseUnitId && !convertible.find(u => u.id === conversion.to_unit)) {\n              // Find the unit details\n              const unit = allUnits.find(u => u.id === conversion.to_unit);\n              if (unit) {\n                convertible.push({\n                  id: unit.id,\n                  name: unit.name,\n                  symbol: unit.symbol,\n                  is_base_unit: unit.is_base_unit\n                });\n              }\n            } else if (conversion.to_unit === baseUnitId && !convertible.find(u => u.id === conversion.from_unit)) {\n              // Find the unit details\n              const unit = allUnits.find(u => u.id === conversion.from_unit);\n              if (unit) {\n                convertible.push({\n                  id: unit.id,\n                  name: unit.name,\n                  symbol: unit.symbol,\n                  is_base_unit: unit.is_base_unit\n                });\n              }\n            }\n          });\n          \n          setConvertibleUnits(convertible);\n        } catch (err) {\n          console.error('Failed to fetch convertible units:', err);\n          setConvertibleUnits([]);\n        }\n      } else {\n        setConvertibleUnits([]);\n      }\n    };\n\n    fetchConvertibleUnits();\n  }, [formData.base_unit, allUnits]);\n\n  // Update form data when product changes (for editing)\n  useEffect(() => {\n    if (product) {\n      setFormData({\n        name: product.name || '',\n        description: product.description || '',\n        category: product.category || '',\n        tax_class: product.tax_class || '',\n        sku: product.sku || '',\n        price: product.price || '',\n        cost_price: product.cost_price || '',\n        stock_quantity: product.stock_quantity || 0,\n        min_stock_level: product.min_stock_level || 10,\n        max_stock_level: product.max_stock_level || 1000,\n        base_unit: product.base_unit?.id || product.base_unit || '',\n        is_active: product.is_active ?? true\n      });\n    }\n  }, [product]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n\n\n\n  const handleChange = (e) => {\n    const { name, value, type, checked } = e.target;\n    setFormData({\n      ...formData,\n      [name]: type === 'checkbox' ? checked : value\n    });\n  };\n\n\n  const addCompatibleUnit = async (unitId) => {\n    if (!product) return;\n    \n    // Check if the unit is already added\n    const alreadyAdded = compatibleUnits.some(cu => cu.unit === parseInt(unitId));\n    if (alreadyAdded) {\n      alert('This unit is already added as a compatible unit.');\n      return;\n    }\n    \n    try {\n      // Check if this is the base unit\n      const isBaseUnit = parseInt(unitId) === parseInt(formData.base_unit);\n      \n      const response = await api.post(`/products/${product.id}/units/`, {\n        unit: parseInt(unitId),\n        is_default: isBaseUnit, // Set base unit as default if it's the base unit\n        is_active: true\n      });\n      \n      setCompatibleUnits([...compatibleUnits, response.data]);\n      setShowUnitSelector(false);\n      \n      if (isBaseUnit) {\n        console.log('Base unit added as compatible unit and set as default');\n      }\n    } catch (err) {\n      console.error('Failed to add compatible unit:', err);\n      alert(`Failed to add compatible unit: ${err.response?.data?.detail || err.message}`);\n    }\n  };\n\n  const removeCompatibleUnit = async (productUnitId) => {\n    if (!product) return;\n    \n    // Find the unit to be removed\n    const unitToRemove = compatibleUnits.find(cu => cu.id === productUnitId);\n    \n    // Prevent removing the base unit\n    const baseUnitId = product.base_unit?.id || product.base_unit;\n    if (unitToRemove && (unitToRemove.unit?.id === baseUnitId || unitToRemove.unit === baseUnitId)) {\n      alert('Cannot remove the base unit from compatible units. The base unit must always be available.');\n      return;\n    }\n    \n    try {\n      await api.delete(`/products/${product.id}/units/${productUnitId}/`);\n      setCompatibleUnits(compatibleUnits.filter(cu => cu.id !== productUnitId));\n    } catch (err) {\n      console.error('Failed to remove compatible unit:', err);\n    }\n  };\n\n  const setDefaultUnit = async (productUnitId) => {\n    if (!product) return;\n    \n    try {\n      // First, set all units to non-default\n      for (const cu of compatibleUnits) {\n        if (cu.is_default) {\n          await api.put(`/products/${product.id}/units/${cu.id}/`, {\n            ...cu,\n            is_default: false\n          });\n        }\n      }\n      \n      // Then set the selected unit as default\n      const unitToUpdate = compatibleUnits.find(cu => cu.id === productUnitId);\n      if (unitToUpdate) {\n        await api.put(`/products/${product.id}/units/${productUnitId}/`, {\n          ...unitToUpdate,\n          is_default: true\n        });\n        \n        // Update local state\n        setCompatibleUnits(compatibleUnits.map(cu => ({\n          ...cu,\n          is_default: cu.id === productUnitId\n        })));\n        \n        // Note: Display unit functionality removed - default unit selection handles this\n      }\n    } catch (err) {\n      console.error('Failed to set default unit:', err);\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      // Use form data directly\n      let finalFormData = { ...formData };\n\n      // Prepare data for submission\n      const submitData = {\n        ...finalFormData,\n        base_unit: finalFormData.base_unit ? parseInt(finalFormData.base_unit) : null\n      };\n\n      console.log('Submitting data:', submitData);\n      console.log('Original form data:', formData);\n\n      if (product) {\n        await api.put(`/products/${product.id}/`, submitData);\n      } else {\n        await api.post('/products/', submitData);\n      }\n      onSave();\n    } catch (err) {\n      setError(err.response?.data?.detail || 'Failed to save product');\n      console.error('Save error:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"modal-overlay\">\n      <div className=\"modal\">\n        <div className=\"modal-header\">\n          <h2>{product ? 'Edit Product' : 'Add Product'}</h2>\n          <button className=\"modal-close\" onClick={onClose}>×</button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"modal-form\">\n          {error && (\n            <div className=\"error-message\">\n              {error}\n            </div>\n          )}\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Product Name *</label>\n              <input\n                type=\"text\"\n                name=\"name\"\n                value={formData.name}\n                onChange={handleChange}\n                required\n              />\n            </div>\n            <div className=\"form-group\">\n              <label>SKU *</label>\n              <input\n                type=\"text\"\n                name=\"sku\"\n                value={formData.sku}\n                onChange={handleChange}\n                required\n              />\n            </div>\n          </div>\n\n          <div className=\"form-group\">\n            <label>Description</label>\n            <textarea\n              name=\"description\"\n              value={formData.description}\n              onChange={handleChange}\n              rows=\"3\"\n            />\n          </div>\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Category *</label>\n              <select\n                name=\"category\"\n                value={formData.category}\n                onChange={handleChange}\n                required\n              >\n                <option value=\"\">Select Category</option>\n                {categories.map(category => (\n                  <option key={category.id} value={category.id}>\n                    {category.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"form-group\">\n              <label>Tax Class</label>\n              <select\n                name=\"tax_class\"\n                value={formData.tax_class}\n                onChange={handleChange}\n              >\n                <option value=\"\">No Tax Class</option>\n                {taxClasses.map(taxClass => (\n                  <option key={taxClass.id} value={taxClass.id}>\n                    {taxClass.name} ({taxClass.tax_rate}%)\n                  </option>\n                ))}\n              </select>\n            </div>\n          </div>\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Base Unit</label>\n              <select\n                name=\"base_unit\"\n                value={formData.base_unit}\n                onChange={handleChange}\n                required\n              >\n                <option value=\"\">Select Base Unit</option>\n                {units.map(unit => (\n                  <option key={unit.id} value={unit.id}>\n                    {unit.name} ({unit.symbol})\n                  </option>\n                ))}\n              </select>\n            </div>\n            \n          </div>\n\n          {/* Compatible Units Section - Only show when editing existing product */}\n          {product && (\n            <div className=\"form-row\">\n              <div className=\"form-group\">\n                <label>Compatible Units</label>\n                <p className=\"compatible-units-note\">\n                  Only units that can be converted to/from the base unit can be added as compatible units. \n                  The base unit is always included and cannot be removed.\n                </p>\n                <div className=\"compatible-units-section\">\n                  {compatibleUnits.length > 0 ? (\n                    <div className=\"compatible-units-list\">\n                      {compatibleUnits.map(compatibleUnit => {\n                        const baseUnitId = product.base_unit?.id || product.base_unit;\n                        const isBaseUnit = compatibleUnit.unit?.id === baseUnitId || compatibleUnit.unit === baseUnitId;\n                        \n                        return (\n                          <div key={compatibleUnit.id} className=\"compatible-unit-item\">\n                            <div className=\"unit-info\">\n                              <span className=\"unit-name\">\n                                {compatibleUnit.unit?.name || compatibleUnit.unit_name} ({compatibleUnit.unit?.symbol || compatibleUnit.unit_symbol})\n                              </span>\n                              {compatibleUnit.is_default && (\n                                <span className=\"default-badge\">Default</span>\n                              )}\n                              {isBaseUnit && (\n                                <span className=\"base-badge\">Base Unit</span>\n                              )}\n                            </div>\n                            <div className=\"unit-actions\">\n                              {!compatibleUnit.is_default && (\n                                <Button\n                                  size=\"small\"\n                                  variant=\"outline\"\n                                  onClick={() => setDefaultUnit(compatibleUnit.id)}\n                                >\n                                  Set Default\n                                </Button>\n                              )}\n                              {!isBaseUnit && (\n                                <Button\n                                  size=\"small\"\n                                  variant=\"danger\"\n                                  onClick={() => removeCompatibleUnit(compatibleUnit.id)}\n                                >\n                                  Remove\n                                </Button>\n                              )}\n                              {isBaseUnit && (\n                                <span className=\"base-unit-note\">Cannot remove base unit</span>\n                              )}\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  ) : (\n                    <p className=\"no-units-message\">No compatible units added yet.</p>\n                  )}\n                  \n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setShowUnitSelector(true)}\n                    className=\"add-unit-button\"\n                    disabled={!formData.base_unit || convertibleUnits.filter(unit => {\n                      const isAlreadyAdded = compatibleUnits.some(cu => cu.unit === unit.id);\n                      const isBaseUnit = unit.id === parseInt(formData.base_unit);\n                      return !isAlreadyAdded && !isBaseUnit;\n                    }).length === 0}\n                  >\n                    + Add Compatible Unit\n                    {!formData.base_unit && \" (Select base unit first)\"}\n                    {formData.base_unit && convertibleUnits.filter(unit => {\n                      const isAlreadyAdded = compatibleUnits.some(cu => cu.unit === unit.id);\n                      const isBaseUnit = unit.id === parseInt(formData.base_unit);\n                      return !isAlreadyAdded && !isBaseUnit;\n                    }).length === 0 && \" (No convertible units)\"}\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Price *</label>\n              <input\n                type=\"number\"\n                step=\"0.01\"\n                name=\"price\"\n                value={formData.price}\n                onChange={handleChange}\n                required\n              />\n            </div>\n            <div className=\"form-group\">\n              <label>Cost Price</label>\n              <input\n                type=\"number\"\n                step=\"0.01\"\n                name=\"cost_price\"\n                value={formData.cost_price}\n                onChange={handleChange}\n              />\n            </div>\n          </div>\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Stock Quantity</label>\n              <input\n                type=\"number\"\n                name=\"stock_quantity\"\n                value={formData.stock_quantity}\n                onChange={handleChange}\n              />\n            </div>\n            <div className=\"form-group\">\n              <label>Min Stock Level</label>\n              <input\n                type=\"number\"\n                name=\"min_stock_level\"\n                value={formData.min_stock_level}\n                onChange={handleChange}\n              />\n            </div>\n          </div>\n\n          <div className=\"form-group\">\n            <label>Max Stock Level</label>\n            <input\n              type=\"number\"\n              name=\"max_stock_level\"\n              value={formData.max_stock_level}\n              onChange={handleChange}\n            />\n          </div>\n\n          <div className=\"form-group\">\n            <label>\n              <input\n                type=\"checkbox\"\n                name=\"is_active\"\n                checked={formData.is_active}\n                onChange={handleChange}\n              />\n              Active\n            </label>\n          </div>\n\n          <div className=\"modal-actions\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" loading={loading}>\n              {product ? 'Update' : 'Create'}\n            </Button>\n          </div>\n        </form>\n      </div>\n\n      {/* Unit Selector Modal */}\n      {showUnitSelector && (\n        <div className=\"modal-overlay\">\n          <div className=\"modal-content unit-selector-modal\">\n            <div className=\"modal-header\">\n              <h3>Add Compatible Unit</h3>\n              <button \n                className=\"modal-close\" \n                onClick={() => setShowUnitSelector(false)}\n              >\n                ×\n              </button>\n            </div>\n            <div className=\"modal-body\">\n              <p>Select a unit to add as compatible for this product:</p>\n              <p className=\"unit-selector-note\">\n                Only units that can be converted to/from the base unit are shown.\n              </p>\n              <div className=\"unit-selector-list\">\n                {convertibleUnits\n                  .filter(unit => {\n                    const isAlreadyAdded = compatibleUnits.some(cu => cu.unit === unit.id);\n                    const isBaseUnit = unit.id === parseInt(formData.base_unit);\n                    return !isAlreadyAdded && !isBaseUnit;\n                  })\n                  .map(unit => (\n                    <div \n                      key={unit.id} \n                      className=\"unit-selector-item\"\n                      onClick={() => addCompatibleUnit(unit.id)}\n                    >\n                      <div className=\"unit-info\">\n                        <span className=\"unit-name\">{unit.name}</span>\n                        <span className=\"unit-symbol\">({unit.symbol})</span>\n                        {unit.is_base_unit && (\n                          <span className=\"base-unit-badge\">Base Unit</span>\n                        )}\n                      </div>\n                    </div>\n                  ))\n                }\n                {convertibleUnits.filter(unit => \n                  !compatibleUnits.some(cu => cu.unit === unit.id) && unit.id !== parseInt(formData.base_unit)\n                ).length === 0 && (\n                  <p className=\"no-units-available\">\n                    {formData.base_unit \n                      ? \"No convertible units available for the selected base unit.\" \n                      : \"Please select a base unit first.\"\n                    }\n                  </p>\n                )}\n              </div>\n            </div>\n            <div className=\"modal-actions\">\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => setShowUnitSelector(false)}\n              >\n                Cancel\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Inventory;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}