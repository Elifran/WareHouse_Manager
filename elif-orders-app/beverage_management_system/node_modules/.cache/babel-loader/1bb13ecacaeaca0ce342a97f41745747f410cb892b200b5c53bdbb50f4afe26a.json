{"ast":null,"code":"import _objectSpread from\"/home/el-ifran/WareHouse_Manager/beverage_management_system/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import Button from'./Button';import PrintButton from'./PrintButton';import'./DeliveryModal.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DeliveryModal=_ref=>{let{purchaseOrder,action='create',onClose,onSubmit}=_ref;const[formData,setFormData]=useState({notes:'',items:((purchaseOrder===null||purchaseOrder===void 0?void 0:purchaseOrder.items)||[]).map(item=>{var _item$unit,_item$tax_class;return{purchase_order_item_id:item.id,product_id:item.product.id,quantity_received:item.quantity_ordered,unit_id:((_item$unit=item.unit)===null||_item$unit===void 0?void 0:_item$unit.id)||item.unit||'',unit_cost:item.unit_cost,tax_class_id:((_item$tax_class=item.tax_class)===null||_item$tax_class===void 0?void 0:_item$tax_class.id)||'',condition_notes:''};})});const[loading,setLoading]=useState(false);const handleInputChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleItemChange=(index,field,value)=>{setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{items:prev.items.map((item,i)=>i===index?_objectSpread(_objectSpread({},item),{},{[field]:value}):item)}));};const handleSubmit=async e=>{e.preventDefault();// Validate that at least one item has quantity > 0\nconst hasItems=formData.items.some(item=>item.quantity_received>0);if(!hasItems){alert('Please specify quantities for at least one item');return;}setLoading(true);try{// Convert data types to ensure proper API format\nconst deliveryData={purchase_order_id:parseInt(purchaseOrder.id),notes:formData.notes,items:formData.items.filter(item=>item.quantity_received>0).map(item=>_objectSpread(_objectSpread({},item),{},{purchase_order_item_id:parseInt(item.purchase_order_item_id),product_id:parseInt(item.product_id),quantity_received:parseInt(item.quantity_received),unit_id:item.unit_id?parseInt(item.unit_id):null,unit_cost:parseFloat(item.unit_cost),tax_class_id:item.tax_class_id?parseInt(item.tax_class_id):null}))};await onSubmit(deliveryData);}catch(error){console.error('Error submitting delivery:',error);}finally{setLoading(false);}};const calculateItemTotal=item=>{const quantity=parseFloat(item.quantity_received)||0;const unitCost=parseFloat(item.unit_cost)||0;return quantity*unitCost;};const calculateTaxAmount=item=>{var _purchaseOrder$items$;const lineTotal=calculateItemTotal(item);const taxClass=(_purchaseOrder$items$=purchaseOrder.items.find(poItem=>poItem.id===item.purchase_order_item_id))===null||_purchaseOrder$items$===void 0?void 0:_purchaseOrder$items$.tax_class;if(taxClass){return lineTotal*(taxClass.tax_rate/100);}return 0;};const calculateTotals=()=>{const subtotal=formData.items.reduce((sum,item)=>sum+calculateItemTotal(item),0);const taxAmount=formData.items.reduce((sum,item)=>sum+calculateTaxAmount(item),0);const total=subtotal+taxAmount;return{subtotal,taxAmount,total};};const totals=calculateTotals();return/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content delivery-modal\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:action==='create_and_archive'?'Create Delivery & Archive Order':'Create Delivery'}),/*#__PURE__*/_jsx(\"button\",{className:\"close-button\",onClick:onClose,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"delivery-info\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Purchase Order:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:purchaseOrder.order_number})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Supplier:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:purchaseOrder.supplier.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-row\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Order Date:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:new Date(purchaseOrder.order_date).toLocaleDateString()})]})]}),action==='create_and_archive'&&/*#__PURE__*/_jsxs(\"div\",{className:\"warning-message\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u2139\\uFE0F Information:\"}),\" This action will create a delivery and then archive the purchase order. The order will be preserved but marked as archived.\"]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"notes\",children:\"Delivery Notes\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"notes\",name:\"notes\",value:formData.notes,onChange:handleInputChange,rows:\"3\",placeholder:\"Notes about this delivery...\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Received Items\"}),/*#__PURE__*/_jsx(\"p\",{className:\"section-description\",children:\"Quantities are pre-filled with ordered amounts. Modify as needed based on what was actually received.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"items-list\",children:formData.items.map((item,index)=>{const originalItem=purchaseOrder.items.find(poItem=>poItem.id===item.purchase_order_item_id);return/*#__PURE__*/_jsxs(\"div\",{className:\"item-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-product\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Product\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"product-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"product-name\",children:originalItem.product.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"product-sku\",children:[\"SKU: \",originalItem.product.sku]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ordered-quantity\",children:[\"Ordered: \",originalItem.quantity_ordered,\" units\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-quantity\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Quantity Received *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",max:originalItem.quantity_ordered,value:item.quantity_received,onChange:e=>handleItemChange(index,'quantity_received',e.target.value),placeholder:\"Max: \".concat(originalItem.quantity_ordered),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-unit\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Unit\"}),/*#__PURE__*/_jsxs(\"select\",{value:item.unit_id,onChange:e=>{const unitId=e.target.value;handleItemChange(index,'unit_id',unitId);// Auto-set unit cost based on selected unit's price\nif(unitId){var _originalItem$product,_originalItem$product2;const selectedUnit=(_originalItem$product=originalItem.product)===null||_originalItem$product===void 0?void 0:(_originalItem$product2=_originalItem$product.compatible_units)===null||_originalItem$product2===void 0?void 0:_originalItem$product2.find(u=>{const unit=u.unit||u;const unitIdFromData=(unit===null||unit===void 0?void 0:unit.id)||unit;return unitIdFromData===parseInt(unitId);});if(selectedUnit){var _originalItem$product3;// Calculate unit price based on conversion factor\nlet unitPrice=((_originalItem$product3=originalItem.product)===null||_originalItem$product3===void 0?void 0:_originalItem$product3.price)||0;// If this is not the base unit, calculate converted price\nconst unit=selectedUnit.unit||selectedUnit;const isBaseUnit=(unit===null||unit===void 0?void 0:unit.is_base_unit)||selectedUnit.unit_is_base;if(!isBaseUnit){var _originalItem$product4,_originalItem$product5;// Find conversion factor from base unit to this unit\nconst stockInfo=(_originalItem$product4=originalItem.product)===null||_originalItem$product4===void 0?void 0:(_originalItem$product5=_originalItem$product4.stock_in_units)===null||_originalItem$product5===void 0?void 0:_originalItem$product5.find(s=>s.unit_id===parseInt(unitId));if(stockInfo){// Use the conversion factor from stock_in_units if available\nconst baseQuantity=originalItem.product.stock_quantity||1;const convertedQuantity=stockInfo.quantity||1;const conversionFactor=baseQuantity/convertedQuantity;unitPrice=parseFloat(originalItem.product.price)*conversionFactor;}else{var _originalItem$product6,_originalItem$product7;// Fallback: try to find conversion in available_units\nconst availableUnit=(_originalItem$product6=originalItem.product)===null||_originalItem$product6===void 0?void 0:(_originalItem$product7=_originalItem$product6.available_units)===null||_originalItem$product7===void 0?void 0:_originalItem$product7.find(au=>au.id===parseInt(unitId));if(availableUnit!==null&&availableUnit!==void 0&&availableUnit.conversion_factor){unitPrice=parseFloat(originalItem.product.price)*availableUnit.conversion_factor;}}}handleItemChange(index,'unit_cost',parseFloat(unitPrice).toFixed(2));}}},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select unit\"}),(_originalItem$product8=>{if(!((_originalItem$product8=originalItem.product)!==null&&_originalItem$product8!==void 0&&_originalItem$product8.compatible_units)||originalItem.product.compatible_units.length===0){return/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"No compatible units available\"});}return originalItem.product.compatible_units.map(compatibleUnit=>{var _originalItem$product9;// Handle both ProductUnit structure (with nested unit) and direct unit structure\nconst unit=compatibleUnit.unit||compatibleUnit;const unitId=(unit===null||unit===void 0?void 0:unit.id)||unit;// unit might be just an ID\nconst unitName=(unit===null||unit===void 0?void 0:unit.name)||compatibleUnit.unit_name;const unitSymbol=(unit===null||unit===void 0?void 0:unit.symbol)||compatibleUnit.unit_symbol;// If unit is just an ID, use the direct fields from compatibleUnit\nif(!unitName||!unitSymbol){console.warn('Invalid unit data:',compatibleUnit);return null;}// Calculate unit price based on conversion factor\nlet unitPrice=((_originalItem$product9=originalItem.product)===null||_originalItem$product9===void 0?void 0:_originalItem$product9.price)||0;// If this is not the base unit, calculate converted price\nif(!compatibleUnit.unit_is_base){var _originalItem$product0,_originalItem$product1;// Find conversion factor from base unit to this unit\nconst stockInfo=(_originalItem$product0=originalItem.product)===null||_originalItem$product0===void 0?void 0:(_originalItem$product1=_originalItem$product0.stock_in_units)===null||_originalItem$product1===void 0?void 0:_originalItem$product1.find(s=>s.unit_id===unitId);if(stockInfo){// Use the conversion factor from stock_in_units if available\nconst baseQuantity=originalItem.product.stock_quantity||1;const convertedQuantity=stockInfo.quantity||1;const conversionFactor=baseQuantity/convertedQuantity;unitPrice=parseFloat(originalItem.product.price)*conversionFactor;}else{var _originalItem$product10,_originalItem$product11;// Fallback: try to find conversion in available_units\nconst availableUnit=(_originalItem$product10=originalItem.product)===null||_originalItem$product10===void 0?void 0:(_originalItem$product11=_originalItem$product10.available_units)===null||_originalItem$product11===void 0?void 0:_originalItem$product11.find(au=>au.id===unitId);if(availableUnit!==null&&availableUnit!==void 0&&availableUnit.conversion_factor){unitPrice=parseFloat(originalItem.product.price)*availableUnit.conversion_factor;}}}return/*#__PURE__*/_jsxs(\"option\",{value:unitId,children:[unitName,\" (\",unitSymbol,\") - \",parseFloat(unitPrice).toFixed(2),\" MGA\"]},unitId);}).filter(Boolean);})()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-cost\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Unit Cost *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",step:\"0.01\",value:item.unit_cost,onChange:e=>handleItemChange(index,'unit_cost',e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-total\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Line Total\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"total-display\",children:[calculateItemTotal(item).toFixed(2),\" MGA\",originalItem.tax_class&&/*#__PURE__*/_jsxs(\"span\",{className:\"tax-amount\",children:[\"+ \",calculateTaxAmount(item).toFixed(2),\" MGA tax\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-condition\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Condition Notes\"}),/*#__PURE__*/_jsx(\"textarea\",{value:item.condition_notes,onChange:e=>handleItemChange(index,'condition_notes',e.target.value),rows:\"2\",placeholder:\"Notes about item condition...\"})]})]},index);})})]}),formData.items.some(item=>item.quantity_received>0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"totals-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"totals-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Subtotal:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[totals.subtotal.toFixed(2),\" MGA\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"totals-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Tax Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[totals.taxAmount.toFixed(2),\" MGA\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"totals-row total-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[totals.total.toFixed(2),\" MGA\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"footer-left\",children:/*#__PURE__*/_jsx(PrintButton,{data:_objectSpread(_objectSpread({},purchaseOrder),{},{items:formData.items.map(item=>{var _purchaseOrder$items,_purchaseOrder$items$2,_purchaseOrder$items$3,_purchaseOrder$items2,_purchaseOrder$items3,_purchaseOrder$items4,_purchaseOrder$items5,_purchaseOrder$items6,_purchaseOrder$items7,_purchaseOrder$items8,_purchaseOrder$items9;return _objectSpread(_objectSpread({},item),{},{product_name:purchaseOrder===null||purchaseOrder===void 0?void 0:(_purchaseOrder$items=purchaseOrder.items)===null||_purchaseOrder$items===void 0?void 0:(_purchaseOrder$items$2=_purchaseOrder$items.find(poItem=>poItem.id===item.purchase_order_item_id))===null||_purchaseOrder$items$2===void 0?void 0:(_purchaseOrder$items$3=_purchaseOrder$items$2.product)===null||_purchaseOrder$items$3===void 0?void 0:_purchaseOrder$items$3.name,product_sku:purchaseOrder===null||purchaseOrder===void 0?void 0:(_purchaseOrder$items2=purchaseOrder.items)===null||_purchaseOrder$items2===void 0?void 0:(_purchaseOrder$items3=_purchaseOrder$items2.find(poItem=>poItem.id===item.purchase_order_item_id))===null||_purchaseOrder$items3===void 0?void 0:(_purchaseOrder$items4=_purchaseOrder$items3.product)===null||_purchaseOrder$items4===void 0?void 0:_purchaseOrder$items4.sku,unit_name:purchaseOrder===null||purchaseOrder===void 0?void 0:(_purchaseOrder$items5=purchaseOrder.items)===null||_purchaseOrder$items5===void 0?void 0:(_purchaseOrder$items6=_purchaseOrder$items5.find(poItem=>poItem.id===item.purchase_order_item_id))===null||_purchaseOrder$items6===void 0?void 0:(_purchaseOrder$items7=_purchaseOrder$items6.unit)===null||_purchaseOrder$items7===void 0?void 0:_purchaseOrder$items7.name,ordered_quantity:purchaseOrder===null||purchaseOrder===void 0?void 0:(_purchaseOrder$items8=purchaseOrder.items)===null||_purchaseOrder$items8===void 0?void 0:(_purchaseOrder$items9=_purchaseOrder$items8.find(poItem=>poItem.id===item.purchase_order_item_id))===null||_purchaseOrder$items9===void 0?void 0:_purchaseOrder$items9.quantity_ordered,delivered_quantity:item.quantity_received,status:item.quantity_received>0?'Delivered':'Pending'});})}),title:\"Delivery Receipt\",type:\"delivery\",printText:\"Print Receipt\",validateText:\"Validate & Print\",showValidateOption:true,onValidate:handleSubmit,disabled:!formData.items.some(item=>item.quantity_received>0)})}),/*#__PURE__*/_jsxs(\"div\",{className:\"footer-right\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"secondary\",onClick:onClose,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:action==='create_and_archive'?'primary':'primary',onClick:handleSubmit,disabled:loading||!formData.items.some(item=>item.quantity_received>0),children:loading?action==='create_and_archive'?'Creating & Archiving...':'Creating...':action==='create_and_archive'?'Create Delivery & Archive Order':'Create Delivery'})]})]})]})});};export default DeliveryModal;","map":{"version":3,"names":["React","useState","Button","PrintButton","jsx","_jsx","jsxs","_jsxs","DeliveryModal","_ref","purchaseOrder","action","onClose","onSubmit","formData","setFormData","notes","items","map","item","_item$unit","_item$tax_class","purchase_order_item_id","id","product_id","product","quantity_received","quantity_ordered","unit_id","unit","unit_cost","tax_class_id","tax_class","condition_notes","loading","setLoading","handleInputChange","e","name","value","target","prev","_objectSpread","handleItemChange","index","field","i","handleSubmit","preventDefault","hasItems","some","alert","deliveryData","purchase_order_id","parseInt","filter","parseFloat","error","console","calculateItemTotal","quantity","unitCost","calculateTaxAmount","_purchaseOrder$items$","lineTotal","taxClass","find","poItem","tax_rate","calculateTotals","subtotal","reduce","sum","taxAmount","total","totals","className","children","onClick","order_number","supplier","Date","order_date","toLocaleDateString","htmlFor","onChange","rows","placeholder","originalItem","sku","type","min","max","concat","required","unitId","_originalItem$product","_originalItem$product2","selectedUnit","compatible_units","u","unitIdFromData","_originalItem$product3","unitPrice","price","isBaseUnit","is_base_unit","unit_is_base","_originalItem$product4","_originalItem$product5","stockInfo","stock_in_units","s","baseQuantity","stock_quantity","convertedQuantity","conversionFactor","_originalItem$product6","_originalItem$product7","availableUnit","available_units","au","conversion_factor","toFixed","_originalItem$product8","length","compatibleUnit","_originalItem$product9","unitName","unit_name","unitSymbol","symbol","unit_symbol","warn","_originalItem$product0","_originalItem$product1","_originalItem$product10","_originalItem$product11","Boolean","step","data","_purchaseOrder$items","_purchaseOrder$items$2","_purchaseOrder$items$3","_purchaseOrder$items2","_purchaseOrder$items3","_purchaseOrder$items4","_purchaseOrder$items5","_purchaseOrder$items6","_purchaseOrder$items7","_purchaseOrder$items8","_purchaseOrder$items9","product_name","product_sku","ordered_quantity","delivered_quantity","status","title","printText","validateText","showValidateOption","onValidate","disabled","variant"],"sources":["/home/el-ifran/WareHouse_Manager/beverage_management_system/src/components/DeliveryModal.js"],"sourcesContent":["import React, { useState } from 'react';\nimport Button from './Button';\nimport PrintButton from './PrintButton';\nimport './DeliveryModal.css';\n\nconst DeliveryModal = ({ purchaseOrder, action = 'create', onClose, onSubmit }) => {\n  const [formData, setFormData] = useState({\n    notes: '',\n    items: (purchaseOrder?.items || []).map(item => ({\n      purchase_order_item_id: item.id,\n      product_id: item.product.id,\n      quantity_received: item.quantity_ordered,\n      unit_id: item.unit?.id || item.unit || '',\n      unit_cost: item.unit_cost,\n      tax_class_id: item.tax_class?.id || '',\n      condition_notes: ''\n    }))\n  });\n  const [loading, setLoading] = useState(false);\n\n\n  const handleInputChange = (e) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n\n  const handleItemChange = (index, field, value) => {\n    setFormData(prev => ({\n      ...prev,\n      items: prev.items.map((item, i) => \n        i === index ? { ...item, [field]: value } : item\n      )\n    }));\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    // Validate that at least one item has quantity > 0\n    const hasItems = formData.items.some(item => item.quantity_received > 0);\n    if (!hasItems) {\n      alert('Please specify quantities for at least one item');\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // Convert data types to ensure proper API format\n      const deliveryData = {\n        purchase_order_id: parseInt(purchaseOrder.id),\n        notes: formData.notes,\n        items: formData.items.filter(item => item.quantity_received > 0).map(item => ({\n          ...item,\n          purchase_order_item_id: parseInt(item.purchase_order_item_id),\n          product_id: parseInt(item.product_id),\n          quantity_received: parseInt(item.quantity_received),\n          unit_id: item.unit_id ? parseInt(item.unit_id) : null,\n          unit_cost: parseFloat(item.unit_cost),\n          tax_class_id: item.tax_class_id ? parseInt(item.tax_class_id) : null\n        }))\n      };\n      await onSubmit(deliveryData);\n    } catch (error) {\n      console.error('Error submitting delivery:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const calculateItemTotal = (item) => {\n    const quantity = parseFloat(item.quantity_received) || 0;\n    const unitCost = parseFloat(item.unit_cost) || 0;\n    return quantity * unitCost;\n  };\n\n  const calculateTaxAmount = (item) => {\n    const lineTotal = calculateItemTotal(item);\n    const taxClass = purchaseOrder.items.find(poItem => poItem.id === item.purchase_order_item_id)?.tax_class;\n    if (taxClass) {\n      return lineTotal * (taxClass.tax_rate / 100);\n    }\n    return 0;\n  };\n\n  const calculateTotals = () => {\n    const subtotal = formData.items.reduce((sum, item) => sum + calculateItemTotal(item), 0);\n    const taxAmount = formData.items.reduce((sum, item) => sum + calculateTaxAmount(item), 0);\n    const total = subtotal + taxAmount;\n    \n    return { subtotal, taxAmount, total };\n  };\n\n  const totals = calculateTotals();\n\n\n  return (\n    <div className=\"modal-overlay\">\n      <div className=\"modal-content delivery-modal\">\n        <div className=\"modal-header\">\n          <h2>\n            {action === 'create_and_archive' ? 'Create Delivery & Archive Order' : 'Create Delivery'}\n          </h2>\n          <button className=\"close-button\" onClick={onClose}>×</button>\n        </div>\n\n        <div className=\"delivery-info\">\n          <div className=\"info-row\">\n            <span className=\"label\">Purchase Order:</span>\n            <span className=\"value\">{purchaseOrder.order_number}</span>\n          </div>\n          <div className=\"info-row\">\n            <span className=\"label\">Supplier:</span>\n            <span className=\"value\">{purchaseOrder.supplier.name}</span>\n          </div>\n          <div className=\"info-row\">\n            <span className=\"label\">Order Date:</span>\n            <span className=\"value\">{new Date(purchaseOrder.order_date).toLocaleDateString()}</span>\n          </div>\n        </div>\n\n        {action === 'create_and_archive' && (\n          <div className=\"warning-message\">\n            <strong>ℹ️ Information:</strong> This action will create a delivery and then archive the purchase order. The order will be preserved but marked as archived.\n          </div>\n        )}\n\n        <form onSubmit={handleSubmit} className=\"modal-body\">\n          <div className=\"form-section\">\n            <div className=\"form-group\">\n              <label htmlFor=\"notes\">Delivery Notes</label>\n              <textarea\n                id=\"notes\"\n                name=\"notes\"\n                value={formData.notes}\n                onChange={handleInputChange}\n                rows=\"3\"\n                placeholder=\"Notes about this delivery...\"\n              />\n            </div>\n          </div>\n\n          <div className=\"form-section\">\n            <h3>Received Items</h3>\n            <p className=\"section-description\">\n              Quantities are pre-filled with ordered amounts. Modify as needed based on what was actually received.\n            </p>\n\n            <div className=\"items-list\">\n              {formData.items.map((item, index) => {\n                const originalItem = purchaseOrder.items.find(poItem => poItem.id === item.purchase_order_item_id);\n                return (\n                  <div key={index} className=\"item-row\">\n                    <div className=\"item-product\">\n                      <label>Product</label>\n                      <div className=\"product-info\">\n                        <div className=\"product-name\">{originalItem.product.name}</div>\n                        <div className=\"product-sku\">SKU: {originalItem.product.sku}</div>\n                        <div className=\"ordered-quantity\">\n                          Ordered: {originalItem.quantity_ordered} units\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"item-quantity\">\n                      <label>Quantity Received *</label>\n                      <input\n                        type=\"number\"\n                        min=\"0\"\n                        max={originalItem.quantity_ordered}\n                        value={item.quantity_received}\n                        onChange={(e) => handleItemChange(index, 'quantity_received', e.target.value)}\n                        placeholder={`Max: ${originalItem.quantity_ordered}`}\n                        required\n                      />\n                    </div>\n                    <div className=\"item-unit\">\n                      <label>Unit</label>\n                      <select\n                        value={item.unit_id}\n                        onChange={(e) => {\n                          const unitId = e.target.value;\n                          handleItemChange(index, 'unit_id', unitId);\n                          \n                          // Auto-set unit cost based on selected unit's price\n                          if (unitId) {\n                            const selectedUnit = originalItem.product?.compatible_units?.find(u => {\n                              const unit = u.unit || u;\n                              const unitIdFromData = unit?.id || unit;\n                              return unitIdFromData === parseInt(unitId);\n                            });\n                            if (selectedUnit) {\n                              // Calculate unit price based on conversion factor\n                              let unitPrice = originalItem.product?.price || 0;\n                              \n                              // If this is not the base unit, calculate converted price\n                              const unit = selectedUnit.unit || selectedUnit;\n                              const isBaseUnit = unit?.is_base_unit || selectedUnit.unit_is_base;\n                              \n                              if (!isBaseUnit) {\n                                // Find conversion factor from base unit to this unit\n                                const stockInfo = originalItem.product?.stock_in_units?.find(s => s.unit_id === parseInt(unitId));\n                                if (stockInfo) {\n                                  // Use the conversion factor from stock_in_units if available\n                                  const baseQuantity = originalItem.product.stock_quantity || 1;\n                                  const convertedQuantity = stockInfo.quantity || 1;\n                                  const conversionFactor = baseQuantity / convertedQuantity;\n                                  unitPrice = parseFloat(originalItem.product.price) * conversionFactor;\n                                } else {\n                                  // Fallback: try to find conversion in available_units\n                                  const availableUnit = originalItem.product?.available_units?.find(au => au.id === parseInt(unitId));\n                                  if (availableUnit?.conversion_factor) {\n                                    unitPrice = parseFloat(originalItem.product.price) * availableUnit.conversion_factor;\n                                  }\n                                }\n                              }\n                              \n                              handleItemChange(index, 'unit_cost', parseFloat(unitPrice).toFixed(2));\n                            }\n                          }\n                        }}\n                      >\n                        <option value=\"\">Select unit</option>\n                        {(() => {\n                          if (!originalItem.product?.compatible_units || originalItem.product.compatible_units.length === 0) {\n                            return <option value=\"\">No compatible units available</option>;\n                          }\n                          \n                          return originalItem.product.compatible_units.map(compatibleUnit => {\n                            // Handle both ProductUnit structure (with nested unit) and direct unit structure\n                            const unit = compatibleUnit.unit || compatibleUnit;\n                            const unitId = unit?.id || unit; // unit might be just an ID\n                            const unitName = unit?.name || compatibleUnit.unit_name;\n                            const unitSymbol = unit?.symbol || compatibleUnit.unit_symbol;\n                            \n                            // If unit is just an ID, use the direct fields from compatibleUnit\n                            if (!unitName || !unitSymbol) {\n                              console.warn('Invalid unit data:', compatibleUnit);\n                              return null;\n                            }\n                            \n                            // Calculate unit price based on conversion factor\n                            let unitPrice = originalItem.product?.price || 0;\n                            \n                            // If this is not the base unit, calculate converted price\n                            if (!compatibleUnit.unit_is_base) {\n                              // Find conversion factor from base unit to this unit\n                              const stockInfo = originalItem.product?.stock_in_units?.find(s => s.unit_id === unitId);\n                              if (stockInfo) {\n                                // Use the conversion factor from stock_in_units if available\n                                const baseQuantity = originalItem.product.stock_quantity || 1;\n                                const convertedQuantity = stockInfo.quantity || 1;\n                                const conversionFactor = baseQuantity / convertedQuantity;\n                                unitPrice = parseFloat(originalItem.product.price) * conversionFactor;\n                              } else {\n                                // Fallback: try to find conversion in available_units\n                                const availableUnit = originalItem.product?.available_units?.find(au => au.id === unitId);\n                                if (availableUnit?.conversion_factor) {\n                                  unitPrice = parseFloat(originalItem.product.price) * availableUnit.conversion_factor;\n                                }\n                              }\n                            }\n                            \n                            return (\n                              <option key={unitId} value={unitId}>\n                                {unitName} ({unitSymbol}) - {parseFloat(unitPrice).toFixed(2)} MGA\n                              </option>\n                            );\n                          }).filter(Boolean);\n                        })()}\n                      </select>\n                    </div>\n                    <div className=\"item-cost\">\n                      <label>Unit Cost *</label>\n                      <input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"0.01\"\n                        value={item.unit_cost}\n                        onChange={(e) => handleItemChange(index, 'unit_cost', e.target.value)}\n                        required\n                      />\n                    </div>\n                    <div className=\"item-total\">\n                      <label>Line Total</label>\n                      <div className=\"total-display\">\n                        {calculateItemTotal(item).toFixed(2)} MGA\n                        {originalItem.tax_class && (\n                          <span className=\"tax-amount\">\n                            + {calculateTaxAmount(item).toFixed(2)} MGA tax\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"item-condition\">\n                      <label>Condition Notes</label>\n                      <textarea\n                        value={item.condition_notes}\n                        onChange={(e) => handleItemChange(index, 'condition_notes', e.target.value)}\n                        rows=\"2\"\n                        placeholder=\"Notes about item condition...\"\n                      />\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          {formData.items.some(item => item.quantity_received > 0) && (\n            <div className=\"totals-section\">\n              <div className=\"totals-row\">\n                <span>Subtotal:</span>\n                <span>{totals.subtotal.toFixed(2)} MGA</span>\n              </div>\n              <div className=\"totals-row\">\n                <span>Tax Amount:</span>\n                <span>{totals.taxAmount.toFixed(2)} MGA</span>\n              </div>\n              <div className=\"totals-row total-row\">\n                <span>Total Amount:</span>\n                <span>{totals.total.toFixed(2)} MGA</span>\n              </div>\n            </div>\n          )}\n        </form>\n\n        <div className=\"modal-footer\">\n          <div className=\"footer-left\">\n            <PrintButton\n              data={{\n                ...purchaseOrder,\n                items: formData.items.map(item => ({\n                  ...item,\n                  product_name: purchaseOrder?.items?.find(poItem => poItem.id === item.purchase_order_item_id)?.product?.name,\n                  product_sku: purchaseOrder?.items?.find(poItem => poItem.id === item.purchase_order_item_id)?.product?.sku,\n                  unit_name: purchaseOrder?.items?.find(poItem => poItem.id === item.purchase_order_item_id)?.unit?.name,\n                  ordered_quantity: purchaseOrder?.items?.find(poItem => poItem.id === item.purchase_order_item_id)?.quantity_ordered,\n                  delivered_quantity: item.quantity_received,\n                  status: item.quantity_received > 0 ? 'Delivered' : 'Pending'\n                }))\n              }}\n              title=\"Delivery Receipt\"\n              type=\"delivery\"\n              printText=\"Print Receipt\"\n              validateText=\"Validate & Print\"\n              showValidateOption={true}\n              onValidate={handleSubmit}\n              disabled={!formData.items.some(item => item.quantity_received > 0)}\n            />\n          </div>\n          <div className=\"footer-right\">\n            <Button type=\"button\" variant=\"secondary\" onClick={onClose}>\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              variant={action === 'create_and_archive' ? 'primary' : 'primary'}\n              onClick={handleSubmit}\n              disabled={loading || !formData.items.some(item => item.quantity_received > 0)}\n            >\n              {loading \n                ? (action === 'create_and_archive' ? 'Creating & Archiving...' : 'Creating...') \n                : (action === 'create_and_archive' ? 'Create Delivery & Archive Order' : 'Create Delivery')\n              }\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DeliveryModal;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}