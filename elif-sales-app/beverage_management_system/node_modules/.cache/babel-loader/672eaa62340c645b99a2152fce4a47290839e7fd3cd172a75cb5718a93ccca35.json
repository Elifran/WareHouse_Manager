{"ast":null,"code":"import _objectSpread from\"/home/el-ifran/WareHouse_Manager/elif-sales-app/beverage_management_system/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useQuery,useQueryClient}from'react-query';import api from'../services/api';// Cache keys for localStorage\nconst CATEGORIES_CACHE_KEY='pos_categories_cache';const CATEGORIES_CACHE_TIMESTAMP_KEY='pos_categories_cache_timestamp';const CACHE_DURATION=60*60*1000;// 1 hour - categories change very rarely\n/**\n * Get cached categories from localStorage\n */const getCachedCategories=()=>{try{const cached=localStorage.getItem(CATEGORIES_CACHE_KEY);const timestamp=localStorage.getItem(CATEGORIES_CACHE_TIMESTAMP_KEY);if(cached&&timestamp){const age=Date.now()-parseInt(timestamp,10);if(age<CACHE_DURATION){return JSON.parse(cached);}}}catch(error){console.error('Error reading categories cache:',error);}return null;};/**\n * Save categories to localStorage cache\n */const saveCategoriesToCache=categories=>{try{localStorage.setItem(CATEGORIES_CACHE_KEY,JSON.stringify(categories));localStorage.setItem(CATEGORIES_CACHE_TIMESTAMP_KEY,Date.now().toString());}catch(error){console.error('Error saving categories cache:',error);}};/**\n * Apply session-based sellable overrides to a categories list\n */const applySessionSellableStatus=categories=>{if(!categories||categories.length===0){return categories;}try{const sellableStatus=JSON.parse(sessionStorage.getItem('sellableCategories')||'{}');return categories.map(cat=>_objectSpread(_objectSpread({},cat),{},{is_sellable:Object.prototype.hasOwnProperty.call(sellableStatus,cat.id)?sellableStatus[cat.id]:cat.is_sellable}));}catch(error){console.error('Error applying session sellable status:',error);return categories;}};/**\n * Enhanced categories hook for POS with localStorage persistence\n * @returns {Object} Query result with categories data\n */export const useCategoriesPOS=()=>{// Get cached data for initial state\nconst cachedCategories=getCachedCategories();const hasValidCache=!!cachedCategories;const cachedWithSession=hasValidCache?applySessionSellableStatus(cachedCategories):undefined;return useQuery(['categories-pos'],async()=>{// Check cache first - if valid, return immediately\nconst cached=getCachedCategories();if(cached){// Still fetch in background to update cache\nfetchFreshCategories().then(categories=>{if(categories){saveCategoriesToCache(categories);}}).catch(()=>{// Ignore errors in background fetch\n});return applySessionSellableStatus(cached);}// Fetch fresh data\nconst categories=await fetchFreshCategories();// Save to localStorage when data is fetched\nif(categories){saveCategoriesToCache(categories);}return applySessionSellableStatus(categories);},{staleTime:60*60*1000,// 1 hour - categories change very rarely\ncacheTime:2*60*60*1000,// 2 hours - keep in memory cache longer\nrefetchOnWindowFocus:false,refetchOnMount:!hasValidCache,// Don't refetch on mount if we have valid cache\nrefetchOnReconnect:true,// Use cached data as initial data if available\ninitialData:cachedWithSession});};/**\n * Fetch fresh categories from API\n */const fetchFreshCategories=async()=>{try{const response=await api.get('/api/products/categories/');const categoriesData=response.data.results||response.data;return applySessionSellableStatus(categoriesData);}catch(error){console.error('Error fetching categories:',error);// Return cached data if fetch fails\nconst cached=getCachedCategories();if(cached){return cached;}throw error;}};/**\n * Clear categories cache\n */export const clearCategoriesCache=()=>{try{localStorage.removeItem(CATEGORIES_CACHE_KEY);localStorage.removeItem(CATEGORIES_CACHE_TIMESTAMP_KEY);}catch(error){console.error('Error clearing categories cache:',error);}};","map":{"version":3,"names":["useQuery","useQueryClient","api","CATEGORIES_CACHE_KEY","CATEGORIES_CACHE_TIMESTAMP_KEY","CACHE_DURATION","getCachedCategories","cached","localStorage","getItem","timestamp","age","Date","now","parseInt","JSON","parse","error","console","saveCategoriesToCache","categories","setItem","stringify","toString","applySessionSellableStatus","length","sellableStatus","sessionStorage","map","cat","_objectSpread","is_sellable","Object","prototype","hasOwnProperty","call","id","useCategoriesPOS","cachedCategories","hasValidCache","cachedWithSession","undefined","fetchFreshCategories","then","catch","staleTime","cacheTime","refetchOnWindowFocus","refetchOnMount","refetchOnReconnect","initialData","response","get","categoriesData","data","results","clearCategoriesCache","removeItem"],"sources":["/home/el-ifran/WareHouse_Manager/elif-sales-app/beverage_management_system/src/hooks/useCategoriesPOS.js"],"sourcesContent":["import { useQuery, useQueryClient } from 'react-query';\nimport api from '../services/api';\n\n// Cache keys for localStorage\nconst CATEGORIES_CACHE_KEY = 'pos_categories_cache';\nconst CATEGORIES_CACHE_TIMESTAMP_KEY = 'pos_categories_cache_timestamp';\nconst CACHE_DURATION = 60 * 60 * 1000; // 1 hour - categories change very rarely\n\n/**\n * Get cached categories from localStorage\n */\nconst getCachedCategories = () => {\n  try {\n    const cached = localStorage.getItem(CATEGORIES_CACHE_KEY);\n    const timestamp = localStorage.getItem(CATEGORIES_CACHE_TIMESTAMP_KEY);\n    \n    if (cached && timestamp) {\n      const age = Date.now() - parseInt(timestamp, 10);\n      if (age < CACHE_DURATION) {\n        return JSON.parse(cached);\n      }\n    }\n  } catch (error) {\n    console.error('Error reading categories cache:', error);\n  }\n  return null;\n};\n\n/**\n * Save categories to localStorage cache\n */\nconst saveCategoriesToCache = (categories) => {\n  try {\n    localStorage.setItem(CATEGORIES_CACHE_KEY, JSON.stringify(categories));\n    localStorage.setItem(CATEGORIES_CACHE_TIMESTAMP_KEY, Date.now().toString());\n  } catch (error) {\n    console.error('Error saving categories cache:', error);\n  }\n};\n\n/**\n * Apply session-based sellable overrides to a categories list\n */\nconst applySessionSellableStatus = (categories) => {\n  if (!categories || categories.length === 0) {\n    return categories;\n  }\n\n  try {\n    const sellableStatus = JSON.parse(sessionStorage.getItem('sellableCategories') || '{}');\n    return categories.map(cat => ({\n      ...cat,\n      is_sellable: Object.prototype.hasOwnProperty.call(sellableStatus, cat.id)\n        ? sellableStatus[cat.id]\n        : cat.is_sellable\n    }));\n  } catch (error) {\n    console.error('Error applying session sellable status:', error);\n    return categories;\n  }\n};\n\n/**\n * Enhanced categories hook for POS with localStorage persistence\n * @returns {Object} Query result with categories data\n */\nexport const useCategoriesPOS = () => {\n  // Get cached data for initial state\n  const cachedCategories = getCachedCategories();\n  const hasValidCache = !!cachedCategories;\n  const cachedWithSession = hasValidCache ? applySessionSellableStatus(cachedCategories) : undefined;\n  \n  return useQuery(\n    ['categories-pos'],\n    async () => {\n      // Check cache first - if valid, return immediately\n      const cached = getCachedCategories();\n      if (cached) {\n        // Still fetch in background to update cache\n        fetchFreshCategories().then(categories => {\n          if (categories) {\n            saveCategoriesToCache(categories);\n          }\n        }).catch(() => {\n          // Ignore errors in background fetch\n        });\n        return applySessionSellableStatus(cached);\n      }\n      \n      // Fetch fresh data\n      const categories = await fetchFreshCategories();\n      \n      // Save to localStorage when data is fetched\n      if (categories) {\n        saveCategoriesToCache(categories);\n      }\n      \n      return applySessionSellableStatus(categories);\n    },\n    {\n      staleTime: 60 * 60 * 1000, // 1 hour - categories change very rarely\n      cacheTime: 2 * 60 * 60 * 1000, // 2 hours - keep in memory cache longer\n      refetchOnWindowFocus: false,\n      refetchOnMount: !hasValidCache, // Don't refetch on mount if we have valid cache\n      refetchOnReconnect: true,\n      // Use cached data as initial data if available\n      initialData: cachedWithSession,\n    }\n  );\n};\n\n/**\n * Fetch fresh categories from API\n */\nconst fetchFreshCategories = async () => {\n  try {\n    const response = await api.get('/api/products/categories/');\n    const categoriesData = response.data.results || response.data;\n    return applySessionSellableStatus(categoriesData);\n  } catch (error) {\n    console.error('Error fetching categories:', error);\n    // Return cached data if fetch fails\n    const cached = getCachedCategories();\n    if (cached) {\n      return cached;\n    }\n    throw error;\n  }\n};\n\n/**\n * Clear categories cache\n */\nexport const clearCategoriesCache = () => {\n  try {\n    localStorage.removeItem(CATEGORIES_CACHE_KEY);\n    localStorage.removeItem(CATEGORIES_CACHE_TIMESTAMP_KEY);\n  } catch (error) {\n    console.error('Error clearing categories cache:', error);\n  }\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}