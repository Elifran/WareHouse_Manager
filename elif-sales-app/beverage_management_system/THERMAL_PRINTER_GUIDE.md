# Thermal Receipt Printer Compatibility Guide

This guide explains how to use the thermal receipt printer compatibility features in the Beverage Management System.

## Overview

The system now supports thermal receipt printers with the following features:
- **80mm thermal printers** (standard receipt size)
- **58mm thermal printers** (mini receipt size)
- **ESC/POS command support** for direct thermal printer communication
- **Automatic printer detection** based on device type
- **Optimized print layouts** for thermal paper

## Supported Printer Types

### 80mm Thermal Printers
- **Paper Width**: 80mm (3.15 inches)
- **Max Characters**: 32 characters per line
- **Font Size**: 12px
- **Use Case**: Standard receipt printing, detailed reports

### 58mm Thermal Printers
- **Paper Width**: 58mm (2.28 inches)
- **Max Characters**: 24 characters per line
- **Font Size**: 10px
- **Use Case**: Compact receipts, mobile POS systems

## How to Use

### 1. Basic Print Functionality

The system automatically detects the printer type and applies appropriate formatting:

```javascript
// In any component with print functionality
<PrintButton
  data={printData}
  title="Document Title"
  type="packaging_validation"
  printText="Print"
/>
```

### 2. Thermal Printer Specific Printing

For thermal printer optimized output:

```javascript
<PrintButton
  data={printData}
  title="Document Title"
  type="packaging_validation"
  printText="Print"
  showValidateOption={true}
  onValidate={validationFunction}
  validateText="Validate & Print"
/>
```

This will show three print options:
- **Validate & Print**: Validates data then prints
- **Print**: Standard print
- **Print (Thermal)**: Thermal printer optimized print

### 3. Packaging Validation Reports

The PackagingValidation component now includes thermal printer support:

```javascript
// Automatic thermal printer detection and formatting
const printData = {
  sale_number: sale?.sale_number,
  customer_name: sale?.customer_name,
  packaging_items: packagingItems,
  packaging_total: calculatePackagingTotal()
};
```

## ESC/POS Commands

The system includes ESC/POS command support for direct thermal printer communication:

### Available Commands
- `INITIALIZE`: Initialize printer
- `CENTER`: Center text alignment
- `BOLD_ON/OFF`: Bold text formatting
- `DOUBLE_HEIGHT`: Double height text
- `CUT_PAPER`: Cut paper after printing
- `FEED_LINE`: Feed paper line

### Example ESC/POS Output
```
[ESC]@[ESC]a[01]PACKAGING VALIDATION REPORT
================================
Date: 12/25/2023
Time: 14:30:15
Print ID: PACKAGING-1703515815-abc123

Sale: SALE-001
Customer: John Doe
Phone: +261 34 12 345 67

--------------------------------
PACKAGING:
Bottle 500ml
  Qty: 10 pcs
  Price: 2500.00 MGA
  Total: 25000.00 MGA
  Status: Paid

================================
TOTAL: 25000.00 MGA
================================

Generated by Beverage Management System
User: admin
Print ID: PACKAGING-1703515815-abc123

[ESC]d[03][GS]V[00]
```

## Print Layout Features

### Automatic Formatting
- **Monospace fonts** for consistent character spacing
- **Optimized margins** for thermal paper
- **Truncated text** to fit printer width
- **Bold headers** and totals
- **Separator lines** for readability

### Responsive Design
- **80mm printers**: Full layout with all details
- **58mm printers**: Compact layout with essential information
- **Mobile devices**: Automatic 58mm formatting

## Configuration

### Printer Detection
The system automatically detects printer type based on:
1. User agent string
2. Device type (mobile vs desktop)
3. Manual configuration

### Manual Configuration
```javascript
import { detectPrinterType, PRINTER_CONFIGS } from '../utils/printUtils';

// Force specific printer type
const printerType = 'THERMAL_58MM';
const printContent = createThermalPrintDocument(data, title, type, t, printerType);
```

## Troubleshooting

### Common Issues

1. **Print not working**
   - Check popup blockers
   - Verify printer is connected
   - Ensure correct paper size

2. **Text cut off**
   - Verify printer width setting
   - Check paper alignment
   - Use appropriate printer type

3. **Poor print quality**
   - Clean printer head
   - Check paper quality
   - Adjust print density

4. **"There was a problem printing the page" Error**
   - This is a common mobile browser issue
   - Use the "Download for Receipt App" option instead
   - Install a receipt printer app on your mobile device

### Print Preview
Always use print preview to verify layout before printing:
1. Click print button
2. Review print preview window
3. Adjust settings if needed
4. Print when satisfied

## Receipt Printer Apps Integration

### When Browser Printing Fails

If you encounter the error "There was a problem printing the page" or similar issues, use the **"Download PDF"** option:

1. **Click "Download PDF"** button
2. **PDF file will be downloaded** to your device
3. **Open the PDF** with any PDF viewer or receipt printer app
4. **Print directly** to your Xprinter

### Recommended Receipt Printer Apps

#### For Android:
- **"Receipt Printer"** by Zjiang
- **"Thermal Printer"** by Sunmi
- **"ESC/POS Printer"** by Various developers
- **"Xprinter"** official app (if available)

#### For iOS:
- **"Receipt Printer"** by Various developers
- **"Thermal Printer"** apps
- **"ESC/POS Printer"** apps

### How to Use PDF Files:

1. **Download the PDF** from the web app
2. **Open the PDF** with any PDF viewer or receipt printer app
3. **Connect your Xprinter** via Wi-Fi or Bluetooth (if using receipt app)
4. **Configure printer settings** (80mm, thermal)
5. **Print the receipt**

### PDF Format

The downloaded PDF contains:
- **80mm thermal printer optimized** layout
- **Professional receipt formatting** 
- **Xprinter-compatible** sizing and fonts
- **Ready to print** on any thermal printer

### Troubleshooting Receipt Apps:

1. **File won't open**: Try different receipt printer apps
2. **Printer not found**: Check Wi-Fi/Bluetooth connection
3. **Wrong format**: Ensure app supports ESC/POS commands
4. **Text too small/large**: Adjust font size in app settings

## Best Practices

### For 80mm Printers
- Use for detailed reports
- Include all transaction details
- Print customer information
- Add separator lines for clarity

### For 58mm Printers
- Keep content concise
- Use abbreviations where appropriate
- Focus on essential information
- Minimize whitespace

### General Tips
- Test with sample data first
- Keep receipts under 10 inches long
- Use clear, readable fonts
- Include print timestamps
- Add unique print IDs for tracking

## Integration Examples

### Sales Receipts
```javascript
const salesPrintData = {
  sale_number: sale.sale_number,
  customer_name: sale.customer_name,
  items: sale.items,
  total_amount: sale.total_amount,
  payment_status: sale.payment_status
};
```

### Packaging Validation
```javascript
const packagingPrintData = {
  sale_number: sale.sale_number,
  customer_name: sale.customer_name,
  packaging_items: packagingItems,
  packaging_total: calculatePackagingTotal()
};
```

### Inventory Reports
```javascript
const inventoryPrintData = {
  products: products,
  total_products: products.length,
  report_date: new Date().toISOString()
};
```

## Technical Details

### CSS Media Queries
```css
@media print {
  @page {
    size: 80mm auto;
    margin: 5mm;
  }
  
  body {
    font-size: 12px;
    line-height: 1.2;
    font-family: 'Courier New', monospace;
  }
}
```

### ESC/POS Command Format
```javascript
const commands = ESC_POS_COMMANDS.INITIALIZE +
                 ESC_POS_COMMANDS.CENTER +
                 ESC_POS_COMMANDS.BOLD_ON +
                 title + '\n' +
                 ESC_POS_COMMANDS.BOLD_OFF +
                 ESC_POS_COMMANDS.CUT_PAPER;
```

## Support

For technical support or questions about thermal printer compatibility:
1. Check this documentation
2. Review console logs for errors
3. Test with different printer types
4. Contact system administrator

## Version History

- **v1.0**: Initial thermal printer support
- **v1.1**: Added ESC/POS commands
- **v1.2**: Enhanced packaging validation printing
- **v1.3**: Added automatic printer detection

