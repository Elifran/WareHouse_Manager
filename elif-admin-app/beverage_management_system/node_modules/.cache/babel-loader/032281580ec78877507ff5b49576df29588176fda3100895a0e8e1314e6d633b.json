{"ast":null,"code":"import _objectSpread from\"/home/el-ifran/WareHouse_Manager/beverage_management_system/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{useAuth}from'../contexts/AuthContext';import api from'../services/api';import Table from'../components/Table';import Button from'../components/Button';import PrintButton from'../components/PrintButton';import'./Inventory.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Inventory=()=>{const{user}=useAuth();const[products,setProducts]=useState([]);const[categories,setCategories]=useState([]);const[taxClasses,setTaxClasses]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[showAddModal,setShowAddModal]=useState(false);const[editingProduct,setEditingProduct]=useState(null);const[filters,setFilters]=useState({category:'',stockStatus:'',search:''});useEffect(()=>{fetchProducts();fetchCategories();fetchTaxClasses();},[]);const fetchProducts=async function(){let filterParams=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};try{setLoading(true);const params=new URLSearchParams();// Add filters to params\nif(filterParams.category)params.append('category',filterParams.category);if(filterParams.search)params.append('search',filterParams.search);if(filterParams.is_active!==undefined)params.append('is_active',filterParams.is_active);if(filterParams.stock_quantity!==undefined)params.append('stock_quantity',filterParams.stock_quantity);const url=\"/products/\".concat(params.toString()?'?'+params.toString():'');const response=await api.get(url);let products=response.data.results||response.data;// Handle low stock filter on frontend since it's a calculated field\nif(filterParams.stockStatus==='low'){products=products.filter(product=>product.is_low_stock);}setProducts(products);}catch(err){setError('Failed to load products');console.error('Products error:',err);}finally{setLoading(false);}};const fetchCategories=async()=>{try{const response=await api.get('/products/categories/');setCategories(response.data.results||response.data);}catch(err){console.error('Categories error:',err);}};const fetchTaxClasses=async()=>{try{const response=await api.get('/products/tax-classes/');setTaxClasses(response.data.results||response.data);}catch(err){console.error('Tax classes error:',err);}};const handleAddProduct=()=>{setEditingProduct(null);setShowAddModal(true);};const handleEditProduct=async product=>{try{// Fetch full product details including cost_price and category ID\nconst response=await api.get(\"/products/\".concat(product.id,\"/\"));setEditingProduct(response.data);setShowAddModal(true);}catch(err){setError('Failed to load product details');console.error('Product details error:',err);}};const handleDeleteProduct=async product=>{if(window.confirm(\"Are you sure you want to delete \".concat(product.name,\"?\"))){try{await api.delete(\"/products/\".concat(product.id,\"/\"));fetchProducts(filters);}catch(err){setError('Failed to delete product');console.error('Delete error:',err);}}};const handleFilterChange=(filterType,value)=>{const newFilters=_objectSpread(_objectSpread({},filters),{},{[filterType]:value});setFilters(newFilters);// Convert stock status filter to API parameters\nconst apiParams=_objectSpread({},newFilters);if(newFilters.stockStatus==='out'){// For out of stock, filter by stock_quantity = 0\napiParams.stock_quantity=0;}fetchProducts(apiParams);};const clearFilters=()=>{const clearedFilters={category:'',stockStatus:'',search:''};setFilters(clearedFilters);fetchProducts(clearedFilters);};const columns=[{key:'name',header:'Product Name',render:(value,row)=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"product-name\",children:value}),/*#__PURE__*/_jsx(\"div\",{className:\"product-sku\",children:row.sku})]})},{key:'category_name',header:'Category'},{key:'stock_quantity',header:'Stock',render:(value,row)=>/*#__PURE__*/_jsxs(\"div\",{className:\"stock-quantity \".concat(row.is_low_stock?'low-stock':'',\" \").concat(row.is_out_of_stock?'out-of-stock':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"base-stock\",children:[value,\" \",row.unit,row.is_low_stock&&/*#__PURE__*/_jsx(\"span\",{className:\"stock-warning\",children:\"Low\"}),row.is_out_of_stock&&/*#__PURE__*/_jsx(\"span\",{className:\"stock-warning\",children:\"Out\"})]}),row.stock_in_units&&row.stock_in_units.length>1&&/*#__PURE__*/_jsx(\"div\",{className:\"stock-in-units\",children:row.stock_in_units.filter(stockUnit=>!stockUnit.is_base_unit).map(stockUnit=>/*#__PURE__*/_jsxs(\"div\",{className:\"unit-stock\",children:[stockUnit.quantity,\" \",stockUnit.unit_symbol]},stockUnit.unit_id))})]})},{key:'price',header:'Price',render:value=>\"\".concat(parseFloat(value).toFixed(2),\" MGA\")},{key:'actions',header:'Actions',render:(value,row)=>/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outline\",onClick:()=>handleEditProduct(row),children:\"Edit\"}),(user===null||user===void 0?void 0:user.role)==='admin'&&/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"danger\",onClick:()=>handleDeleteProduct(row),children:\"Delete\"})]})}];return/*#__PURE__*/_jsxs(\"div\",{className:\"inventory\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inventory-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Inventory Management\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-actions\",children:[/*#__PURE__*/_jsx(PrintButton,{data:_objectSpread(_objectSpread({},products),{},{user_name:(user===null||user===void 0?void 0:user.username)||'Unknown User',user_id:(user===null||user===void 0?void 0:user.id)||'unknown',print_timestamp:new Date().toISOString(),print_id:\"PRINT-\".concat(Date.now(),\"-\").concat(Math.random().toString(36).substr(2,9))}),title:\"Inventory Report\",type:\"inventory\",printText:\"Print Inventory\",className:\"print-inventory-btn\"}),/*#__PURE__*/_jsx(Button,{onClick:handleAddProduct,children:\"Add Product\"})]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"inventory-filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Category:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.category,onChange:e=>handleFilterChange('category',e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Categories\"}),categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category.id,children:category.name},category.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Stock Status:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.stockStatus,onChange:e=>handleFilterChange('stockStatus',e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All\"}),/*#__PURE__*/_jsx(\"option\",{value:\"low\",children:\"Low Stock\"}),/*#__PURE__*/_jsx(\"option\",{value:\"out\",children:\"Out of Stock\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Search:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search products...\",value:filters.search,onChange:e=>handleFilterChange('search',e.target.value)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"filter-group\",children:/*#__PURE__*/_jsx(Button,{variant:\"outline\",size:\"small\",onClick:clearFilters,children:\"Clear Filters\"})})]}),/*#__PURE__*/_jsx(Table,{data:products,columns:columns,loading:loading,emptyMessage:\"No products found\"}),showAddModal&&/*#__PURE__*/_jsx(ProductModal,{product:editingProduct,categories:categories,taxClasses:taxClasses,onClose:()=>setShowAddModal(false),onSave:()=>{setShowAddModal(false);fetchProducts(filters);}})]});};const ProductModal=_ref=>{var _product$base_unit,_product$is_active;let{product,categories,taxClasses,onClose,onSave}=_ref;const[formData,setFormData]=useState({name:(product===null||product===void 0?void 0:product.name)||'',description:(product===null||product===void 0?void 0:product.description)||'',category:(product===null||product===void 0?void 0:product.category)||'',tax_class:(product===null||product===void 0?void 0:product.tax_class)||'',sku:(product===null||product===void 0?void 0:product.sku)||'',price:(product===null||product===void 0?void 0:product.price)||'',cost_price:(product===null||product===void 0?void 0:product.cost_price)||'',stock_quantity:(product===null||product===void 0?void 0:product.stock_quantity)||0,min_stock_level:(product===null||product===void 0?void 0:product.min_stock_level)||10,max_stock_level:(product===null||product===void 0?void 0:product.max_stock_level)||1000,base_unit:(product===null||product===void 0?void 0:(_product$base_unit=product.base_unit)===null||_product$base_unit===void 0?void 0:_product$base_unit.id)||(product===null||product===void 0?void 0:product.base_unit)||'',is_active:(_product$is_active=product===null||product===void 0?void 0:product.is_active)!==null&&_product$is_active!==void 0?_product$is_active:true});const[units,setUnits]=useState([]);const[allUnits,setAllUnits]=useState([]);const[compatibleUnits,setCompatibleUnits]=useState([]);const[showUnitSelector,setShowUnitSelector]=useState(false);const[convertibleUnits,setConvertibleUnits]=useState([]);const[unitConversions,setUnitConversions]=useState([]);const[baseValues,setBaseValues]=useState(null);// Store original base unit values\n// Function to get conversion factor between units\nconst getConversionFactor=useCallback((fromUnitId,toUnitId)=>{if(fromUnitId===toUnitId)return 1;// Look for direct conversion\nlet conversion=unitConversions.find(conv=>conv.from_unit===fromUnitId&&conv.to_unit===toUnitId);if(conversion){console.log('Found direct conversion:',conversion);return conversion.conversion_factor;}// Look for reverse conversion\nconversion=unitConversions.find(conv=>conv.from_unit===toUnitId&&conv.to_unit===fromUnitId);if(conversion){console.log('Found reverse conversion:',conversion);return 1/conversion.conversion_factor;}console.log('No conversion found between',fromUnitId,'and',toUnitId);console.log('Available conversions:',unitConversions.map(c=>\"\".concat(c.from_unit,\"->\").concat(c.to_unit,\": \").concat(c.conversion_factor)));return null;},[unitConversions]);// Load base units when component mounts (for product creation/editing)\nuseEffect(()=>{const fetchUnits=async()=>{try{console.log('=== FETCHING UNITS ===');// Fetch base units\nconst baseUnitsResponse=await api.get('/products/base-units/');console.log('Base units response:',baseUnitsResponse.data);const baseUnits=baseUnitsResponse.data.results||baseUnitsResponse.data;setUnits(baseUnits);console.log('Setting base units:',baseUnits);// Fetch ALL units with pagination\nlet allUnitsData=[];let nextUrl='/products/units/';while(nextUrl){const response=await api.get(nextUrl);const data=response.data;allUnitsData=allUnitsData.concat(data.results||data);nextUrl=data.next;console.log('Fetched page, total units so far:',allUnitsData.length);}console.log('All units fetched:',allUnitsData);setAllUnits(allUnitsData);// Handle pagination for conversions\nlet allConversions=[];nextUrl='/products/unit-conversions/';while(nextUrl){const response=await api.get(nextUrl);const data=response.data;allConversions=allConversions.concat(data.results||data);nextUrl=data.next;}console.log('Setting unit conversions:',allConversions);setUnitConversions(allConversions);console.log('=== UNITS LOADED ===');}catch(err){console.error('Failed to load units:',err);}};fetchUnits();},[]);// Load compatible units when editing a product\nuseEffect(()=>{if(product&&product.compatible_units){setCompatibleUnits(product.compatible_units);// Store the original base values\nsetBaseValues({price:parseFloat(product.price||0),cost_price:parseFloat(product.cost_price||0),stock_quantity:parseFloat(product.stock_quantity||0),min_stock_level:parseFloat(product.min_stock_level||0),max_stock_level:parseFloat(product.max_stock_level||0)});}else{setCompatibleUnits([]);setBaseValues(null);}},[product]);// Debug: Monitor formData changes\nuseEffect(()=>{console.log('FormData changed:',formData);},[formData]);// Debug: Monitor allUnits changes\nuseEffect(()=>{console.log('AllUnits changed:',allUnits);},[allUnits]);// Debug: Monitor units changes\nuseEffect(()=>{console.log('Units changed:',units);},[units]);// Fetch convertible units when base unit changes\nuseEffect(()=>{const fetchConvertibleUnits=async()=>{if(formData.base_unit){try{// Use a unified approach for both new and existing products\n// Get all unit conversions and find units that can be converted to/from the base unit\n// Handle pagination to get all conversions\nlet allConversions=[];let nextUrl='/products/unit-conversions/';while(nextUrl){const response=await api.get(nextUrl);const data=response.data;allConversions=allConversions.concat(data.results||data);nextUrl=data.next;// Next page URL\n}const conversions=allConversions;const baseUnitId=parseInt(formData.base_unit);const convertible=[];// Find units that have conversions with the base unit\nconversions.forEach(conversion=>{if(conversion.from_unit===baseUnitId&&!convertible.find(u=>u.id===conversion.to_unit)){// Find the unit details\nconst unit=allUnits.find(u=>u.id===conversion.to_unit);if(unit){convertible.push({id:unit.id,name:unit.name,symbol:unit.symbol,is_base_unit:unit.is_base_unit});}}else if(conversion.to_unit===baseUnitId&&!convertible.find(u=>u.id===conversion.from_unit)){// Find the unit details\nconst unit=allUnits.find(u=>u.id===conversion.from_unit);if(unit){convertible.push({id:unit.id,name:unit.name,symbol:unit.symbol,is_base_unit:unit.is_base_unit});}}});setConvertibleUnits(convertible);}catch(err){console.error('Failed to fetch convertible units:',err);setConvertibleUnits([]);}}else{setConvertibleUnits([]);}};fetchConvertibleUnits();},[formData.base_unit,allUnits]);// Update form data when product changes (for editing)\nuseEffect(()=>{if(product){var _product$base_unit2,_product$is_active2;setFormData({name:product.name||'',description:product.description||'',category:product.category||'',tax_class:product.tax_class||'',sku:product.sku||'',price:product.price||'',cost_price:product.cost_price||'',stock_quantity:product.stock_quantity||0,min_stock_level:product.min_stock_level||10,max_stock_level:product.max_stock_level||1000,base_unit:((_product$base_unit2=product.base_unit)===null||_product$base_unit2===void 0?void 0:_product$base_unit2.id)||product.base_unit||'',is_active:(_product$is_active2=product.is_active)!==null&&_product$is_active2!==void 0?_product$is_active2:true});}},[product]);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const handleChange=e=>{const{name,value,type,checked}=e.target;setFormData(_objectSpread(_objectSpread({},formData),{},{[name]:type==='checkbox'?checked:value}));};const addCompatibleUnit=async unitId=>{if(!product)return;// Check if the unit is already the base unit\nif(parseInt(unitId)===parseInt(formData.base_unit)){alert('Cannot add the base unit as a compatible unit.');return;}// Check if the unit is already added\nconst alreadyAdded=compatibleUnits.some(cu=>cu.unit===parseInt(unitId));if(alreadyAdded){alert('This unit is already added as a compatible unit.');return;}try{const response=await api.post(\"/products/\".concat(product.id,\"/units/\"),{unit:parseInt(unitId),is_default:false,is_active:true});setCompatibleUnits([...compatibleUnits,response.data]);setShowUnitSelector(false);}catch(err){var _err$response,_err$response$data;console.error('Failed to add compatible unit:',err);alert(\"Failed to add compatible unit: \".concat(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.detail)||err.message));}};const removeCompatibleUnit=async productUnitId=>{if(!product)return;try{await api.delete(\"/products/\".concat(product.id,\"/units/\").concat(productUnitId,\"/\"));setCompatibleUnits(compatibleUnits.filter(cu=>cu.id!==productUnitId));}catch(err){console.error('Failed to remove compatible unit:',err);}};const setDefaultUnit=async productUnitId=>{if(!product)return;try{// First, set all units to non-default\nfor(const cu of compatibleUnits){if(cu.is_default){await api.put(\"/products/\".concat(product.id,\"/units/\").concat(cu.id,\"/\"),_objectSpread(_objectSpread({},cu),{},{is_default:false}));}}// Then set the selected unit as default\nconst unitToUpdate=compatibleUnits.find(cu=>cu.id===productUnitId);if(unitToUpdate){await api.put(\"/products/\".concat(product.id,\"/units/\").concat(productUnitId,\"/\"),_objectSpread(_objectSpread({},unitToUpdate),{},{is_default:true}));// Update local state\nsetCompatibleUnits(compatibleUnits.map(cu=>_objectSpread(_objectSpread({},cu),{},{is_default:cu.id===productUnitId})));// Note: Display unit functionality removed - default unit selection handles this\n}}catch(err){console.error('Failed to set default unit:',err);}};const handleSubmit=async e=>{e.preventDefault();setLoading(true);setError('');try{// Use form data directly\nlet finalFormData=_objectSpread({},formData);// Prepare data for submission\nconst submitData=_objectSpread(_objectSpread({},finalFormData),{},{base_unit:finalFormData.base_unit?parseInt(finalFormData.base_unit):null});console.log('Submitting data:',submitData);console.log('Original form data:',formData);if(product){await api.put(\"/products/\".concat(product.id,\"/\"),submitData);}else{await api.post('/products/',submitData);}onSave();}catch(err){var _err$response2,_err$response2$data;setError(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.detail)||'Failed to save product');console.error('Save error:',err);}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"modal-overlay\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:product?'Edit Product':'Add Product'}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:onClose,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"modal-form\",children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Product Name *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",value:formData.name,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"SKU *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"sku\",value:formData.sku,onChange:handleChange,required:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Description\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"description\",value:formData.description,onChange:handleChange,rows:\"3\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Category *\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"category\",value:formData.category,onChange:handleChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select Category\"}),categories.map(category=>/*#__PURE__*/_jsx(\"option\",{value:category.id,children:category.name},category.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Tax Class\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"tax_class\",value:formData.tax_class,onChange:handleChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"No Tax Class\"}),taxClasses.map(taxClass=>/*#__PURE__*/_jsxs(\"option\",{value:taxClass.id,children:[taxClass.name,\" (\",taxClass.tax_rate,\"%)\"]},taxClass.id))]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Base Unit\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"base_unit\",value:formData.base_unit,onChange:handleChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select Base Unit\"}),units.map(unit=>/*#__PURE__*/_jsxs(\"option\",{value:unit.id,children:[unit.name,\" (\",unit.symbol,\")\"]},unit.id))]})]})}),product&&/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Compatible Units\"}),/*#__PURE__*/_jsx(\"p\",{className:\"compatible-units-note\",children:\"Only units that can be converted to/from the base unit can be added as compatible units.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"compatible-units-section\",children:[compatibleUnits.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"compatible-units-list\",children:compatibleUnits.map(compatibleUnit=>/*#__PURE__*/_jsxs(\"div\",{className:\"compatible-unit-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"unit-info\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"unit-name\",children:[compatibleUnit.unit_name,\" (\",compatibleUnit.unit_symbol,\")\"]}),compatibleUnit.is_default&&/*#__PURE__*/_jsx(\"span\",{className:\"default-badge\",children:\"Default\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"unit-actions\",children:[!compatibleUnit.is_default&&/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outline\",onClick:()=>setDefaultUnit(compatibleUnit.id),children:\"Set Default\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"danger\",onClick:()=>removeCompatibleUnit(compatibleUnit.id),children:\"Remove\"})]})]},compatibleUnit.id))}):/*#__PURE__*/_jsx(\"p\",{className:\"no-units-message\",children:\"No compatible units added yet.\"}),/*#__PURE__*/_jsxs(Button,{type:\"button\",variant:\"outline\",onClick:()=>setShowUnitSelector(true),className:\"add-unit-button\",disabled:!formData.base_unit||convertibleUnits.filter(unit=>{const isAlreadyAdded=compatibleUnits.some(cu=>cu.unit===unit.id);const isBaseUnit=unit.id===parseInt(formData.base_unit);return!isAlreadyAdded&&!isBaseUnit;}).length===0,children:[\"+ Add Compatible Unit\",!formData.base_unit&&\" (Select base unit first)\",formData.base_unit&&convertibleUnits.filter(unit=>{const isAlreadyAdded=compatibleUnits.some(cu=>cu.unit===unit.id);const isBaseUnit=unit.id===parseInt(formData.base_unit);return!isAlreadyAdded&&!isBaseUnit;}).length===0&&\" (No convertible units)\"]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Price *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",name:\"price\",value:formData.price,onChange:handleChange,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Cost Price\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",name:\"cost_price\",value:formData.cost_price,onChange:handleChange})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Stock Quantity\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"stock_quantity\",value:formData.stock_quantity,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Min Stock Level\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"min_stock_level\",value:formData.min_stock_level,onChange:handleChange})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Max Stock Level\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"max_stock_level\",value:formData.max_stock_level,onChange:handleChange})]}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",name:\"is_active\",checked:formData.is_active,onChange:handleChange}),\"Active\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:onClose,children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{type:\"submit\",loading:loading,children:product?'Update':'Create'})]})]})]}),showUnitSelector&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content unit-selector-modal\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Add Compatible Unit\"}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:()=>setShowUnitSelector(false),children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Select a unit to add as compatible for this product:\"}),/*#__PURE__*/_jsx(\"p\",{className:\"unit-selector-note\",children:\"Only units that can be converted to/from the base unit are shown.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"unit-selector-list\",children:[convertibleUnits.filter(unit=>{const isAlreadyAdded=compatibleUnits.some(cu=>cu.unit===unit.id);const isBaseUnit=unit.id===parseInt(formData.base_unit);return!isAlreadyAdded&&!isBaseUnit;}).map(unit=>/*#__PURE__*/_jsx(\"div\",{className:\"unit-selector-item\",onClick:()=>addCompatibleUnit(unit.id),children:/*#__PURE__*/_jsxs(\"div\",{className:\"unit-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"unit-name\",children:unit.name}),/*#__PURE__*/_jsxs(\"span\",{className:\"unit-symbol\",children:[\"(\",unit.symbol,\")\"]}),unit.is_base_unit&&/*#__PURE__*/_jsx(\"span\",{className:\"base-unit-badge\",children:\"Base Unit\"})]})},unit.id)),convertibleUnits.filter(unit=>!compatibleUnits.some(cu=>cu.unit===unit.id)&&unit.id!==parseInt(formData.base_unit)).length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"no-units-available\",children:formData.base_unit?\"No convertible units available for the selected base unit.\":\"Please select a base unit first.\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-actions\",children:/*#__PURE__*/_jsx(Button,{type:\"button\",variant:\"outline\",onClick:()=>setShowUnitSelector(false),children:\"Cancel\"})})]})})]});};export default Inventory;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useAuth","api","Table","Button","PrintButton","jsx","_jsx","jsxs","_jsxs","Inventory","user","products","setProducts","categories","setCategories","taxClasses","setTaxClasses","loading","setLoading","error","setError","showAddModal","setShowAddModal","editingProduct","setEditingProduct","filters","setFilters","category","stockStatus","search","fetchProducts","fetchCategories","fetchTaxClasses","filterParams","arguments","length","undefined","params","URLSearchParams","append","is_active","stock_quantity","url","concat","toString","response","get","data","results","filter","product","is_low_stock","err","console","handleAddProduct","handleEditProduct","id","handleDeleteProduct","window","confirm","name","delete","handleFilterChange","filterType","value","newFilters","_objectSpread","apiParams","clearFilters","clearedFilters","columns","key","header","render","row","children","className","sku","is_out_of_stock","unit","stock_in_units","stockUnit","is_base_unit","map","quantity","unit_symbol","unit_id","parseFloat","toFixed","size","variant","onClick","role","user_name","username","user_id","print_timestamp","Date","toISOString","print_id","now","Math","random","substr","title","type","printText","onChange","e","target","placeholder","emptyMessage","ProductModal","onClose","onSave","_ref","_product$base_unit","_product$is_active","formData","setFormData","description","tax_class","price","cost_price","min_stock_level","max_stock_level","base_unit","units","setUnits","allUnits","setAllUnits","compatibleUnits","setCompatibleUnits","showUnitSelector","setShowUnitSelector","convertibleUnits","setConvertibleUnits","unitConversions","setUnitConversions","baseValues","setBaseValues","getConversionFactor","fromUnitId","toUnitId","conversion","find","conv","from_unit","to_unit","log","conversion_factor","c","fetchUnits","baseUnitsResponse","baseUnits","allUnitsData","nextUrl","next","allConversions","compatible_units","fetchConvertibleUnits","conversions","baseUnitId","parseInt","convertible","forEach","u","push","symbol","_product$base_unit2","_product$is_active2","handleChange","checked","addCompatibleUnit","unitId","alert","alreadyAdded","some","cu","post","is_default","_err$response","_err$response$data","detail","message","removeCompatibleUnit","productUnitId","setDefaultUnit","put","unitToUpdate","handleSubmit","preventDefault","finalFormData","submitData","_err$response2","_err$response2$data","onSubmit","required","rows","taxClass","tax_rate","compatibleUnit","unit_name","disabled","isAlreadyAdded","isBaseUnit","step"],"sources":["/home/el-ifran/WareHouse_Manager/beverage_management_system/src/pages/Inventory.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport api from '../services/api';\nimport Table from '../components/Table';\nimport Button from '../components/Button';\nimport PrintButton from '../components/PrintButton';\nimport './Inventory.css';\n\nconst Inventory = () => {\n  const { user } = useAuth();\n  const [products, setProducts] = useState([]);\n  const [categories, setCategories] = useState([]);\n  const [taxClasses, setTaxClasses] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [showAddModal, setShowAddModal] = useState(false);\n  const [editingProduct, setEditingProduct] = useState(null);\n  const [filters, setFilters] = useState({\n    category: '',\n    stockStatus: '',\n    search: ''\n  });\n\n  useEffect(() => {\n    fetchProducts();\n    fetchCategories();\n    fetchTaxClasses();\n  }, []);\n\n  const fetchProducts = async (filterParams = {}) => {\n    try {\n      setLoading(true);\n      const params = new URLSearchParams();\n      \n      // Add filters to params\n      if (filterParams.category) params.append('category', filterParams.category);\n      if (filterParams.search) params.append('search', filterParams.search);\n      if (filterParams.is_active !== undefined) params.append('is_active', filterParams.is_active);\n      if (filterParams.stock_quantity !== undefined) params.append('stock_quantity', filterParams.stock_quantity);\n      \n      const url = `/products/${params.toString() ? '?' + params.toString() : ''}`;\n      const response = await api.get(url);\n      let products = response.data.results || response.data;\n      \n      // Handle low stock filter on frontend since it's a calculated field\n      if (filterParams.stockStatus === 'low') {\n        products = products.filter(product => product.is_low_stock);\n      }\n      \n      setProducts(products);\n    } catch (err) {\n      setError('Failed to load products');\n      console.error('Products error:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchCategories = async () => {\n    try {\n      const response = await api.get('/products/categories/');\n      setCategories(response.data.results || response.data);\n    } catch (err) {\n      console.error('Categories error:', err);\n    }\n  };\n\n  const fetchTaxClasses = async () => {\n    try {\n      const response = await api.get('/products/tax-classes/');\n      setTaxClasses(response.data.results || response.data);\n    } catch (err) {\n      console.error('Tax classes error:', err);\n    }\n  };\n\n  const handleAddProduct = () => {\n    setEditingProduct(null);\n    setShowAddModal(true);\n  };\n\n  const handleEditProduct = async (product) => {\n    try {\n      // Fetch full product details including cost_price and category ID\n      const response = await api.get(`/products/${product.id}/`);\n      setEditingProduct(response.data);\n      setShowAddModal(true);\n    } catch (err) {\n      setError('Failed to load product details');\n      console.error('Product details error:', err);\n    }\n  };\n\n  const handleDeleteProduct = async (product) => {\n    if (window.confirm(`Are you sure you want to delete ${product.name}?`)) {\n      try {\n        await api.delete(`/products/${product.id}/`);\n        fetchProducts(filters);\n      } catch (err) {\n        setError('Failed to delete product');\n        console.error('Delete error:', err);\n      }\n    }\n  };\n\n  const handleFilterChange = (filterType, value) => {\n    const newFilters = { ...filters, [filterType]: value };\n    setFilters(newFilters);\n    \n    // Convert stock status filter to API parameters\n    const apiParams = { ...newFilters };\n    if (newFilters.stockStatus === 'out') {\n      // For out of stock, filter by stock_quantity = 0\n      apiParams.stock_quantity = 0;\n    }\n    \n    fetchProducts(apiParams);\n  };\n\n  const clearFilters = () => {\n    const clearedFilters = { category: '', stockStatus: '', search: '' };\n    setFilters(clearedFilters);\n    fetchProducts(clearedFilters);\n  };\n\n  const columns = [\n    {\n      key: 'name',\n      header: 'Product Name',\n      render: (value, row) => (\n        <div>\n          <div className=\"product-name\">{value}</div>\n          <div className=\"product-sku\">{row.sku}</div>\n        </div>\n      )\n    },\n    {\n      key: 'category_name',\n      header: 'Category'\n    },\n    {\n      key: 'stock_quantity',\n      header: 'Stock',\n      render: (value, row) => (\n        <div className={`stock-quantity ${row.is_low_stock ? 'low-stock' : ''} ${row.is_out_of_stock ? 'out-of-stock' : ''}`}>\n          {/* Base unit stock */}\n          <div className=\"base-stock\">\n          {value} {row.unit}\n          {row.is_low_stock && <span className=\"stock-warning\">Low</span>}\n          {row.is_out_of_stock && <span className=\"stock-warning\">Out</span>}\n          </div>\n          \n          {/* Stock in other units */}\n          {row.stock_in_units && row.stock_in_units.length > 1 && (\n            <div className=\"stock-in-units\">\n              {row.stock_in_units\n                .filter(stockUnit => !stockUnit.is_base_unit)\n                .map(stockUnit => (\n                  <div key={stockUnit.unit_id} className=\"unit-stock\">\n                    {stockUnit.quantity} {stockUnit.unit_symbol}\n                  </div>\n                ))\n              }\n            </div>\n          )}\n        </div>\n      )\n    },\n    {\n      key: 'price',\n      header: 'Price',\n      render: (value) => `${parseFloat(value).toFixed(2)} MGA`\n    },\n    {\n      key: 'actions',\n      header: 'Actions',\n      render: (value, row) => (\n        <div className=\"action-buttons\">\n          <Button\n            size=\"small\"\n            variant=\"outline\"\n            onClick={() => handleEditProduct(row)}\n          >\n            Edit\n          </Button>\n          {user?.role === 'admin' && (\n            <Button\n              size=\"small\"\n              variant=\"danger\"\n              onClick={() => handleDeleteProduct(row)}\n            >\n              Delete\n            </Button>\n          )}\n        </div>\n      )\n    }\n  ];\n\n  return (\n    <div className=\"inventory\">\n      <div className=\"inventory-header\">\n        <h1>Inventory Management</h1>\n        <div className=\"header-actions\">\n          <PrintButton\n            data={{\n              ...products,\n              user_name: user?.username || 'Unknown User',\n              user_id: user?.id || 'unknown',\n              print_timestamp: new Date().toISOString(),\n              print_id: `PRINT-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`\n            }}\n            title=\"Inventory Report\"\n            type=\"inventory\"\n            printText=\"Print Inventory\"\n            className=\"print-inventory-btn\"\n          />\n        <Button onClick={handleAddProduct}>\n          Add Product\n        </Button>\n        </div>\n      </div>\n\n      {error && (\n        <div className=\"error-message\">\n          {error}\n        </div>\n      )}\n\n      <div className=\"inventory-filters\">\n        <div className=\"filter-group\">\n          <label>Category:</label>\n          <select \n            value={filters.category} \n            onChange={(e) => handleFilterChange('category', e.target.value)}\n          >\n            <option value=\"\">All Categories</option>\n            {categories.map(category => (\n              <option key={category.id} value={category.id}>\n                {category.name}\n              </option>\n            ))}\n          </select>\n        </div>\n        <div className=\"filter-group\">\n          <label>Stock Status:</label>\n          <select \n            value={filters.stockStatus} \n            onChange={(e) => handleFilterChange('stockStatus', e.target.value)}\n          >\n            <option value=\"\">All</option>\n            <option value=\"low\">Low Stock</option>\n            <option value=\"out\">Out of Stock</option>\n          </select>\n        </div>\n        <div className=\"filter-group\">\n          <label>Search:</label>\n          <input\n            type=\"text\"\n            placeholder=\"Search products...\"\n            value={filters.search}\n            onChange={(e) => handleFilterChange('search', e.target.value)}\n          />\n        </div>\n        <div className=\"filter-group\">\n          <Button variant=\"outline\" size=\"small\" onClick={clearFilters}>\n            Clear Filters\n          </Button>\n        </div>\n      </div>\n\n      <Table\n        data={products}\n        columns={columns}\n        loading={loading}\n        emptyMessage=\"No products found\"\n      />\n\n      {showAddModal && (\n        <ProductModal\n          product={editingProduct}\n          categories={categories}\n          taxClasses={taxClasses}\n          onClose={() => setShowAddModal(false)}\n          onSave={() => {\n            setShowAddModal(false);\n            fetchProducts(filters);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nconst ProductModal = ({ product, categories, taxClasses, onClose, onSave }) => {\n  const [formData, setFormData] = useState({\n    name: product?.name || '',\n    description: product?.description || '',\n    category: product?.category || '',\n    tax_class: product?.tax_class || '',\n    sku: product?.sku || '',\n    price: product?.price || '',\n    cost_price: product?.cost_price || '',\n    stock_quantity: product?.stock_quantity || 0,\n    min_stock_level: product?.min_stock_level || 10,\n    max_stock_level: product?.max_stock_level || 1000,\n    base_unit: product?.base_unit?.id || product?.base_unit || '',\n    is_active: product?.is_active ?? true\n  });\n  const [units, setUnits] = useState([]);\n  const [allUnits, setAllUnits] = useState([]);\n  const [compatibleUnits, setCompatibleUnits] = useState([]);\n  const [showUnitSelector, setShowUnitSelector] = useState(false);\n  const [convertibleUnits, setConvertibleUnits] = useState([]);\n  const [unitConversions, setUnitConversions] = useState([]);\n  const [baseValues, setBaseValues] = useState(null); // Store original base unit values\n\n  // Function to get conversion factor between units\n  const getConversionFactor = useCallback((fromUnitId, toUnitId) => {\n    if (fromUnitId === toUnitId) return 1;\n    \n    // Look for direct conversion\n    let conversion = unitConversions.find(conv => \n      (conv.from_unit === fromUnitId && conv.to_unit === toUnitId)\n    );\n    \n    if (conversion) {\n      console.log('Found direct conversion:', conversion);\n      return conversion.conversion_factor;\n    }\n    \n    // Look for reverse conversion\n    conversion = unitConversions.find(conv => \n      (conv.from_unit === toUnitId && conv.to_unit === fromUnitId)\n    );\n    \n    if (conversion) {\n      console.log('Found reverse conversion:', conversion);\n      return 1 / conversion.conversion_factor;\n    }\n    \n    console.log('No conversion found between', fromUnitId, 'and', toUnitId);\n    console.log('Available conversions:', unitConversions.map(c => `${c.from_unit}->${c.to_unit}: ${c.conversion_factor}`));\n    return null;\n  }, [unitConversions]);\n\n\n  // Load base units when component mounts (for product creation/editing)\n  useEffect(() => {\n    const fetchUnits = async () => {\n      try {\n        console.log('=== FETCHING UNITS ===');\n        \n        // Fetch base units\n        const baseUnitsResponse = await api.get('/products/base-units/');\n        console.log('Base units response:', baseUnitsResponse.data);\n        const baseUnits = baseUnitsResponse.data.results || baseUnitsResponse.data;\n        setUnits(baseUnits);\n        console.log('Setting base units:', baseUnits);\n        \n        // Fetch ALL units with pagination\n        let allUnitsData = [];\n        let nextUrl = '/products/units/';\n        while (nextUrl) {\n          const response = await api.get(nextUrl);\n          const data = response.data;\n          allUnitsData = allUnitsData.concat(data.results || data);\n          nextUrl = data.next;\n          console.log('Fetched page, total units so far:', allUnitsData.length);\n        }\n        \n        console.log('All units fetched:', allUnitsData);\n        setAllUnits(allUnitsData);\n        \n        // Handle pagination for conversions\n        let allConversions = [];\n        nextUrl = '/products/unit-conversions/';\n        while (nextUrl) {\n          const response = await api.get(nextUrl);\n          const data = response.data;\n          allConversions = allConversions.concat(data.results || data);\n          nextUrl = data.next;\n        }\n        console.log('Setting unit conversions:', allConversions);\n        setUnitConversions(allConversions);\n        console.log('=== UNITS LOADED ===');\n      } catch (err) {\n        console.error('Failed to load units:', err);\n      }\n    };\n    fetchUnits();\n  }, []);\n\n  // Load compatible units when editing a product\n  useEffect(() => {\n    if (product && product.compatible_units) {\n      setCompatibleUnits(product.compatible_units);\n      \n      // Store the original base values\n      setBaseValues({\n        price: parseFloat(product.price || 0),\n        cost_price: parseFloat(product.cost_price || 0),\n        stock_quantity: parseFloat(product.stock_quantity || 0),\n        min_stock_level: parseFloat(product.min_stock_level || 0),\n        max_stock_level: parseFloat(product.max_stock_level || 0)\n      });\n    } else {\n      setCompatibleUnits([]);\n      setBaseValues(null);\n    }\n  }, [product]);\n\n\n  // Debug: Monitor formData changes\n  useEffect(() => {\n    console.log('FormData changed:', formData);\n  }, [formData]);\n\n  // Debug: Monitor allUnits changes\n  useEffect(() => {\n    console.log('AllUnits changed:', allUnits);\n  }, [allUnits]);\n\n  // Debug: Monitor units changes\n  useEffect(() => {\n    console.log('Units changed:', units);\n  }, [units]);\n\n  // Fetch convertible units when base unit changes\n  useEffect(() => {\n    const fetchConvertibleUnits = async () => {\n      if (formData.base_unit) {\n        try {\n          // Use a unified approach for both new and existing products\n          // Get all unit conversions and find units that can be converted to/from the base unit\n          // Handle pagination to get all conversions\n          let allConversions = [];\n          let nextUrl = '/products/unit-conversions/';\n          \n          while (nextUrl) {\n            const response = await api.get(nextUrl);\n            const data = response.data;\n            allConversions = allConversions.concat(data.results || data);\n            nextUrl = data.next; // Next page URL\n          }\n          \n          const conversions = allConversions;\n          \n          const baseUnitId = parseInt(formData.base_unit);\n          const convertible = [];\n          \n          // Find units that have conversions with the base unit\n          conversions.forEach(conversion => {\n            if (conversion.from_unit === baseUnitId && !convertible.find(u => u.id === conversion.to_unit)) {\n              // Find the unit details\n              const unit = allUnits.find(u => u.id === conversion.to_unit);\n              if (unit) {\n                convertible.push({\n                  id: unit.id,\n                  name: unit.name,\n                  symbol: unit.symbol,\n                  is_base_unit: unit.is_base_unit\n                });\n              }\n            } else if (conversion.to_unit === baseUnitId && !convertible.find(u => u.id === conversion.from_unit)) {\n              // Find the unit details\n              const unit = allUnits.find(u => u.id === conversion.from_unit);\n              if (unit) {\n                convertible.push({\n                  id: unit.id,\n                  name: unit.name,\n                  symbol: unit.symbol,\n                  is_base_unit: unit.is_base_unit\n                });\n              }\n            }\n          });\n          \n          setConvertibleUnits(convertible);\n        } catch (err) {\n          console.error('Failed to fetch convertible units:', err);\n          setConvertibleUnits([]);\n        }\n      } else {\n        setConvertibleUnits([]);\n      }\n    };\n\n    fetchConvertibleUnits();\n  }, [formData.base_unit, allUnits]);\n\n  // Update form data when product changes (for editing)\n  useEffect(() => {\n    if (product) {\n      setFormData({\n        name: product.name || '',\n        description: product.description || '',\n        category: product.category || '',\n        tax_class: product.tax_class || '',\n        sku: product.sku || '',\n        price: product.price || '',\n        cost_price: product.cost_price || '',\n        stock_quantity: product.stock_quantity || 0,\n        min_stock_level: product.min_stock_level || 10,\n        max_stock_level: product.max_stock_level || 1000,\n        base_unit: product.base_unit?.id || product.base_unit || '',\n        is_active: product.is_active ?? true\n      });\n    }\n  }, [product]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n\n\n\n  const handleChange = (e) => {\n    const { name, value, type, checked } = e.target;\n    setFormData({\n      ...formData,\n      [name]: type === 'checkbox' ? checked : value\n    });\n  };\n\n\n  const addCompatibleUnit = async (unitId) => {\n    if (!product) return;\n    \n    // Check if the unit is already the base unit\n    if (parseInt(unitId) === parseInt(formData.base_unit)) {\n      alert('Cannot add the base unit as a compatible unit.');\n      return;\n    }\n    \n    // Check if the unit is already added\n    const alreadyAdded = compatibleUnits.some(cu => cu.unit === parseInt(unitId));\n    if (alreadyAdded) {\n      alert('This unit is already added as a compatible unit.');\n      return;\n    }\n    \n    try {\n      const response = await api.post(`/products/${product.id}/units/`, {\n        unit: parseInt(unitId),\n        is_default: false,\n        is_active: true\n      });\n      \n      setCompatibleUnits([...compatibleUnits, response.data]);\n      setShowUnitSelector(false);\n    } catch (err) {\n      console.error('Failed to add compatible unit:', err);\n      alert(`Failed to add compatible unit: ${err.response?.data?.detail || err.message}`);\n    }\n  };\n\n  const removeCompatibleUnit = async (productUnitId) => {\n    if (!product) return;\n    \n    try {\n      await api.delete(`/products/${product.id}/units/${productUnitId}/`);\n      setCompatibleUnits(compatibleUnits.filter(cu => cu.id !== productUnitId));\n    } catch (err) {\n      console.error('Failed to remove compatible unit:', err);\n    }\n  };\n\n  const setDefaultUnit = async (productUnitId) => {\n    if (!product) return;\n    \n    try {\n      // First, set all units to non-default\n      for (const cu of compatibleUnits) {\n        if (cu.is_default) {\n          await api.put(`/products/${product.id}/units/${cu.id}/`, {\n            ...cu,\n            is_default: false\n          });\n        }\n      }\n      \n      // Then set the selected unit as default\n      const unitToUpdate = compatibleUnits.find(cu => cu.id === productUnitId);\n      if (unitToUpdate) {\n        await api.put(`/products/${product.id}/units/${productUnitId}/`, {\n          ...unitToUpdate,\n          is_default: true\n        });\n        \n        // Update local state\n        setCompatibleUnits(compatibleUnits.map(cu => ({\n          ...cu,\n          is_default: cu.id === productUnitId\n        })));\n        \n        // Note: Display unit functionality removed - default unit selection handles this\n      }\n    } catch (err) {\n      console.error('Failed to set default unit:', err);\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    setError('');\n\n    try {\n      // Use form data directly\n      let finalFormData = { ...formData };\n\n      // Prepare data for submission\n      const submitData = {\n        ...finalFormData,\n        base_unit: finalFormData.base_unit ? parseInt(finalFormData.base_unit) : null\n      };\n\n      console.log('Submitting data:', submitData);\n      console.log('Original form data:', formData);\n\n      if (product) {\n        await api.put(`/products/${product.id}/`, submitData);\n      } else {\n        await api.post('/products/', submitData);\n      }\n      onSave();\n    } catch (err) {\n      setError(err.response?.data?.detail || 'Failed to save product');\n      console.error('Save error:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"modal-overlay\">\n      <div className=\"modal\">\n        <div className=\"modal-header\">\n          <h2>{product ? 'Edit Product' : 'Add Product'}</h2>\n          <button className=\"modal-close\" onClick={onClose}>×</button>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"modal-form\">\n          {error && (\n            <div className=\"error-message\">\n              {error}\n            </div>\n          )}\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Product Name *</label>\n              <input\n                type=\"text\"\n                name=\"name\"\n                value={formData.name}\n                onChange={handleChange}\n                required\n              />\n            </div>\n            <div className=\"form-group\">\n              <label>SKU *</label>\n              <input\n                type=\"text\"\n                name=\"sku\"\n                value={formData.sku}\n                onChange={handleChange}\n                required\n              />\n            </div>\n          </div>\n\n          <div className=\"form-group\">\n            <label>Description</label>\n            <textarea\n              name=\"description\"\n              value={formData.description}\n              onChange={handleChange}\n              rows=\"3\"\n            />\n          </div>\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Category *</label>\n              <select\n                name=\"category\"\n                value={formData.category}\n                onChange={handleChange}\n                required\n              >\n                <option value=\"\">Select Category</option>\n                {categories.map(category => (\n                  <option key={category.id} value={category.id}>\n                    {category.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n            <div className=\"form-group\">\n              <label>Tax Class</label>\n              <select\n                name=\"tax_class\"\n                value={formData.tax_class}\n                onChange={handleChange}\n              >\n                <option value=\"\">No Tax Class</option>\n                {taxClasses.map(taxClass => (\n                  <option key={taxClass.id} value={taxClass.id}>\n                    {taxClass.name} ({taxClass.tax_rate}%)\n                  </option>\n                ))}\n              </select>\n            </div>\n          </div>\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Base Unit</label>\n              <select\n                name=\"base_unit\"\n                value={formData.base_unit}\n                onChange={handleChange}\n                required\n              >\n                <option value=\"\">Select Base Unit</option>\n                {units.map(unit => (\n                  <option key={unit.id} value={unit.id}>\n                    {unit.name} ({unit.symbol})\n                  </option>\n                ))}\n              </select>\n            </div>\n            \n          </div>\n\n          {/* Compatible Units Section - Only show when editing existing product */}\n          {product && (\n            <div className=\"form-row\">\n              <div className=\"form-group\">\n                <label>Compatible Units</label>\n                <p className=\"compatible-units-note\">\n                  Only units that can be converted to/from the base unit can be added as compatible units.\n                </p>\n                <div className=\"compatible-units-section\">\n                  {compatibleUnits.length > 0 ? (\n                    <div className=\"compatible-units-list\">\n                      {compatibleUnits.map(compatibleUnit => (\n                        <div key={compatibleUnit.id} className=\"compatible-unit-item\">\n                          <div className=\"unit-info\">\n                            <span className=\"unit-name\">\n                              {compatibleUnit.unit_name} ({compatibleUnit.unit_symbol})\n                            </span>\n                            {compatibleUnit.is_default && (\n                              <span className=\"default-badge\">Default</span>\n                            )}\n                          </div>\n                          <div className=\"unit-actions\">\n                            {!compatibleUnit.is_default && (\n                              <Button\n                                size=\"small\"\n                                variant=\"outline\"\n                                onClick={() => setDefaultUnit(compatibleUnit.id)}\n                              >\n                                Set Default\n                              </Button>\n                            )}\n                            <Button\n                              size=\"small\"\n                              variant=\"danger\"\n                              onClick={() => removeCompatibleUnit(compatibleUnit.id)}\n                            >\n                              Remove\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <p className=\"no-units-message\">No compatible units added yet.</p>\n                  )}\n                  \n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => setShowUnitSelector(true)}\n                    className=\"add-unit-button\"\n                    disabled={!formData.base_unit || convertibleUnits.filter(unit => {\n                      const isAlreadyAdded = compatibleUnits.some(cu => cu.unit === unit.id);\n                      const isBaseUnit = unit.id === parseInt(formData.base_unit);\n                      return !isAlreadyAdded && !isBaseUnit;\n                    }).length === 0}\n                  >\n                    + Add Compatible Unit\n                    {!formData.base_unit && \" (Select base unit first)\"}\n                    {formData.base_unit && convertibleUnits.filter(unit => {\n                      const isAlreadyAdded = compatibleUnits.some(cu => cu.unit === unit.id);\n                      const isBaseUnit = unit.id === parseInt(formData.base_unit);\n                      return !isAlreadyAdded && !isBaseUnit;\n                    }).length === 0 && \" (No convertible units)\"}\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Price *</label>\n              <input\n                type=\"number\"\n                step=\"0.01\"\n                name=\"price\"\n                value={formData.price}\n                onChange={handleChange}\n                required\n              />\n            </div>\n            <div className=\"form-group\">\n              <label>Cost Price</label>\n              <input\n                type=\"number\"\n                step=\"0.01\"\n                name=\"cost_price\"\n                value={formData.cost_price}\n                onChange={handleChange}\n              />\n            </div>\n          </div>\n\n          <div className=\"form-row\">\n            <div className=\"form-group\">\n              <label>Stock Quantity</label>\n              <input\n                type=\"number\"\n                name=\"stock_quantity\"\n                value={formData.stock_quantity}\n                onChange={handleChange}\n              />\n            </div>\n            <div className=\"form-group\">\n              <label>Min Stock Level</label>\n              <input\n                type=\"number\"\n                name=\"min_stock_level\"\n                value={formData.min_stock_level}\n                onChange={handleChange}\n              />\n            </div>\n          </div>\n\n          <div className=\"form-group\">\n            <label>Max Stock Level</label>\n            <input\n              type=\"number\"\n              name=\"max_stock_level\"\n              value={formData.max_stock_level}\n              onChange={handleChange}\n            />\n          </div>\n\n          <div className=\"form-group\">\n            <label>\n              <input\n                type=\"checkbox\"\n                name=\"is_active\"\n                checked={formData.is_active}\n                onChange={handleChange}\n              />\n              Active\n            </label>\n          </div>\n\n          <div className=\"modal-actions\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" loading={loading}>\n              {product ? 'Update' : 'Create'}\n            </Button>\n          </div>\n        </form>\n      </div>\n\n      {/* Unit Selector Modal */}\n      {showUnitSelector && (\n        <div className=\"modal-overlay\">\n          <div className=\"modal-content unit-selector-modal\">\n            <div className=\"modal-header\">\n              <h3>Add Compatible Unit</h3>\n              <button \n                className=\"modal-close\" \n                onClick={() => setShowUnitSelector(false)}\n              >\n                ×\n              </button>\n            </div>\n            <div className=\"modal-body\">\n              <p>Select a unit to add as compatible for this product:</p>\n              <p className=\"unit-selector-note\">\n                Only units that can be converted to/from the base unit are shown.\n              </p>\n              <div className=\"unit-selector-list\">\n                {convertibleUnits\n                  .filter(unit => {\n                    const isAlreadyAdded = compatibleUnits.some(cu => cu.unit === unit.id);\n                    const isBaseUnit = unit.id === parseInt(formData.base_unit);\n                    return !isAlreadyAdded && !isBaseUnit;\n                  })\n                  .map(unit => (\n                    <div \n                      key={unit.id} \n                      className=\"unit-selector-item\"\n                      onClick={() => addCompatibleUnit(unit.id)}\n                    >\n                      <div className=\"unit-info\">\n                        <span className=\"unit-name\">{unit.name}</span>\n                        <span className=\"unit-symbol\">({unit.symbol})</span>\n                        {unit.is_base_unit && (\n                          <span className=\"base-unit-badge\">Base Unit</span>\n                        )}\n                      </div>\n                    </div>\n                  ))\n                }\n                {convertibleUnits.filter(unit => \n                  !compatibleUnits.some(cu => cu.unit === unit.id) && unit.id !== parseInt(formData.base_unit)\n                ).length === 0 && (\n                  <p className=\"no-units-available\">\n                    {formData.base_unit \n                      ? \"No convertible units available for the selected base unit.\" \n                      : \"Please select a base unit first.\"\n                    }\n                  </p>\n                )}\n              </div>\n            </div>\n            <div className=\"modal-actions\">\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => setShowUnitSelector(false)}\n              >\n                Cancel\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Inventory;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}