{"ast":null,"code":"import _objectSpread from\"/home/el-ifran/WareHouse_Manager/beverage_management_system/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import api from'../services/api';import Button from'../components/Button';import{formatCurrency,formatDate}from'../utils/helpers';import{useAuth}from'../contexts/AuthContext';import'./PendingSales.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PendingSales=()=>{var _selectedSale$payment,_selectedSale$items,_selectedSale$items2,_stockValidationStatu4,_stockValidationStatu5,_stockValidationStatu6,_editFormData$items,_editFormData$items2;const{user,loading:authLoading}=useAuth();const[pendingSales,setPendingSales]=useState([]);const[loading,setLoading]=useState(true);const[showSaleModal,setShowSaleModal]=useState(false);const[selectedSale,setSelectedSale]=useState(null);const[showEditModal,setShowEditModal]=useState(false);const[editingSale,setEditingSale]=useState(null);const[editFormData,setEditFormData]=useState({});const[completingSale,setCompletingSale]=useState(null);const[stockValidationStatus,setStockValidationStatus]=useState({});useEffect(()=>{if(!authLoading&&user){fetchPendingSales();}},[authLoading,user]);useEffect(()=>{if(pendingSales.length>0){validateStockForAllSales();}},[pendingSales]);const fetchPendingSales=async()=>{try{setLoading(true);console.log('Fetching pending sales from:','/sales/pending/');// Check if user is authenticated\nconst token=localStorage.getItem('accessToken');console.log('Auth token exists:',!!token);console.log('Auth token:',token?token.substring(0,20)+'...':'None');const response=await api.get('/sales/pending/');console.log('Pending sales response:',response.data);setPendingSales(response.data);}catch(error){var _error$response,_error$response2,_error$response3,_error$response4;console.error('Error fetching pending sales:',error);console.error('Error details:',{message:error.message,response:(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data,status:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status,statusText:(_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.statusText});// More specific error handling\nif(((_error$response4=error.response)===null||_error$response4===void 0?void 0:_error$response4.status)===401){alert('Authentication required. Please log in again.');// Redirect to login or refresh token\nwindow.location.href='/login';}else{var _error$response5,_error$response5$data;alert('Error fetching pending sales: '+(((_error$response5=error.response)===null||_error$response5===void 0?void 0:(_error$response5$data=_error$response5.data)===null||_error$response5$data===void 0?void 0:_error$response5$data.detail)||error.message));}}finally{setLoading(false);}};const validateStockForAllSales=async()=>{const validationStatus={};for(const sale of pendingSales){let hasInsufficientStock=false;for(const item of sale.items||[]){try{const response=await api.get(\"/products/\".concat(item.product,\"/stock-availability/\"));const stockData=response.data;if(stockData.available_units){const unitData=stockData.available_units.find(unit=>unit.id===item.unit);if(unitData&&unitData.available_quantity<item.quantity_display){hasInsufficientStock=true;break;}}}catch(error){console.error(\"Error checking stock for product \".concat(item.product,\":\"),error);}}validationStatus[sale.id]={hasInsufficientStock};}setStockValidationStatus(validationStatus);};const completeSale=async saleId=>{try{setCompletingSale(saleId);// Check stock before completing\nconst sale=pendingSales.find(s=>s.id===saleId);const stockValidationErrors=[];for(const item of sale.items||[]){try{const response=await api.get(\"/products/\".concat(item.product,\"/stock-availability/\"));const stockData=response.data;if(stockData.available_units){const unitData=stockData.available_units.find(unit=>unit.id===item.unit);if(unitData&&unitData.available_quantity<item.quantity_display){stockValidationErrors.push(\"\".concat(item.product_name,\": Required \").concat(item.quantity_display,\" \").concat(item.unit_name,\", but only \").concat(unitData.available_quantity,\" available\"));}}}catch(error){console.error(\"Error checking stock for product \".concat(item.product,\":\"),error);stockValidationErrors.push(\"\".concat(item.product_name,\": Unable to check stock availability\"));}}if(stockValidationErrors.length>0){alert('Cannot complete sale due to insufficient stock:\\n'+stockValidationErrors.join('\\n'));return;}await api.post(\"/sales/\".concat(saleId,\"/complete/\"));// Print receipt after successful completion\nconst completedSale=_objectSpread(_objectSpread({},sale),{},{status:'completed'});printPendingSale(completedSale);// Remove from pending sales list\nsetPendingSales(prev=>prev.filter(sale=>sale.id!==saleId));setShowSaleModal(false);setSelectedSale(null);alert('Sale completed successfully!');}catch(error){var _error$response6,_error$response6$data;console.error('Error completing sale:',error);alert('Error completing sale: '+(((_error$response6=error.response)===null||_error$response6===void 0?void 0:(_error$response6$data=_error$response6.data)===null||_error$response6$data===void 0?void 0:_error$response6$data.detail)||error.message));}finally{setCompletingSale(null);}};const cancelSale=async saleId=>{if(window.confirm('Are you sure you want to cancel this sale?')){try{await api.delete(\"/sales/\".concat(saleId,\"/\"));setPendingSales(prev=>prev.filter(sale=>sale.id!==saleId));setShowSaleModal(false);setSelectedSale(null);alert('Sale cancelled successfully!');}catch(error){var _error$response7,_error$response7$data;console.error('Error cancelling sale:',error);alert('Error cancelling sale: '+(((_error$response7=error.response)===null||_error$response7===void 0?void 0:(_error$response7$data=_error$response7.data)===null||_error$response7$data===void 0?void 0:_error$response7$data.detail)||error.message));}}};const printPendingSale=sale=>{var _sale$payment_method,_sale$items;const printData=_objectSpread(_objectSpread({},sale),{},{status:sale.status==='completed'?'completed':'pending',statusText:sale.status==='completed'?'This sale has been completed':'This sale is pending'});// Create a new window for printing\nconst printWindow=window.open('','_blank');printWindow.document.write(\"\\n      <!DOCTYPE html>\\n      <html>\\n        <head>\\n          <title>Receipt - \".concat(sale.sale_number,\"</title>\\n          <style>\\n            body { font-family: Arial, sans-serif; margin: 20px; }\\n            .header { text-align: center; margin-bottom: 20px; }\\n            .receipt-info { margin-bottom: 20px; }\\n            .items { margin-bottom: 20px; }\\n            .item { display: flex; justify-content: space-between; margin-bottom: 5px; }\\n            .totals { border-top: 1px solid #000; padding-top: 10px; }\\n            .total-row { display: flex; justify-content: space-between; margin-bottom: 5px; }\\n            .total-final { font-weight: bold; font-size: 1.2em; }\\n            .status { text-align: center; margin-top: 20px; font-weight: bold; }\\n          </style>\\n        </head>\\n        <body>\\n          <div class=\\\"header\\\">\\n            <h1>Beverage Management System</h1>\\n            <h2>Receipt - \").concat(sale.sale_number,\"</h2>\\n          </div>\\n          \\n          <div class=\\\"receipt-info\\\">\\n            <p><strong>Date:</strong> \").concat(formatDate(sale.created_at),\"</p>\\n            <p><strong>Customer:</strong> \").concat(sale.customer_name||'Walk-in Customer',\"</p>\\n            <p><strong>Payment Method:</strong> \").concat((_sale$payment_method=sale.payment_method)===null||_sale$payment_method===void 0?void 0:_sale$payment_method.replace('_',' ').toUpperCase(),\"</p>\\n          </div>\\n          \\n          <div class=\\\"items\\\">\\n            <h3>Items:</h3>\\n            \").concat((_sale$items=sale.items)===null||_sale$items===void 0?void 0:_sale$items.map(item=>\"\\n              <div class=\\\"item\\\">\\n                <span>\".concat(item.product_name,\" - \").concat(item.quantity_display||item.quantity,\" \").concat(item.unit_name,\" \\xD7 \").concat(formatCurrency(item.unit_price),\" MGA</span>\\n                <span>\").concat(formatCurrency(item.total_price),\" MGA</span>\\n              </div>\\n            \")).join(''),\"\\n          </div>\\n          \\n          <div class=\\\"totals\\\">\\n            <div class=\\\"total-row\\\">\\n              <span>Subtotal:</span>\\n              <span>\").concat(formatCurrency(sale.subtotal),\" MGA</span>\\n            </div>\\n            \").concat(sale.discount_amount>0?\"\\n              <div class=\\\"total-row\\\">\\n                <span>Discount:</span>\\n                <span>-\".concat(formatCurrency(sale.discount_amount),\" MGA</span>\\n              </div>\\n            \"):'',\"\\n            \").concat(sale.tax_amount>0?\"\\n              <div class=\\\"total-row\\\">\\n                <span>Tax:</span>\\n                <span>\".concat(formatCurrency(sale.tax_amount),\" MGA</span>\\n              </div>\\n            \"):'',\"\\n            <div class=\\\"total-row total-final\\\">\\n              <span>Total:</span>\\n              <span>\").concat(formatCurrency(sale.total_amount),\" MGA</span>\\n            </div>\\n          </div>\\n          \\n          <div class=\\\"status\\\">\\n            <p>\").concat(printData.statusText,\"</p>\\n          </div>\\n        </body>\\n      </html>\\n    \"));printWindow.document.close();printWindow.print();};const editSale=sale=>{var _sale$items2;setEditingSale(sale);// Initialize items with proper quantities and calculate totals\nconst items=((_sale$items2=sale.items)===null||_sale$items2===void 0?void 0:_sale$items2.map(item=>_objectSpread(_objectSpread({},item),{},{quantity:parseFloat(item.quantity_display||item.quantity)||0,unit_price:parseFloat(item.unit_price)||0,total_price:(parseFloat(item.quantity_display||item.quantity)||0)*(parseFloat(item.unit_price)||0)})))||[];// Calculate initial totals\nconst calculatedSubtotal=items.reduce((sum,item)=>sum+item.total_price,0);// If no tax_amount is provided, assume 0% tax (common for many sales)\nconst taxAmount=sale.tax_amount||0;const discountAmount=sale.discount_amount||0;const calculatedTotal=calculatedSubtotal+taxAmount-discountAmount;// Use the sale's total_amount if it exists and is greater than 0, otherwise use calculated total\nconst subtotal=sale.subtotal&&sale.subtotal>0?sale.subtotal:calculatedSubtotal;const total_amount=sale.total_amount&&sale.total_amount>0?sale.total_amount:calculatedTotal;console.log('Edit Sale Debug:',{sale:sale,items:items,calculatedSubtotal:calculatedSubtotal,calculatedTotal:calculatedTotal,saleSubtotal:sale.subtotal,saleTotalAmount:sale.total_amount,finalSubtotal:subtotal,finalTotalAmount:total_amount,tax_amount:sale.tax_amount,discount_amount:sale.discount_amount});const formData={customer_name:sale.customer_name||'',customer_phone:sale.customer_phone||'',customer_email:sale.customer_email||'',payment_method:sale.payment_method||'cash',items:items,subtotal:subtotal,total_amount:total_amount,tax_amount:sale.tax_amount||0,discount_amount:sale.discount_amount||0};console.log('Setting EditFormData:',formData);setEditFormData(formData);setShowEditModal(true);setShowSaleModal(false);};const handleEditItemQuantity=(itemIndex,newQuantity)=>{const updatedItems=[...editFormData.items];updatedItems[itemIndex].quantity=parseFloat(newQuantity)||0;updatedItems[itemIndex].total_price=updatedItems[itemIndex].quantity*parseFloat(updatedItems[itemIndex].unit_price)||0;const subtotal=updatedItems.reduce((sum,item)=>sum+item.total_price,0);console.log('Quantity Change Debug:',{itemIndex:itemIndex,newQuantity:newQuantity,unitPrice:updatedItems[itemIndex].unit_price,totalPrice:updatedItems[itemIndex].total_price,subtotal:subtotal});// Fallback to original sale values if editFormData doesn't have them\nconst taxAmount=editFormData.tax_amount!==undefined?editFormData.tax_amount:(editingSale===null||editingSale===void 0?void 0:editingSale.tax_amount)||0;const discountAmount=editFormData.discount_amount!==undefined?editFormData.discount_amount:(editingSale===null||editingSale===void 0?void 0:editingSale.discount_amount)||0;const newTotalAmount=subtotal+taxAmount-discountAmount;console.log('Quantity Change Debug - Totals:',{subtotal:subtotal,taxAmount:taxAmount,discountAmount:discountAmount,newTotalAmount:newTotalAmount,editFormDataTax:editFormData.tax_amount,editFormDataDiscount:editFormData.discount_amount});setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{items:updatedItems,subtotal:subtotal,total_amount:newTotalAmount}));};const removeEditItem=itemIndex=>{const updatedItems=editFormData.items.filter((_,index)=>index!==itemIndex);const subtotal=updatedItems.reduce((sum,item)=>sum+item.total_price,0);// Fallback to original sale values if editFormData doesn't have them\nconst taxAmount=editFormData.tax_amount!==undefined?editFormData.tax_amount:(editingSale===null||editingSale===void 0?void 0:editingSale.tax_amount)||0;const discountAmount=editFormData.discount_amount!==undefined?editFormData.discount_amount:(editingSale===null||editingSale===void 0?void 0:editingSale.discount_amount)||0;const newTotalAmount=subtotal+taxAmount-discountAmount;setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{items:updatedItems,subtotal:subtotal,total_amount:newTotalAmount}));};const handleEditItemPriceMode=async(itemIndex,newPriceMode)=>{try{const item=editFormData.items[itemIndex];const response=await api.get(\"/products/\".concat(item.product,\"/\"));const product=response.data;let newUnitPrice;if(newPriceMode==='wholesale'){newUnitPrice=product.wholesale_price||product.price;}else{newUnitPrice=product.price;}const updatedItems=[...editFormData.items];updatedItems[itemIndex].price_mode=newPriceMode;updatedItems[itemIndex].unit_price=parseFloat(newUnitPrice)||0;updatedItems[itemIndex].total_price=updatedItems[itemIndex].quantity*(parseFloat(newUnitPrice)||0);const subtotal=updatedItems.reduce((sum,item)=>sum+item.total_price,0);// Fallback to original sale values if editFormData doesn't have them\nconst taxAmount=editFormData.tax_amount!==undefined?editFormData.tax_amount:(editingSale===null||editingSale===void 0?void 0:editingSale.tax_amount)||0;const discountAmount=editFormData.discount_amount!==undefined?editFormData.discount_amount:(editingSale===null||editingSale===void 0?void 0:editingSale.discount_amount)||0;const newTotalAmount=subtotal+taxAmount-discountAmount;setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{items:updatedItems,subtotal:subtotal,total_amount:newTotalAmount}));}catch(error){var _error$response8,_error$response8$data;console.error('Error updating price mode:',error);alert('Error updating price mode: '+(((_error$response8=error.response)===null||_error$response8===void 0?void 0:(_error$response8$data=_error$response8.data)===null||_error$response8$data===void 0?void 0:_error$response8$data.detail)||error.message));}};const saveEditedSale=async()=>{try{const updateData={customer_name:editFormData.customer_name,customer_phone:editFormData.customer_phone,customer_email:editFormData.customer_email,payment_method:editFormData.payment_method,items:editFormData.items.map(item=>({id:item.id,quantity:item.quantity,unit_price:item.unit_price,price_mode:item.price_mode}))};console.log('Saving edited sale:',{saleId:editingSale.id,updateData:updateData,editFormData:editFormData});const response=await api.patch(\"/sales/\".concat(editingSale.id,\"/\"),updateData);console.log('Save response:',response.data);setShowEditModal(false);setEditingSale(null);setEditFormData({});// Refresh the pending sales list\nfetchPendingSales();alert('Sale updated successfully!');}catch(error){var _error$response9,_error$response9$data;console.error('Error updating sale:',error);alert('Error updating sale: '+(((_error$response9=error.response)===null||_error$response9===void 0?void 0:(_error$response9$data=_error$response9.data)===null||_error$response9$data===void 0?void 0:_error$response9$data.detail)||error.message));}};if(authLoading||loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"pending-sales-page\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"page-header\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"Pending Sales\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"loading-message\",children:\"Loading pending sales...\"})]});}if(!user){return/*#__PURE__*/_jsxs(\"div\",{className:\"pending-sales-page\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"page-header\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"Pending Sales\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"loading-message\",children:\"Please log in to view pending sales.\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"pending-sales-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"page-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Pending Sales\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Manage and validate pending sales before completion\"})]}),pendingSales.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"no-pending-sales\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"no-sales-icon\",children:\"\\uD83D\\uDCCB\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"No Pending Sales\"}),/*#__PURE__*/_jsx(\"p\",{children:\"All sales have been completed or there are no pending sales at the moment.\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"pending-sales-grid\",children:pendingSales.map(sale=>{var _sale$items3,_sale$items4,_sale$items5,_stockValidationStatu,_stockValidationStatu2,_stockValidationStatu3;return/*#__PURE__*/_jsxs(\"div\",{className:\"pending-sale-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sale-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sale-number\",children:sale.sale_number}),/*#__PURE__*/_jsx(\"div\",{className:\"sale-date\",children:formatDate(sale.created_at)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sale-customer\",children:/*#__PURE__*/_jsx(\"strong\",{children:sale.customer_name||'Walk-in Customer'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"sale-items\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"items-count\",children:[((_sale$items3=sale.items)===null||_sale$items3===void 0?void 0:_sale$items3.length)||0,\" items\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"items-preview\",children:[(_sale$items4=sale.items)===null||_sale$items4===void 0?void 0:_sale$items4.slice(0,3).map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"item-preview\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"item-name\",children:item.product_name}),/*#__PURE__*/_jsxs(\"span\",{className:\"item-quantity\",children:[item.quantity_display||item.quantity,\" \",item.unit_name]}),/*#__PURE__*/_jsx(\"span\",{className:\"price-mode-badge \".concat(item.price_mode==='wholesale'?'wholesale':''),children:item.price_mode==='wholesale'?'WS':'STD'})]},index)),((_sale$items5=sale.items)===null||_sale$items5===void 0?void 0:_sale$items5.length)>3&&/*#__PURE__*/_jsxs(\"div\",{className:\"more-items\",children:[\"+\",sale.items.length-3,\" more items\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sale-total\",children:/*#__PURE__*/_jsxs(\"strong\",{children:[formatCurrency(sale.total_amount),\" MGA\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"stock-status\",children:(_stockValidationStatu=stockValidationStatus[sale.id])!==null&&_stockValidationStatu!==void 0&&_stockValidationStatu.hasInsufficientStock?/*#__PURE__*/_jsx(\"div\",{className:\"stock-insufficient\",children:\"\\u26A0\\uFE0F Insufficient Stock\"}):/*#__PURE__*/_jsx(\"div\",{className:\"stock-sufficient\",children:\"\\u2705 Stock Available\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"sale-actions\",children:[/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outline\",onClick:()=>{setSelectedSale(sale);setShowSaleModal(true);},children:\"View Details\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outline\",onClick:()=>printPendingSale(sale),children:\"\\uD83D\\uDDA8\\uFE0F Print\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"outline\",onClick:()=>editSale(sale),children:\"\\u270F\\uFE0F Edit\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"primary\",disabled:(_stockValidationStatu2=stockValidationStatus[sale.id])===null||_stockValidationStatu2===void 0?void 0:_stockValidationStatu2.hasInsufficientStock,onClick:()=>completeSale(sale.id),loading:completingSale===sale.id,children:(_stockValidationStatu3=stockValidationStatus[sale.id])!==null&&_stockValidationStatu3!==void 0&&_stockValidationStatu3.hasInsufficientStock?'Insufficient Stock':'Complete Sale'})]})]},sale.id);})}),showSaleModal&&selectedSale&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal sale-details-modal\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Sale Details - \",selectedSale.sale_number]}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:()=>{setShowSaleModal(false);setSelectedSale(null);},children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Customer Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:\"Name:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:selectedSale.customer_name||'Walk-in Customer'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:\"Phone:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:selectedSale.customer_phone||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:\"Email:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:selectedSale.customer_email||'N/A'})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Sale Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:\"Date:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:formatDate(selectedSale.created_at)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:\"Payment Method:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"info-value\",children:(_selectedSale$payment=selectedSale.payment_method)===null||_selectedSale$payment===void 0?void 0:_selectedSale$payment.replace('_',' ').toUpperCase()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"info-label\",children:\"Status:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"status-badge pending\",children:\"Pending\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"items-section\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Items (\",((_selectedSale$items=selectedSale.items)===null||_selectedSale$items===void 0?void 0:_selectedSale$items.length)||0,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"items-container\",children:(_selectedSale$items2=selectedSale.items)===null||_selectedSale$items2===void 0?void 0:_selectedSale$items2.map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"item-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"item-name\",children:item.product_name}),/*#__PURE__*/_jsx(\"span\",{className:\"price-mode-badge \".concat(item.price_mode==='wholesale'?'wholesale':''),children:item.price_mode==='wholesale'?'WS':'STD'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-quantity\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"quantity\",children:item.quantity_display||item.quantity}),/*#__PURE__*/_jsx(\"span\",{className:\"unit\",children:item.unit_name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-price\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"unit-price\",children:[formatCurrency(item.unit_price),\" MGA each\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"total-price\",children:[formatCurrency(item.total_price),\" MGA\"]})]})]})]},index))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"totals-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Totals\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"totals-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"total-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"total-label\",children:\"Subtotal:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"total-value\",children:[formatCurrency(selectedSale.subtotal),\" MGA\"]})]}),selectedSale.discount_amount>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"total-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"total-label\",children:\"Discount:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"total-value\",children:[\"-\",formatCurrency(selectedSale.discount_amount),\" MGA\"]})]}),selectedSale.tax_amount>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"total-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"total-label\",children:\"Tax:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"total-value\",children:[formatCurrency(selectedSale.tax_amount),\" MGA\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"total-item total-final\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"total-label\",children:\"Total:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"total-value\",children:[formatCurrency(selectedSale.total_amount),\" MGA\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stock-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Stock Status\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stock-status\",children:(_stockValidationStatu4=stockValidationStatus[selectedSale.id])!==null&&_stockValidationStatu4!==void 0&&_stockValidationStatu4.hasInsufficientStock?/*#__PURE__*/_jsx(\"div\",{className:\"stock-insufficient\",children:\"\\u26A0\\uFE0F Insufficient Stock\"}):/*#__PURE__*/_jsx(\"div\",{className:\"stock-sufficient\",children:\"\\u2705 Stock Available\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>{setShowSaleModal(false);setSelectedSale(null);},children:\"Close\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>printPendingSale(selectedSale),children:\"\\uD83D\\uDDA8\\uFE0F Print Receipt\"}),/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>editSale(selectedSale),children:\"\\u270F\\uFE0F Edit\"}),/*#__PURE__*/_jsx(Button,{variant:\"success\",disabled:(_stockValidationStatu5=stockValidationStatus[selectedSale.id])===null||_stockValidationStatu5===void 0?void 0:_stockValidationStatu5.hasInsufficientStock,onClick:()=>completeSale(selectedSale.id),children:(_stockValidationStatu6=stockValidationStatus[selectedSale.id])!==null&&_stockValidationStatu6!==void 0&&_stockValidationStatu6.hasInsufficientStock?'Insufficient Stock':'Complete Sale'})]})]})}),showEditModal&&editingSale&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal edit-sale-modal\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Edit Sale - \",editingSale.sale_number]}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:()=>{setShowEditModal(false);setEditingSale(null);setEditFormData({});},children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Customer Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Customer Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:editFormData.customer_name||'',onChange:e=>setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{customer_name:e.target.value})),placeholder:\"Customer name\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Phone\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:editFormData.customer_phone||'',onChange:e=>setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{customer_phone:e.target.value})),placeholder:\"Phone number\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:editFormData.customer_email||'',onChange:e=>setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{customer_email:e.target.value})),placeholder:\"Email address\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"select\",{value:editFormData.payment_method||'cash',onChange:e=>setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{payment_method:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"cash\",children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{value:\"card\",children:\"Card\"}),/*#__PURE__*/_jsx(\"option\",{value:\"mobile_money\",children:\"Mobile Money\"}),/*#__PURE__*/_jsx(\"option\",{value:\"bank_transfer\",children:\"Bank Transfer\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-section\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Items (\",((_editFormData$items=editFormData.items)===null||_editFormData$items===void 0?void 0:_editFormData$items.length)||0,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"items-edit-container\",children:(_editFormData$items2=editFormData.items)===null||_editFormData$items2===void 0?void 0:_editFormData$items2.map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"edit-item-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"item-name\",children:item.product_name}),/*#__PURE__*/_jsx(\"span\",{className:\"price-mode-badge \".concat(item.price_mode==='wholesale'?'wholesale':''),children:item.price_mode==='wholesale'?'WS':'STD'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"item-unit\",children:item.unit_name}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-price\",children:[formatCurrency(item.unit_price),\" MGA each\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"control-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Quantity:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",step:\"0.01\",value:item.quantity,onChange:e=>handleEditItemQuantity(index,e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"control-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Price Mode:\"}),/*#__PURE__*/_jsxs(\"select\",{value:item.price_mode,onChange:e=>handleEditItemPriceMode(index,e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"standard\",children:\"Standard\"}),/*#__PURE__*/_jsx(\"option\",{value:\"wholesale\",children:\"Wholesale\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-total\",children:[formatCurrency(item.total_price),\" MGA\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"item-actions\",children:/*#__PURE__*/_jsx(Button,{size:\"small\",variant:\"danger\",onClick:()=>removeEditItem(index),children:\"Remove\"})})]})]},index))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"totals-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Totals\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"totals-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"total-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"total-label\",children:\"Subtotal:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"total-value\",children:[formatCurrency(editFormData.subtotal||0),\" MGA\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"total-item total-final\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"total-label\",children:\"Total:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"total-value\",children:[formatCurrency(editFormData.total_amount||0),\" MGA\"]})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(Button,{variant:\"secondary\",onClick:()=>{setShowEditModal(false);setEditingSale(null);setEditFormData({});},children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:saveEditedSale,children:\"Save Changes\"})]})]})})]});};export default PendingSales;","map":{"version":3,"names":["React","useState","useEffect","api","Button","formatCurrency","formatDate","useAuth","jsx","_jsx","jsxs","_jsxs","PendingSales","_selectedSale$payment","_selectedSale$items","_selectedSale$items2","_stockValidationStatu4","_stockValidationStatu5","_stockValidationStatu6","_editFormData$items","_editFormData$items2","user","loading","authLoading","pendingSales","setPendingSales","setLoading","showSaleModal","setShowSaleModal","selectedSale","setSelectedSale","showEditModal","setShowEditModal","editingSale","setEditingSale","editFormData","setEditFormData","completingSale","setCompletingSale","stockValidationStatus","setStockValidationStatus","fetchPendingSales","length","validateStockForAllSales","console","log","token","localStorage","getItem","substring","response","get","data","error","_error$response","_error$response2","_error$response3","_error$response4","message","status","statusText","alert","window","location","href","_error$response5","_error$response5$data","detail","validationStatus","sale","hasInsufficientStock","item","items","concat","product","stockData","available_units","unitData","find","unit","id","available_quantity","quantity_display","completeSale","saleId","s","stockValidationErrors","push","product_name","unit_name","join","post","completedSale","_objectSpread","printPendingSale","prev","filter","_error$response6","_error$response6$data","cancelSale","confirm","delete","_error$response7","_error$response7$data","_sale$payment_method","_sale$items","printData","printWindow","open","document","write","sale_number","created_at","customer_name","payment_method","replace","toUpperCase","map","quantity","unit_price","total_price","subtotal","discount_amount","tax_amount","total_amount","close","print","editSale","_sale$items2","parseFloat","calculatedSubtotal","reduce","sum","taxAmount","discountAmount","calculatedTotal","saleSubtotal","saleTotalAmount","finalSubtotal","finalTotalAmount","formData","customer_phone","customer_email","handleEditItemQuantity","itemIndex","newQuantity","updatedItems","unitPrice","totalPrice","undefined","newTotalAmount","editFormDataTax","editFormDataDiscount","removeEditItem","_","index","handleEditItemPriceMode","newPriceMode","newUnitPrice","wholesale_price","price","price_mode","_error$response8","_error$response8$data","saveEditedSale","updateData","patch","_error$response9","_error$response9$data","className","children","_sale$items3","_sale$items4","_sale$items5","_stockValidationStatu","_stockValidationStatu2","_stockValidationStatu3","slice","size","variant","onClick","disabled","type","value","onChange","e","target","placeholder","min","step"],"sources":["/home/el-ifran/WareHouse_Manager/beverage_management_system/src/pages/PendingSales.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport api from '../services/api';\nimport Button from '../components/Button';\nimport { formatCurrency, formatDate } from '../utils/helpers';\nimport { useAuth } from '../contexts/AuthContext';\nimport './PendingSales.css';\n\nconst PendingSales = () => {\n  const { user, loading: authLoading } = useAuth();\n  const [pendingSales, setPendingSales] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [showSaleModal, setShowSaleModal] = useState(false);\n  const [selectedSale, setSelectedSale] = useState(null);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editingSale, setEditingSale] = useState(null);\n  const [editFormData, setEditFormData] = useState({});\n  const [completingSale, setCompletingSale] = useState(null);\n  const [stockValidationStatus, setStockValidationStatus] = useState({});\n\n  useEffect(() => {\n    if (!authLoading && user) {\n      fetchPendingSales();\n    }\n  }, [authLoading, user]);\n\n  useEffect(() => {\n    if (pendingSales.length > 0) {\n      validateStockForAllSales();\n    }\n  }, [pendingSales]);\n\n  const fetchPendingSales = async () => {\n    try {\n      setLoading(true);\n      console.log('Fetching pending sales from:', '/sales/pending/');\n      \n      // Check if user is authenticated\n      const token = localStorage.getItem('accessToken');\n      console.log('Auth token exists:', !!token);\n      console.log('Auth token:', token ? token.substring(0, 20) + '...' : 'None');\n      \n      const response = await api.get('/sales/pending/');\n      console.log('Pending sales response:', response.data);\n      setPendingSales(response.data);\n    } catch (error) {\n      console.error('Error fetching pending sales:', error);\n      console.error('Error details:', {\n        message: error.message,\n        response: error.response?.data,\n        status: error.response?.status,\n        statusText: error.response?.statusText\n      });\n      \n      // More specific error handling\n      if (error.response?.status === 401) {\n        alert('Authentication required. Please log in again.');\n        // Redirect to login or refresh token\n        window.location.href = '/login';\n      } else {\n        alert('Error fetching pending sales: ' + (error.response?.data?.detail || error.message));\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const validateStockForAllSales = async () => {\n    const validationStatus = {};\n    \n    for (const sale of pendingSales) {\n      let hasInsufficientStock = false;\n      \n      for (const item of sale.items || []) {\n        try {\n          const response = await api.get(`/products/${item.product}/stock-availability/`);\n          const stockData = response.data;\n          \n          if (stockData.available_units) {\n            const unitData = stockData.available_units.find(unit => unit.id === item.unit);\n            if (unitData && unitData.available_quantity < item.quantity_display) {\n              hasInsufficientStock = true;\n              break;\n            }\n          }\n        } catch (error) {\n          console.error(`Error checking stock for product ${item.product}:`, error);\n        }\n      }\n      \n      validationStatus[sale.id] = { hasInsufficientStock };\n    }\n    \n    setStockValidationStatus(validationStatus);\n  };\n\n  const completeSale = async (saleId) => {\n    try {\n      setCompletingSale(saleId);\n      \n      // Check stock before completing\n      const sale = pendingSales.find(s => s.id === saleId);\n      const stockValidationErrors = [];\n      \n      for (const item of sale.items || []) {\n        try {\n          const response = await api.get(`/products/${item.product}/stock-availability/`);\n          const stockData = response.data;\n          \n          if (stockData.available_units) {\n            const unitData = stockData.available_units.find(unit => unit.id === item.unit);\n            if (unitData && unitData.available_quantity < item.quantity_display) {\n              stockValidationErrors.push(`${item.product_name}: Required ${item.quantity_display} ${item.unit_name}, but only ${unitData.available_quantity} available`);\n            }\n          }\n        } catch (error) {\n          console.error(`Error checking stock for product ${item.product}:`, error);\n          stockValidationErrors.push(`${item.product_name}: Unable to check stock availability`);\n        }\n      }\n      \n      if (stockValidationErrors.length > 0) {\n        alert('Cannot complete sale due to insufficient stock:\\n' + stockValidationErrors.join('\\n'));\n        return;\n      }\n      \n      await api.post(`/sales/${saleId}/complete/`);\n      \n      // Print receipt after successful completion\n      const completedSale = { ...sale, status: 'completed' };\n      printPendingSale(completedSale);\n      \n      // Remove from pending sales list\n      setPendingSales(prev => prev.filter(sale => sale.id !== saleId));\n      setShowSaleModal(false);\n      setSelectedSale(null);\n      \n      alert('Sale completed successfully!');\n    } catch (error) {\n      console.error('Error completing sale:', error);\n      alert('Error completing sale: ' + (error.response?.data?.detail || error.message));\n    } finally {\n      setCompletingSale(null);\n    }\n  };\n\n  const cancelSale = async (saleId) => {\n    if (window.confirm('Are you sure you want to cancel this sale?')) {\n      try {\n        await api.delete(`/sales/${saleId}/`);\n        setPendingSales(prev => prev.filter(sale => sale.id !== saleId));\n        setShowSaleModal(false);\n        setSelectedSale(null);\n        alert('Sale cancelled successfully!');\n      } catch (error) {\n        console.error('Error cancelling sale:', error);\n        alert('Error cancelling sale: ' + (error.response?.data?.detail || error.message));\n      }\n    }\n  };\n\n  const printPendingSale = (sale) => {\n    const printData = {\n      ...sale,\n      status: sale.status === 'completed' ? 'completed' : 'pending',\n      statusText: sale.status === 'completed' ? 'This sale has been completed' : 'This sale is pending'\n    };\n    \n    // Create a new window for printing\n    const printWindow = window.open('', '_blank');\n    printWindow.document.write(`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Receipt - ${sale.sale_number}</title>\n          <style>\n            body { font-family: Arial, sans-serif; margin: 20px; }\n            .header { text-align: center; margin-bottom: 20px; }\n            .receipt-info { margin-bottom: 20px; }\n            .items { margin-bottom: 20px; }\n            .item { display: flex; justify-content: space-between; margin-bottom: 5px; }\n            .totals { border-top: 1px solid #000; padding-top: 10px; }\n            .total-row { display: flex; justify-content: space-between; margin-bottom: 5px; }\n            .total-final { font-weight: bold; font-size: 1.2em; }\n            .status { text-align: center; margin-top: 20px; font-weight: bold; }\n          </style>\n        </head>\n        <body>\n          <div class=\"header\">\n            <h1>Beverage Management System</h1>\n            <h2>Receipt - ${sale.sale_number}</h2>\n          </div>\n          \n          <div class=\"receipt-info\">\n            <p><strong>Date:</strong> ${formatDate(sale.created_at)}</p>\n            <p><strong>Customer:</strong> ${sale.customer_name || 'Walk-in Customer'}</p>\n            <p><strong>Payment Method:</strong> ${sale.payment_method?.replace('_', ' ').toUpperCase()}</p>\n          </div>\n          \n          <div class=\"items\">\n            <h3>Items:</h3>\n            ${sale.items?.map(item => `\n              <div class=\"item\">\n                <span>${item.product_name} - ${item.quantity_display || item.quantity} ${item.unit_name} Ã— ${formatCurrency(item.unit_price)} MGA</span>\n                <span>${formatCurrency(item.total_price)} MGA</span>\n              </div>\n            `).join('')}\n          </div>\n          \n          <div class=\"totals\">\n            <div class=\"total-row\">\n              <span>Subtotal:</span>\n              <span>${formatCurrency(sale.subtotal)} MGA</span>\n            </div>\n            ${sale.discount_amount > 0 ? `\n              <div class=\"total-row\">\n                <span>Discount:</span>\n                <span>-${formatCurrency(sale.discount_amount)} MGA</span>\n              </div>\n            ` : ''}\n            ${sale.tax_amount > 0 ? `\n              <div class=\"total-row\">\n                <span>Tax:</span>\n                <span>${formatCurrency(sale.tax_amount)} MGA</span>\n              </div>\n            ` : ''}\n            <div class=\"total-row total-final\">\n              <span>Total:</span>\n              <span>${formatCurrency(sale.total_amount)} MGA</span>\n            </div>\n          </div>\n          \n          <div class=\"status\">\n            <p>${printData.statusText}</p>\n          </div>\n        </body>\n      </html>\n    `);\n    printWindow.document.close();\n    printWindow.print();\n  };\n\n  const editSale = (sale) => {\n    setEditingSale(sale);\n    \n    // Initialize items with proper quantities and calculate totals\n    const items = sale.items?.map(item => ({\n      ...item,\n      quantity: parseFloat(item.quantity_display || item.quantity) || 0,\n      unit_price: parseFloat(item.unit_price) || 0,\n      total_price: (parseFloat(item.quantity_display || item.quantity) || 0) * (parseFloat(item.unit_price) || 0)\n    })) || [];\n    \n    // Calculate initial totals\n    const calculatedSubtotal = items.reduce((sum, item) => sum + item.total_price, 0);\n    \n    // If no tax_amount is provided, assume 0% tax (common for many sales)\n    const taxAmount = sale.tax_amount || 0;\n    const discountAmount = sale.discount_amount || 0;\n    const calculatedTotal = calculatedSubtotal + taxAmount - discountAmount;\n    \n    // Use the sale's total_amount if it exists and is greater than 0, otherwise use calculated total\n    const subtotal = sale.subtotal && sale.subtotal > 0 ? sale.subtotal : calculatedSubtotal;\n    const total_amount = sale.total_amount && sale.total_amount > 0 ? sale.total_amount : calculatedTotal;\n    \n    console.log('Edit Sale Debug:', {\n      sale: sale,\n      items: items,\n      calculatedSubtotal: calculatedSubtotal,\n      calculatedTotal: calculatedTotal,\n      saleSubtotal: sale.subtotal,\n      saleTotalAmount: sale.total_amount,\n      finalSubtotal: subtotal,\n      finalTotalAmount: total_amount,\n      tax_amount: sale.tax_amount,\n      discount_amount: sale.discount_amount\n    });\n    \n    const formData = {\n      customer_name: sale.customer_name || '',\n      customer_phone: sale.customer_phone || '',\n      customer_email: sale.customer_email || '',\n      payment_method: sale.payment_method || 'cash',\n      items: items,\n      subtotal: subtotal,\n      total_amount: total_amount,\n      tax_amount: sale.tax_amount || 0,\n      discount_amount: sale.discount_amount || 0\n    };\n    \n    console.log('Setting EditFormData:', formData);\n    \n    setEditFormData(formData);\n    setShowEditModal(true);\n    setShowSaleModal(false);\n  };\n\n  const handleEditItemQuantity = (itemIndex, newQuantity) => {\n    const updatedItems = [...editFormData.items];\n    updatedItems[itemIndex].quantity = parseFloat(newQuantity) || 0;\n    updatedItems[itemIndex].total_price = updatedItems[itemIndex].quantity * parseFloat(updatedItems[itemIndex].unit_price) || 0;\n    \n    const subtotal = updatedItems.reduce((sum, item) => sum + item.total_price, 0);\n    \n    console.log('Quantity Change Debug:', {\n      itemIndex: itemIndex,\n      newQuantity: newQuantity,\n      unitPrice: updatedItems[itemIndex].unit_price,\n      totalPrice: updatedItems[itemIndex].total_price,\n      subtotal: subtotal\n    });\n    \n    // Fallback to original sale values if editFormData doesn't have them\n    const taxAmount = editFormData.tax_amount !== undefined ? editFormData.tax_amount : (editingSale?.tax_amount || 0);\n    const discountAmount = editFormData.discount_amount !== undefined ? editFormData.discount_amount : (editingSale?.discount_amount || 0);\n    const newTotalAmount = subtotal + taxAmount - discountAmount;\n    \n    console.log('Quantity Change Debug - Totals:', {\n      subtotal: subtotal,\n      taxAmount: taxAmount,\n      discountAmount: discountAmount,\n      newTotalAmount: newTotalAmount,\n      editFormDataTax: editFormData.tax_amount,\n      editFormDataDiscount: editFormData.discount_amount\n    });\n    \n    setEditFormData({\n      ...editFormData,\n      items: updatedItems,\n      subtotal: subtotal,\n      total_amount: newTotalAmount\n    });\n  };\n\n  const removeEditItem = (itemIndex) => {\n    const updatedItems = editFormData.items.filter((_, index) => index !== itemIndex);\n    const subtotal = updatedItems.reduce((sum, item) => sum + item.total_price, 0);\n    \n    // Fallback to original sale values if editFormData doesn't have them\n    const taxAmount = editFormData.tax_amount !== undefined ? editFormData.tax_amount : (editingSale?.tax_amount || 0);\n    const discountAmount = editFormData.discount_amount !== undefined ? editFormData.discount_amount : (editingSale?.discount_amount || 0);\n    const newTotalAmount = subtotal + taxAmount - discountAmount;\n    \n    setEditFormData({\n      ...editFormData,\n      items: updatedItems,\n      subtotal: subtotal,\n      total_amount: newTotalAmount\n    });\n  };\n\n  const handleEditItemPriceMode = async (itemIndex, newPriceMode) => {\n    try {\n      const item = editFormData.items[itemIndex];\n      const response = await api.get(`/products/${item.product}/`);\n      const product = response.data;\n      \n      let newUnitPrice;\n      if (newPriceMode === 'wholesale') {\n        newUnitPrice = product.wholesale_price || product.price;\n      } else {\n        newUnitPrice = product.price;\n      }\n      \n      const updatedItems = [...editFormData.items];\n      updatedItems[itemIndex].price_mode = newPriceMode;\n      updatedItems[itemIndex].unit_price = parseFloat(newUnitPrice) || 0;\n      updatedItems[itemIndex].total_price = updatedItems[itemIndex].quantity * (parseFloat(newUnitPrice) || 0);\n      \n      const subtotal = updatedItems.reduce((sum, item) => sum + item.total_price, 0);\n      \n      // Fallback to original sale values if editFormData doesn't have them\n      const taxAmount = editFormData.tax_amount !== undefined ? editFormData.tax_amount : (editingSale?.tax_amount || 0);\n      const discountAmount = editFormData.discount_amount !== undefined ? editFormData.discount_amount : (editingSale?.discount_amount || 0);\n      const newTotalAmount = subtotal + taxAmount - discountAmount;\n      \n      setEditFormData({\n        ...editFormData,\n        items: updatedItems,\n        subtotal: subtotal,\n        total_amount: newTotalAmount\n      });\n    } catch (error) {\n      console.error('Error updating price mode:', error);\n      alert('Error updating price mode: ' + (error.response?.data?.detail || error.message));\n    }\n  };\n\n  const saveEditedSale = async () => {\n    try {\n      const updateData = {\n        customer_name: editFormData.customer_name,\n        customer_phone: editFormData.customer_phone,\n        customer_email: editFormData.customer_email,\n        payment_method: editFormData.payment_method,\n        items: editFormData.items.map(item => ({\n          id: item.id,\n          quantity: item.quantity,\n          unit_price: item.unit_price,\n          price_mode: item.price_mode\n        }))\n      };\n      \n      console.log('Saving edited sale:', {\n        saleId: editingSale.id,\n        updateData: updateData,\n        editFormData: editFormData\n      });\n      \n      const response = await api.patch(`/sales/${editingSale.id}/`, updateData);\n      console.log('Save response:', response.data);\n      \n      setShowEditModal(false);\n      setEditingSale(null);\n      setEditFormData({});\n      \n      // Refresh the pending sales list\n      fetchPendingSales();\n      \n      alert('Sale updated successfully!');\n    } catch (error) {\n      console.error('Error updating sale:', error);\n      alert('Error updating sale: ' + (error.response?.data?.detail || error.message));\n    }\n  };\n\n  if (authLoading || loading) {\n    return (\n      <div className=\"pending-sales-page\">\n        <div className=\"page-header\">\n          <h1>Pending Sales</h1>\n        </div>\n        <div className=\"loading-message\">Loading pending sales...</div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"pending-sales-page\">\n        <div className=\"page-header\">\n          <h1>Pending Sales</h1>\n        </div>\n        <div className=\"loading-message\">Please log in to view pending sales.</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"pending-sales-page\">\n      <div className=\"page-header\">\n        <h1>Pending Sales</h1>\n        <p>Manage and validate pending sales before completion</p>\n      </div>\n\n      {pendingSales.length === 0 ? (\n        <div className=\"no-pending-sales\">\n          <div className=\"no-sales-icon\">ðŸ“‹</div>\n          <h3>No Pending Sales</h3>\n          <p>All sales have been completed or there are no pending sales at the moment.</p>\n        </div>\n      ) : (\n        <div className=\"pending-sales-grid\">\n          {pendingSales.map((sale) => (\n            <div key={sale.id} className=\"pending-sale-card\">\n              <div className=\"sale-header\">\n                <div className=\"sale-number\">{sale.sale_number}</div>\n                <div className=\"sale-date\">{formatDate(sale.created_at)}</div>\n              </div>\n              \n              <div className=\"sale-customer\">\n                <strong>{sale.customer_name || 'Walk-in Customer'}</strong>\n              </div>\n              \n              <div className=\"sale-items\">\n                <div className=\"items-count\">{sale.items?.length || 0} items</div>\n                <div className=\"items-preview\">\n                  {sale.items?.slice(0, 3).map((item, index) => (\n                    <div key={index} className=\"item-preview\">\n                      <span className=\"item-name\">{item.product_name}</span>\n                      <span className=\"item-quantity\">{item.quantity_display || item.quantity} {item.unit_name}</span>\n                      <span className={`price-mode-badge ${item.price_mode === 'wholesale' ? 'wholesale' : ''}`}>\n                        {item.price_mode === 'wholesale' ? 'WS' : 'STD'}\n                      </span>\n                    </div>\n                  ))}\n                  {sale.items?.length > 3 && (\n                    <div className=\"more-items\">+{sale.items.length - 3} more items</div>\n                  )}\n                </div>\n              </div>\n              \n              <div className=\"sale-total\">\n                <strong>{formatCurrency(sale.total_amount)} MGA</strong>\n              </div>\n              \n              <div className=\"stock-status\">\n                {stockValidationStatus[sale.id]?.hasInsufficientStock ? (\n                  <div className=\"stock-insufficient\">âš ï¸ Insufficient Stock</div>\n                ) : (\n                  <div className=\"stock-sufficient\">âœ… Stock Available</div>\n                )}\n              </div>\n              \n              <div className=\"sale-actions\">\n                <Button\n                  size=\"small\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setSelectedSale(sale);\n                    setShowSaleModal(true);\n                  }}\n                >\n                  View Details\n                </Button>\n                <Button\n                  size=\"small\"\n                  variant=\"outline\"\n                  onClick={() => printPendingSale(sale)}\n                >\n                  ðŸ–¨ï¸ Print\n                </Button>\n                <Button\n                  size=\"small\"\n                  variant=\"outline\"\n                  onClick={() => editSale(sale)}\n                >\n                  âœï¸ Edit\n                </Button>\n                <Button\n                  size=\"small\"\n                  variant=\"primary\"\n                  disabled={stockValidationStatus[sale.id]?.hasInsufficientStock}\n                  onClick={() => completeSale(sale.id)}\n                  loading={completingSale === sale.id}\n                >\n                  {stockValidationStatus[sale.id]?.hasInsufficientStock ? 'Insufficient Stock' : 'Complete Sale'}\n                </Button>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Sale Details Modal */}\n      {showSaleModal && selectedSale && (\n        <div className=\"modal-overlay\">\n          <div className=\"modal sale-details-modal\">\n            <div className=\"modal-header\">\n              <h2>Sale Details - {selectedSale.sale_number}</h2>\n              <button \n                className=\"modal-close\" \n                onClick={() => {\n                  setShowSaleModal(false);\n                  setSelectedSale(null);\n                }}\n              >\n                Ã—\n              </button>\n            </div>\n\n            <div className=\"modal-body\">\n              {/* Customer Information */}\n              <div className=\"info-section\">\n                <h3>Customer Information</h3>\n                <div className=\"info-grid\">\n                  <div className=\"info-item\">\n                    <span className=\"info-label\">Name:</span>\n                    <span className=\"info-value\">{selectedSale.customer_name || 'Walk-in Customer'}</span>\n                  </div>\n                  <div className=\"info-item\">\n                    <span className=\"info-label\">Phone:</span>\n                    <span className=\"info-value\">{selectedSale.customer_phone || 'N/A'}</span>\n                  </div>\n                  <div className=\"info-item\">\n                    <span className=\"info-label\">Email:</span>\n                    <span className=\"info-value\">{selectedSale.customer_email || 'N/A'}</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Sale Information */}\n              <div className=\"info-section\">\n                <h3>Sale Information</h3>\n                <div className=\"info-grid\">\n                  <div className=\"info-item\">\n                    <span className=\"info-label\">Date:</span>\n                    <span className=\"info-value\">{formatDate(selectedSale.created_at)}</span>\n                  </div>\n                  <div className=\"info-item\">\n                    <span className=\"info-label\">Payment Method:</span>\n                    <span className=\"info-value\">{selectedSale.payment_method?.replace('_', ' ').toUpperCase()}</span>\n                  </div>\n                  <div className=\"info-item\">\n                    <span className=\"info-label\">Status:</span>\n                    <span className=\"status-badge pending\">Pending</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Items List */}\n              <div className=\"items-section\">\n                <h3>Items ({selectedSale.items?.length || 0})</h3>\n                <div className=\"items-container\">\n                  {selectedSale.items?.map((item, index) => (\n                    <div key={index} className=\"item-card\">\n                      <div className=\"item-header\">\n                        <div className=\"item-name\">{item.product_name}</div>\n                        <span className={`price-mode-badge ${item.price_mode === 'wholesale' ? 'wholesale' : ''}`}>\n                          {item.price_mode === 'wholesale' ? 'WS' : 'STD'}\n                        </span>\n                      </div>\n                      <div className=\"item-details\">\n                        <div className=\"item-quantity\">\n                          <span className=\"quantity\">{item.quantity_display || item.quantity}</span>\n                          <span className=\"unit\">{item.unit_name}</span>\n                        </div>\n                        <div className=\"item-price\">\n                          <span className=\"unit-price\">{formatCurrency(item.unit_price)} MGA each</span>\n                          <span className=\"total-price\">{formatCurrency(item.total_price)} MGA</span>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Totals */}\n              <div className=\"totals-section\">\n                <h3>Totals</h3>\n                <div className=\"totals-grid\">\n                  <div className=\"total-item\">\n                    <span className=\"total-label\">Subtotal:</span>\n                    <span className=\"total-value\">{formatCurrency(selectedSale.subtotal)} MGA</span>\n                  </div>\n                  {selectedSale.discount_amount > 0 && (\n                    <div className=\"total-item\">\n                      <span className=\"total-label\">Discount:</span>\n                      <span className=\"total-value\">-{formatCurrency(selectedSale.discount_amount)} MGA</span>\n                    </div>\n                  )}\n                  {selectedSale.tax_amount > 0 && (\n                    <div className=\"total-item\">\n                      <span className=\"total-label\">Tax:</span>\n                      <span className=\"total-value\">{formatCurrency(selectedSale.tax_amount)} MGA</span>\n                    </div>\n                  )}\n                  <div className=\"total-item total-final\">\n                    <span className=\"total-label\">Total:</span>\n                    <span className=\"total-value\">{formatCurrency(selectedSale.total_amount)} MGA</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Stock Status */}\n              <div className=\"stock-section\">\n                <h3>Stock Status</h3>\n                <div className=\"stock-status\">\n                  {stockValidationStatus[selectedSale.id]?.hasInsufficientStock ? (\n                    <div className=\"stock-insufficient\">\n                      âš ï¸ Insufficient Stock\n                    </div>\n                  ) : (\n                    <div className=\"stock-sufficient\">\n                      âœ… Stock Available\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n\n            <div className=\"modal-footer\">\n              <Button\n                variant=\"secondary\"\n                onClick={() => {\n                  setShowSaleModal(false);\n                  setSelectedSale(null);\n                }}\n              >\n                Close\n              </Button>\n              <Button\n                variant=\"secondary\"\n                onClick={() => printPendingSale(selectedSale)}\n              >\n                ðŸ–¨ï¸ Print Receipt\n              </Button>\n              <Button\n                variant=\"secondary\"\n                onClick={() => editSale(selectedSale)}\n              >\n                âœï¸ Edit\n              </Button>\n              <Button\n                variant=\"success\"\n                disabled={stockValidationStatus[selectedSale.id]?.hasInsufficientStock}\n                onClick={() => completeSale(selectedSale.id)}\n              >\n                {stockValidationStatus[selectedSale.id]?.hasInsufficientStock ? 'Insufficient Stock' : 'Complete Sale'}\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Sale Modal */}\n      {showEditModal && editingSale && (\n        <div className=\"modal-overlay\">\n          <div className=\"modal edit-sale-modal\">\n            <div className=\"modal-header\">\n              <h2>Edit Sale - {editingSale.sale_number}</h2>\n              <button \n                className=\"modal-close\" \n                onClick={() => {\n                  setShowEditModal(false);\n                  setEditingSale(null);\n                  setEditFormData({});\n                }}\n              >\n                Ã—\n              </button>\n            </div>\n\n            <div className=\"modal-body\">\n              {/* Customer Information */}\n              <div className=\"form-section\">\n                <h3>Customer Information</h3>\n                <div className=\"form-grid\">\n                  <div className=\"form-group\">\n                    <label>Customer Name</label>\n                    <input\n                      type=\"text\"\n                      value={editFormData.customer_name || ''}\n                      onChange={(e) => setEditFormData({...editFormData, customer_name: e.target.value})}\n                      placeholder=\"Customer name\"\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Phone</label>\n                    <input\n                      type=\"text\"\n                      value={editFormData.customer_phone || ''}\n                      onChange={(e) => setEditFormData({...editFormData, customer_phone: e.target.value})}\n                      placeholder=\"Phone number\"\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Email</label>\n                    <input\n                      type=\"email\"\n                      value={editFormData.customer_email || ''}\n                      onChange={(e) => setEditFormData({...editFormData, customer_email: e.target.value})}\n                      placeholder=\"Email address\"\n                    />\n                  </div>\n                  <div className=\"form-group\">\n                    <label>Payment Method</label>\n                    <select\n                      value={editFormData.payment_method || 'cash'}\n                      onChange={(e) => setEditFormData({...editFormData, payment_method: e.target.value})}\n                    >\n                      <option value=\"cash\">Cash</option>\n                      <option value=\"card\">Card</option>\n                      <option value=\"mobile_money\">Mobile Money</option>\n                      <option value=\"bank_transfer\">Bank Transfer</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n\n              {/* Items */}\n              <div className=\"form-section\">\n                <h3>Items ({editFormData.items?.length || 0})</h3>\n                <div className=\"items-edit-container\">\n                  {editFormData.items?.map((item, index) => (\n                    <div key={index} className=\"edit-item-card\">\n                      <div className=\"item-header\">\n                        <div className=\"item-name\">{item.product_name}</div>\n                        <span className={`price-mode-badge ${item.price_mode === 'wholesale' ? 'wholesale' : ''}`}>\n                          {item.price_mode === 'wholesale' ? 'WS' : 'STD'}\n                        </span>\n                      </div>\n                      <div className=\"item-details\">\n                        <div className=\"item-unit\">{item.unit_name}</div>\n                        <div className=\"item-price\">{formatCurrency(item.unit_price)} MGA each</div>\n                      </div>\n                      <div className=\"item-controls\">\n                        <div className=\"control-group\">\n                          <label>Quantity:</label>\n                          <input\n                            type=\"number\"\n                            min=\"0\"\n                            step=\"0.01\"\n                            value={item.quantity}\n                            onChange={(e) => handleEditItemQuantity(index, e.target.value)}\n                          />\n                        </div>\n                        <div className=\"control-group\">\n                          <label>Price Mode:</label>\n                          <select\n                            value={item.price_mode}\n                            onChange={(e) => handleEditItemPriceMode(index, e.target.value)}\n                          >\n                            <option value=\"standard\">Standard</option>\n                            <option value=\"wholesale\">Wholesale</option>\n                          </select>\n                        </div>\n                        <div className=\"item-total\">\n                          {formatCurrency(item.total_price)} MGA\n                        </div>\n                        <div className=\"item-actions\">\n                          <Button\n                            size=\"small\"\n                            variant=\"danger\"\n                            onClick={() => removeEditItem(index)}\n                          >\n                            Remove\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Totals */}\n              <div className=\"totals-section\">\n                <h3>Totals</h3>\n                <div className=\"totals-grid\">\n                  <div className=\"total-item\">\n                    <span className=\"total-label\">Subtotal:</span>\n                    <span className=\"total-value\">{formatCurrency(editFormData.subtotal || 0)} MGA</span>\n                  </div>\n                  <div className=\"total-item total-final\">\n                    <span className=\"total-label\">Total:</span>\n                    <span className=\"total-value\">{formatCurrency(editFormData.total_amount || 0)} MGA</span>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"modal-footer\">\n              <Button\n                variant=\"secondary\"\n                onClick={() => {\n                  setShowEditModal(false);\n                  setEditingSale(null);\n                  setEditFormData({});\n                }}\n              >\n                Cancel\n              </Button>\n              <Button\n                variant=\"primary\"\n                onClick={saveEditedSale}\n              >\n                Save Changes\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default PendingSales;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}